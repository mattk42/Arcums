./show_req.php
<?php
echo '<link href="../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />';
include ('../config.php');
$limit = 10;
$query = "SELECT catalog_albums.artist, catalog_tracks.title, catalog_request.datetime, catalog_albums.id FROM catalog_request,catalog_albums,catalog_tracks WHERE catalog_albums.id=catalog_request.album_id AND catalog_tracks.id=catalog_request.track_id ORDER BY datetime DESC LIMIT $limit";
$res = mysql_query($query) or die(mysql_error());
echo "<table cellspacing=0 class='reqtablemain'><tr class='headers'><td><b>Artist</b></td><td><b>Track</b></td><td><b>Requested Time</b></td></tr>";

while ($row = mysql_fetch_array($res)) {
    echo "<tr  bgcolor=\"#ededed\"  onclick=\"document.location.href='/arcums/catalog/view?id=$row[3]';\" onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#ededed';\"><td>" . $row[0] . "</td><td>" . $row[1] . "</td><td>" . $row[2] . "</td></tr><br>";
}
echo "</table>";
?>
./events/delete.php
<?
require ("../../config.php");
$id = mysql_real_escape_string($_GET['id']);
$query = "DELETE FROM events WHERE id=$id";
mysql_query($query) or die(mysql_error());
echo "<meta HTTP-EQUIV=\"REFRESH\" content=\"0; url=http://www.wupx.com/arcums/events/?del=" . urlencode($id) . "\">";
?>
./events/post.php
<?php
session_start();
require ("../../config.php");
require ("../include/functions.php");
require ("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php

if (isset($_SESSION['dj_logged_in'])) {
    
    if (isset($_POST['title'])) {
        $title = mysql_real_escape_string($_POST['title']);
        $start = strtotime($_POST['sdate']);
        $end = strtotime($_POST['edate']);
        $loc = mysql_real_escape_string($_POST['loc']);
        $details = mysql_real_escape_string($_POST['details']);
        $start = date("Y-m-d H:i:s", $start);
        
        if ($end == "") {
            $end = NULL;
        }
        else {
            $end = date("Y-m-d H:i:s", $end);
        }
        echo $title . "<br>";
        echo $start . "<br>";
        echo $end . "<br>";
        echo $loc . "<br>";
        echo $details . "<br>";
        mysql_query("INSERT INTO events (start,end,title,location,details) VALUES ('$start','$end','$title','$loc','$details')") or die(mysql_error());
        echo "<meta HTTP-EQUIV=\"REFRESH\" content=\"0; url=http://www.wupx.com/arcums/events/?post=" . urlencode($title) . "\">";
    }
    else {
?>
	<center>
	<table class="welcomebar">
	<tr><td class="date"> Add Events</td>
	<td class="loggedin">
	<?php echo 'You\'re logged in as ';
        echo $session_username; ?>
	<a href="http://www.wupx.com/arcums/login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
	</td>
	</tr>
	</table>

	<table class='addtablemain'><tr><td align='center'>
	<form method=post>
		Event Title: <input type=text name=title></input>
		Location: <input type=text name=loc></input><br>
		Start Date: <input type=text name=sdate></input> 
		End Date: <input type=text name=edate></input><br><br>
		Details:<br><textarea rows=20 cols=90 name=details></textarea><br><br>
		<input type=submit value=Submit name=submit>
	</form>	
	</tr></td></table>
	</center>
	<?php
    }
}
else {
    echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
?>
./events/edit.php
<?php
session_start();
require ("../../config.php");
require ("../include/functions.php");
require ("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php

if (isset($_SESSION['dj_logged_in'])) {
    $id = mysql_real_escape_string($_GET['id']);
    
    if (isset($_POST['title'])) {
        $title = mysql_real_escape_string($_POST['title']);
        $start = mysql_real_escape_string($_POST['sdate']);
        $end = mysql_real_escape_string($_POST['edate']);
        $loc = mysql_real_escape_string($_POST['loc']);
        $det = mysql_real_escape_string($_POST['details']);
        $query = "UPDATE events SET title='$title', start='$start', end='$end', location='$loc', details='$det' WHERE id='$id'";
        mysql_query($query) or die(mysql_error());
        echo "<meta HTTP-EQUIV=\"REFRESH\" content=\"0; url=http://www.wupx.com/arcums/events/?edit=" . urlencode($title) . "\">";
    }
    else {
        $res = mysql_query("SELECT * FROM events WHERE id='$id'") or die(mysql_error());
        $row = mysql_fetch_row($res);
?>
	<center>
	<table class="welcomebar">
	<tr><td class="date"> Add Events</td>
	<td class="loggedin">
	<?php echo 'You\'re logged in as ';
        echo $session_username; ?>EVENT #2.
	<a href="http://www.wupx.com/arcums/login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
	</td>
	</tr>
	</table>

	<table class='addtablemain'><tr><td align='center'>
	<form method=post >
		Event Title: <input type=text name=title value='<?php echo $row[3]; ?>'></input>
		Location: <input type=text name=loc value='<?php echo $row[4]; ?>'></input><br>
		Start Date: <input type=text name=sdate value='<?php echo $row[1]; ?>'></input>
		End Date: <input type=text name=edate value='<?php echo $row[2]; ?>'></input><br><br>
		Details:<br><textarea rows=20 cols=90 name=details><?php echo $row[5]; ?></textarea><br><br>
		<input type=submit value=Submit name=submit>
	</table>
	<?php
    }
}
else {
    echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
?>
./events/index.php
<?php
session_start();
require ("../../config.php");
require ("../include/functions.php");
require ("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>


<?php

if (isset($_SESSION['dj_logged_in'])) {
?>

	<center>
	<table class="welcomebar">
	<tr><td class="date"> Events List</td>
	<td class="loggedin">
	<?php echo 'You\'re logged in as ';
    echo $session_username; ?>
	<a href="http://www.wupx.com/arcums/login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
	</td>
	</tr>
	</table>

	<?php
    echo "<table class='eventtablemain'><tr>";
    
    if ($user_info['permissions'] >= 2) {
        echo '<td><a href=\'post.php\'>Add Events</a></td>';
    }
    
    if ($_GET['all'] == '1') {
        echo '<td><a href=\'?all=0\'>Show Current</a>';
    }
    else {
        echo '<td><a href=\'?all=1\'>Show All</a>';
    }
    echo "</td></table>";
    
    if ($_GET['all'] == '1') {
        $result = mysql_query("SELECT title, start, end, location, details, id FROM events ORDER BY start ASC, end DESC") or die("Databse Error");
    }
    else {
        $result = mysql_query("SELECT title, start, end, location, details, id FROM events WHERE end > Now() or (start>=Now() and end='0000-00-00 00:00:00') ORDER BY start ASC, end DESC") or die("Database Error");
    }
    
    if (isset($_GET['post'])) {
        echo "<font color='white'><b>" . $_GET['post'] . " was posted succesfully.</b></font><br>";
    }
    
    if (isset($_GET['edit'])) {
        echo "<font color='white'><b>" . $_GET['edit'] . " was succesfully edited.</b></font><br>";
    }
    
    if (isset($_GET['del'])) {
        echo "<font color='white'><b> Event succesfully deleted.</b></font><br>";
    }
    
    while ($row = mysql_fetch_array($result)) {
        $start = date("M d Y h:i A", strtotime($row[1]));
        
        if ($row[2] == '0000-00-00 00:00:00') {
            $end = "";
        }
        else {
            $end = " - " . date("M d Y h:i A", strtotime($row[2]));
        }
        echo "<center><table class=\"eventtablemain\">";
        echo "<tr><td class=\"headers\"><b><font size=\"4\">" . $row[0] . "</b></font></td>";
        
        if ($user_info['permissions'] >= 2) {
            echo "<td class='headers' align='right'><a href='edit.php?id=" . $row[5] . "'><img alt='Edit' width='20' src='../images/edit-icon.png'></a></td>";
        }
        echo "</tr>";
        echo "<tr><td><b>When: </b>" . $start . $end . "</td>";
        
        if ($user_info['permissions'] >= 2) {
            echo "<td class='headers' align='right'><a href='delete.php?id=" . $row[5] . "'><img alt='Delete' width='20' src='../images/delete-icon.png'></a></td>";
        }
        echo "</tr>";
        echo "<tr><td><b>Where: </b>" . $row[3] . "</td></tr>";
        echo "<tr><td>" . $row[4] . "</td></tr>";
        echo "<td></table></center><br>";
    }
}
else {
    echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
?>
./catalog/remove.php
<?php
session_start();
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
require_once("../../config.php");
require_once("../include/functions.php");
require_once('../include/functions.php');
include("../include/header.php");


	if(isset($_GET['id'])){
		if($user_info['permissions'] >= 2){
			if(isset($_GET['confirm'])){
				$id = mysql_real_escape_string($_GET['id']);
				$track_removal = "DELETE FROM catalog_tracks WHERE album_id='" . $id . "'";
				$album_removal = "DELETE FROM catalog_albums WHERE id='" . $id . "'";

				mysql_query($track_removal) or die(mysql_error());
				mysql_query($album_removal) or die(mysql_error());

				echo "<center>
				<table class='headers'><td align='center'>
				Album Removed<br>
				<a href='index.php'>Go Back</a>
				</tr>";
			}
			else{
				echo "<center>
				<table class='headers'><td align='center'>
				Are you sure you want to remove this album?<br>
				<a href='?id=" . $_GET['id'] . "&confirm=1'>Yes</a>
				<a href='view.php?id=" . $_GET['id'] . "'>No</a> </center></td>"
				;
			}
		}
		else{
			echo "You are unauthorized to remove albums!";
		}

	}
	else{
		echo "<center><table class='headers'><td align='center'>Invalid album ID</td></table></center>";
	}


?>
./catalog/view.php
<?php
session_start();
print_r($_SESSION);
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
</head>

<body>
<?php
require_once ("../../config.php");
require_once ("../include/functions.php");
require_once ('../include/catalog_functions.php');
require_once ('../include/stream_functions.php');

if (isset($_SESSION['dj_logged_in'])) {
    echo '<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />';
    require ("../include/header.php");
}
else {
    require ("../../header.php");
}
$page_limit = 20; //how many search results to show per page

$found = false; //whether or not similar artists were found

$listeners = getCurrentListeners();

if (isset($_GET['play'])) {
    echo "<center>Played</center>";
    addSong($_GET['artist'], $_GET['song'], $_GET['section'], $_GET['sectionnumber'], $_GET['album'], $_GET['label'], $_GET['tracknumber']);
}

if (isset($_GET['sent'])) {
    echo "<center>Report Sent</center>";
}

if (isset($_GET['id'])) {
    $id = mysql_real_escape_String($_GET['id']);
    $result = mysql_query("SELECT * FROM catalog_albums WHERE id='" . $id . "'");
    $row = mysql_fetch_array($result);

    //Update cache data if out of data
    //FIX THIS CODE BEFORE RELEASE! get_similar should be "threaded"!
    if ($row[16] < date('Y-m-d', strtotime('-1 month'))) {
        //passthru("/usr/bin/php5 /var/www/arcums/catalog/get_similar.php '" . $row[5] . "' >> /var/www/arcums/catalog/similar.log 2>&1 &");
		    $query = "DELETE FROM catalog_similar WHERE artist='$row[5]'";
		    mysql_query($query) or die(mysql_error());
		    $similar_xml = get_similar($row[5], 10);
		    if ($similar_xml) {
		        foreach ($similar_xml->similarartists->artist as $sartist) {
		            $art = mysql_real_escape_string($sartist->name);
		            $query = "INSERT INTO catalog_similar VALUES('$row[5]','$art')" or die(mysql_error());
		            mysql_query($query) or die(mysql_error());
		        }
		    }
		    $query = "UPDATE catalog_albums SET similar_cache_date=NOW() WHERE artist = '$row[5]'";
		    mysql_query($query) or die(mysql_error());
    }
    
    if ($row[10] == "" && $row[7] != "") {
        $row[10] = findImage($row[7]);
    }
    
    if ($row[10] == "NONE" || $row[10] == "") {
        
        if ($row[14] == 1) {
            $row[10] = '../images/vinyl.png';
        }
        else {
            $row[10] = '../images/CD.PNG';
        }
    }
    echo "<center><table class='catalogtablemain'><tr><td align='center'>";
    echo '<img width=/"250/" src="' . $row[10] . '"></img><br>';
    
    if (isset($_SESSION['dj_logged_in'])) {
        echo "<br><a href=report.php?id=" . $id . "><img alt='Report' width='20' src='../images/uhoh.png'></a> ";
    }
    
    if (isset($_SESSION['dj_logged_in']) && $user_info['permissions'] >= 2) {
        echo " <a href=edit.php?id=" . $id . "><img alt='Edit' width='20' src='../images/edit-icon.png'></a>";
        echo " <a href=remove.php?id=" . $id . "><img alt='Delete' width='20' src='../images/delete-icon.png'></a>";
        echo "<br>";
    }
    echo '</td><td>';
    echo "<b>Artist: </b>" . $row['artist'] . "<br>";
    echo "<b>Title: </b>" . $row['title'] . "<br>";
    echo "<b>Label: </b>" . $row['label'] . "<br>";
    echo "<b>Release Date: </b>" . $row['release'] . "<br>";
    $cat_query = mysql_query("SELECT prefix FROM catalog_categories WHERE id='" . $row[1] . "'") or die(mysql_error());
    $cat_result = mysql_fetch_row($cat_query);
    
    if ($row[14] == 1) {
        $v = " V-";
    }
    else {
        $v = "";
    }
    echo "<b>Category</b> $cat_result[0] $v$row[3] $row[2]<br>";
    $section = $cat_result[0];
    
    if ($section == "") {
        $section = "GENERAL";
    }
    $track_result = mysql_query("SELECT * FROM catalog_tracks WHERE album_id='" . $id . "' ORDER BY cd_number, position");
    $cd = '0';
    
    if (!isset($_SESSION['dj_logged_in'])) {
        echo "Click the play arrow to request a song.<br>";
    }
    
    while ($track_row = mysql_fetch_row($track_result)) {
        
        if ($cd != $track_row[4]) {
            $cd = $track_row[4];
            echo "<br><u><b>Disc " . $cd . "</b></u><br>";
        }
        echo $track_row[2] . ".) ";
        echo $track_row[3];
        
        if ($track_row[5] != "00:00") {
            echo " [" . $track_row[5] . "]";
        }

        //echo " <a href='?id=".$id."&play=1&artist=".$row[5]."&song=".$track_row[3]."&section=".$cat_result[0]."&sectionnumber=".$row[2]."&album=".$row[4]."&label=".$row[6]."&tracknumber=".$track_row[2]."'>" . ">" . "</a>";
        //hidden form for submiting to playlist

        
        if (isset($_SESSION['dj_logged_in'])) {
            echo "<form action='../playlist/addparse.php' method='post' name='addsong'>";
        }
        else {
            echo "<form class='headers' action='reqpost.php' method='post' name='addsong'>";
        }
        echo "<input type=\"hidden\" name=\"date\" value=\"";
        print date("Y-m-d");
        echo "\" />";
        echo "<input type=\"hidden\" name=\"time\" value=\"";
        print date("H:i:s");
        echo "\" />";
        echo "<input type=\"hidden\" name=\"datetime\" value=\"";
        print date("YmdHis");
        echo "\" />";
        echo "<input type=\"hidden\" name=\"albumid\" value=\"$row[0]\">";
        echo "<input type=\"hidden\" name=\"artist\" value=\"$row[5]\">";
        echo "<input type=\"hidden\" name=\"song\" value=\"$track_row[3]\">";
        echo "<input type=\"hidden\" name=\"section\" value=\"$section\">";
        echo "<input type=\"hidden\" name=\"sectionnumber\" value=\"$row[2]\">";
        echo "<input type=\"hidden\" name=\"album\" value=\"$row[4]\">";
        echo "<input type=\"hidden\" name=\"label\" value=\"$row[6]\">";
        echo "<input type=\"hidden\" name=\"tracknumber\" value=\"$track_row[2]\">";
        echo "<input type=\"hidden\" name=\"trackid\" value=\"$track_row[0]\">";
        echo "<input type=\"hidden\" name=\"listeners\" value=\"$listeners\">";
        echo "<input type=\"hidden\" name=\"requested\" value=\"0\">";
        echo "<input type=\"image\" class=\"smallimg\" width=12 src=\"../images/play.png\">";
        echo "</form>";
        echo "<br>";
    }

    /*
    $similar_xml = get_similar($row[5], 10);
    echo "</td></tr><tr class='headers' align='center'><td align='center' colspan='2'><br><b>Similar Artists</b><br>";
    if($similar_xml){
    foreach ($similar_xml->similarartists->artist as $sartist){
    $art = $sartist->name;
    
    $query = mysql_query("SELECT count(*)  FROM albums WHERE artist='" . mysql_real_escape_string($art) . "'");
    $count = mysql_fetch_row($query);
    if($count[0]>0){
    $found = true;
    echo " <a href=index.php?artist=" . urlencode($art) . ">" . $art . "</a> ";
    }
    }
    if(!$found){
    echo "No similar artists in our collection.";
    }
    
    }
    else{
    echo "No similar artists found";
    }
    
    echo "</td></tr></table></center><br>";
    */
    echo "</td></tr><tr class='headers' align='center'><td align='center' colspan='2'><br><b>Similar Artists</b><br>";
    $sim_query = "select sim_artist from catalog_similar where artist='$row[5]' and sim_artist in (select distinct(artist) from catalog_albums)";
    $res = mysql_query($sim_query) or die("Database Error");
    
    if (mysql_num_rows($res) > 0) {
        
        while ($row = mysql_fetch_array($res)) {
            echo " <a href=index.php?artist=" . urlencode($row[0]) . ">" . $row[0] . "</a> ";
        }
    }
    else {
        echo "No Similar Artists Found";
    }
    echo "</td></tr></table></center><br>";
}
else {
    echo "<table border='0' width='75%'>";
    echo "<tr>";
    
    foreach (range('A', 'Z') as $i) {
        echo "<td>";
        echo "<a href=?letter=" . $i . "><b>" . $i . "</b></a>";
        echo "</td>";
    }
    echo "</tr>";
    echo "</table>";
    
    if (isset($_GET['letter'])) {
        $letter = mysql_real_escape_String($_GET['letter']);
        $total_query = mysql_query("SELECT * FROM catalog_albums WHERE artist LIKE '" . $letter . "%'");
        $total = mysql_num_rows($total_query);
        
        if (isset($_GET['start'])) {
            $start = mysql_real_escape_string($_GET['start']);
        }
        else {
            $start = 0;
        }
        $album_query = mysql_query("SELECT * FROM catalog_albums WHERE artist LIKE '" . $letter . "%' ORDER BY artist ASC LIMIT " . $start . "," . $page_limit) or die(mysql_error());
        echo "<table>";
        
        while ($row = mysql_fetch_row($album_query)) {
            echo "<tr>";
            echo "<td><a href=\"?id=" . $row[0] . "\">" . $row[1] . $row[2] . "</a></td><td>" . $row[4] . "</td><td>" . $row[3] . "</td>";
            echo "</tr>";
        }
        echo "</table>";
        $shown = $start + $page_limit;
        $back = $start - $page_limit;
        echo "<center>";
        
        if ($start > 0) {
            echo "<a href=\"?letter=" . $letter . "&start=" . $back . "\"><-Back </a>";
        }
        
        if ($shown < $total) {
            echo "<a href=\"?letter=" . $letter . "&start=" . $shown . "\"> Forward-> </a>";
        }
        echo "</center>";
    }
}

if (!isset($_SESSION['dj_logged_in'])) {
    include ("../../footer.php");
}
?>
./catalog/menu.php
<?php
session_start();
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
require ("../../config.php");
require ("../include/functions.php");
require ("../include/header.php");

if (isset($_SESSION['dj_logged_in'])) {
    echo '<center><br /><table width="600"> <tr><td>
	<center>

	<table class="welcomebar">
	<tr>
	<td class="date">
	Catalog
	</td>
	<td class="loggedin">
	You\'re logged in as ';
    echo $user_info['username'];
    echo '
	<a href="../login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
	</td>
	</tr>
	</table>';
    echo '<center><table align="center" width="650"><tr><td class="headers" align="center">
	<a href="index.php">Lookup in our catalog</a>';
    
    if ($user_info['permissions'] >= 2) {
        echo '<br>
		<a href="search.php">Add albums from Amazon</a>
		<br>
		<a href="add.php">Add album manually</a>
		<br>
		<a href="category_manage.php">Manage Categories</a>
		</center></td></table>
		<br>';
    }
}
else {
    echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
?>
./catalog/category_manage.php
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
<?php
include ("../../config.php");
include ("../include/header.php");

function show_table() {
    global $root;
    
    if (isset($_GET['ord'])) {
        $ord = mysql_real_escape_string($_GET['ord']);
    }
    else {
        $ord = 'prefix';
    }
    
    if ($_GET['dir'] == "ASC") {
        $dir = 'ASC';
        $dir_link = 'DESC';
    }
    else {
        $dir = 'DESC';
        $dir_link = 'ASC';
    }

    //DISPLAY ADD FORM
    echo "<center><form name=add>Prefix:<input name='prefix' size='2'>Name:<input name='name'><input type='submit' value='add'></form></center>";

    //DISPLAY A TABLE OF THE USERS.
    $query = "SELECT id, prefix,name FROM catalog_categories ORDER BY $ord $dir";
    $res = mysql_query($query) or die(mysql_error());
    echo "<center><table class='usertablemain'><tr class='headers'><td><a href=?ord=prefix&dir=$dir>Prefix</a></td><td><a href=?ord=name&dir=$dir>Name</td><td><a href=?ord=$ord&dir=$dir_link>$dir</a></td></tr>";
    
    while ($row = mysql_fetch_assoc($res)) {
        echo "<tr>";
        echo "<td>" . $row['prefix'] . "</td>";
        echo "<td>" . $row['name'] . "</td>";
        echo "<td><a href='?del=" . $row['id'] . "'>Delete</a> ";
        echo "</td></tr>";
    }
    echo "</table></center>";
}

if (isset($_GET['prefix'])) {

    //ADD A NEW CATEGORY
    $pre = mysql_real_escape_string($_GET['prefix']);
    $name = mysql_real_escape_string($_GET['name']);
    $query = "INSERT INTO catalog_categories (prefix,name) VALUES('$pre','$name')";
    $res = mysql_query($query) or die(mysql_error());
    
    if (mysql_affected_rows() < 1) {
        echo "Query failed to modify any rows";
    }
    else {
        echo "Category Added";
    }
    show_table();
}
else 
if (isset($_GET['del'])) {

    //DELETE THE CATEGORY
    $id = mysql_real_escape_string($_GET['del']);
    $query = "DELETE FROM catalog_categories WHERE id=$id";
    $res = mysql_query($query) or die(mysql_error());
    
    if (mysql_affected_rows() < 1) {
        echo "Query failed to modify any rows";
    }
    else {
        echo "Category Deleted";
    }
    show_table();
}
else {
    show_table();
}
?>
./catalog/search.php
<?php
session_start();
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
require_once ("../../config.php");
require_once ("../include/functions.php");
include ("../include/header.php");
echo "<center>";

if ($user_info['permissions'] >= 2) {
    global $amazon_public_key, $amazon_private_key;
    
    if (isset($_GET['UPC'])) {
        require_once ("../include/catalog_functions.php");
        $upc = mysql_real_escape_string($_GET['UPC']);

        //get ready for adding to database
        
        if (isset($_GET['submit_add'])) {
            $insert = true;
            $cat = mysql_real_escape_string($_GET['cat']);
        }
        else {
            $insert = false;
        }
        
        if (isset($_GET['char'])) {
            $cat_letter = mysql_real_escape_string($_GET['char']);
        }
        else {
            $cat_letter = "";
        }
        
        if (isset($_GET['page'])) {
            $page = mysql_real_escape_string($_GET['page']);
        }
        else {
            $page = 1;
        }

        //echo $page;
        $pxml = aws_signed_request("com", array(
            "Operation" => "ItemSearch",
            "SearchIndex" => "Music",
            "Keywords" => $upc,
            "ItemPage" => $page,
            "ResponseGroup" => "Large"
        ) , $amazon_public_key, $amazon_private_key);

        //$pxml = aws_signed_request("com", array("Operation"=>"ItemLookup","ItemId"=>"B000I2IR46","ResponseGroup"=>"Large"), $public_key, $private_key);
        //print_r ($pxml);

        
        if ($pxml === False) {
            echo "Album not found";
        }
        else {

            //If there is more than one result from the search, show table to choose from.
            
            if (sizeof($pxml->Items->Item) > 1) {
                echo "<center><table class='addtablemain' cellpadding='0' border='0' width='800'><tr>";
                $count = 0;
                
                foreach ($pxml->Items->Item as $album) {
                    
                    if ($album->ItemAttributes->UPC != "") {
                        
                        if ($count % 2 == 0) {
                            echo "<tr>";
                        }
                        $count+= 1;
                        
                        if ($pxml->Items->Item->LargeImage->URL != "") {
                            $image = $album->LargeImage->URL;
                        }
                        else {
                            $image = '../images/CD.png';
                        }
                        echo "<td width='400'><center><a href='search.php?UPC=" . $album->ItemAttributes->UPC . "'><img width='150' src='" . $image = $album->LargeImage->URL . "'></a><br>";
                        echo $album->ItemAttributes->Artist . "<br>" . $album->ItemAttributes->Title . "</center></td>";
                        
                        if ($count % 2 == 0) {
                            echo "</tr>";
                        }
                    }
                }
                echo "<tr><td colspan='2' align='center'>";
                
                if ($page > 1) {
                    $ppage = $page - 1;
                    echo "<a href='search.php?UPC=" . $upc . "&page=" . $ppage . "'><--- Previous Page</a>";
                }
                
                if ($page < $pxml->Items->TotalPages) {
                    $npage = $page + 1;
                    echo "<a href='search.php?UPC=" . $upc . "&page=" . $npage . "'>   Next Page ---></a><br>";
                }
                echo "</td></tr></table>";
            }
            else {
                
                if (isset($pxml->Items->Item->ItemAttributes->Title)) {
                    $image = $pxml->Items->Item->LargeImage->URL;
                    $artist = $pxml->Items->Item->ItemAttributes->Artist;
                    $title = $pxml->Items->Item->ItemAttributes->Title;
                    $label = $pxml->Items->Item->ItemAttributes->Label;
                    $discs = $pxml->Items->Item->ItemAttributes->NumberOfDiscs;
                    $release = $pxml->Items->Item->ItemAttributes->ReleaseDate;
                    $upc2 = $pxml->Items->Item->ItemAttributes->UPC;
                    $desc = "";
                    
                    if (!$insert) {

                        //$pxml->Items->Item->EditorialReviews->EditorialReview->Content;
                        echo "<center><table class='catalogtablemain'><tr><td align='center'>";
                        echo '<img src="' . $image . '"></img><br></td><td>';
                        echo "<b>ARTIST:</b> ", $artist, "<br>";
                        echo "<b>TITLE:</b> ", $title, "<br>";
                        echo "<b>LABEL:</b> ", $label, "<br>";
                        echo "<b>DISCS:</b> ", $discs, "<br>";
                        echo "<b>RELEASE:</b> ", $release, "<br>";
                        echo "<b>UPC:</b> ", $upc2, "<br>";

                        //echo "<b>Description:</b> ",$desc,"<br>";
                        echo "<br><br>";
                    } //end if

                    else {
                        echo "Adding Album";

                        //insert album into db
                        
                        if ($cat != 5) {
                            $res = mysql_query("SELECT MAX(Category_Number) FROM catalog_albums WHERE Category_ID='" . $cat . "'") or die(mysql_error());
                            $cat_letter = '';
                        }
                        else {
                            $res = mysql_query("SELECT MAX(Category_Number) FROM catalog_albums WHERE Category_ID='" . $cat . "' AND vinyl_letter='" . $cat_letter . "'") or die(mysql_error());
                        }
                        $row = mysql_fetch_row($res);
                        $cat_num = $row[0];
                        $cat_num++;
                        $query = "INSERT INTO catalog_albums VALUES('','" . mysql_real_escape_string($cat) . "','" . mysql_real_escape_string($cat_num) . "','" . $cat_letter . "','" . mysql_real_escape_string($title) . "','" . mysql_real_escape_string($artist) . "','" . mysql_real_escape_string($label) . "','" . mysql_real_escape_string($upc) . "','" . mysql_real_escape_string($release) . "','" . mysql_real_escape_string($discs) . "','" . mysql_real_escape_string($image) . "','" . mysql_real_escape_string($desc) . "','',NOW(),'0','" . $user_info['username'] . "[AMAZON_ADD];" . "','')";
                        echo $query;
                        mysql_query($query) or die(mysql_error());

                        //Get the albumid that was used during the input, for track input
                        $result = mysql_query("SELECT ID FROM catalog_albums WHERE UPC='" . $upc . "' AND Category_ID='" . $cat . "' AND Category_Number='" . $cat_num . "'") or die(mysql_error());

                        //echo "SELECT ID FROM albums WHERE UPC='" . $upc . "' AND Category_ID='" . $cat . "' AND Category_Number='" . $cat_num . "'";
                        $row = mysql_fetch_row($result);
                        $album_id = $row[0];
                    } //end else

                    //echo sizeof($pxml->Items->Item->Tracks->Disc)."<----";

                    
                    if (sizeof($pxml->Items->Item->Tracks->Disc) > 0) {
                        
                        foreach ($pxml->Items->Item->Tracks->Disc as $disc) {
                            $disc_number = $disc->attributes()->Number;
                            
                            if (!$insert) {
                                echo "<b>Disc:</b> " . $disc_number . "<br>";
                            }
                            
                            foreach ($disc->Track as $track) {
                                $track_number = $track->attributes()->Number;
                                
                                if (!$insert) {
                                    echo "<b>" . $track_number . ".</b> " . $track . "<br>";
                                }
                                else {
                                    $len = "00:00";
                                    mysql_query("INSERT INTO catalog_tracks(album_id,position,title,cd_number,length) VALUES('" . $album_id . "','" . mysql_real_escape_string($track_number) . "','" . mysql_real_escape_string($track) . "','" . mysql_real_escape_string($disc_number) . "','" . mysql_real_escape_string($len) . "')") or die(mysql_error());

                                    //echo "INSERT INTO tracks(album_id,position,title,cd_number,length) VALUES('" . $album_id . "','" . mysql_real_escape_string($track_number) . "','" . mysql_real_escape_string($track) . "','" . mysql_real_escape_string($disc_number) . "','" . mysql_real_escape_string($len) . "')";
                                    
                                } //end else

                                
                            } //end foreach

                            
                        } //end foreach

                        
                    } //end if

                    else {
                        echo "No Tracks Found<br>";
                    }
                } //end if xml isset

                else {
                    echo "Could not find item.\n";
                } //end else

                
                if (!$insert) {
                    echo "<br><form method='get' action='search.php'>
					Category: <select name='cat'>";
                    $res = mysql_query("SELECT DISTINCT(name), id FROM catalog_categories") or die(mysql_error());
                    
                    while ($row = mysql_fetch_row($res)) {
                        echo "<option value='$row[1]'>$row[0]</option>";
                    } //end while

                    echo "</select>
					<input type='hidden' name='submit_add' value='1'>
					<input type='hidden' name='UPC' value='" . $upc . "'>
					<input type='text' size='1' onChange='javascript:this.value=this.value.toUpperCase().trim();' autocomplete='off' maxlength='1' name='char'>
					<input type='submit' value='Add'>
					</form>";
                } //end if

                else {
                    echo "<meta HTTP-EQUIV='REFRESH' content='0; url=$root/arcums/catalog/view.php?id=" . $album_id . "'>";
                }
            } //end else

            
        } //end else

        //show the category dropdown and add button

        
    }
    else {
        echo '<form method="GET" action=search.php>UPC or Keywords:<input type="text" size="12"  name="UPC"><input type="submit" value="submit"></form>';
    }
    echo "</center>";
}
else {
    echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
?>
./catalog/edit.php
<?php
session_start();
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>
<body>

<?php
require_once("../..//config.php");
require_once("../include/functions.php");
include("../include/header.php");
echo '<center>';
if(isset($_SESSION['dj_logged_in']) && $user_info['permissions'] >= 2){
	if(isset($_GET['id'])){
		$id = mysql_real_escape_string($_GET['id']);
	}
	else{
		echo "ID not set";
		die();
	}

	if(!isset($_POST['Edit'])){ //show the form
		$query=mysql_query("SELECT * FROM catalog_albums WHERE id='" . $id . "'");

		if(mysql_num_rows($query) == 1){
			$row=mysql_fetch_array($query);
			$track_query = mysql_query("SELECT * FROM catalog_tracks WHERE album_id='" .$id . "' ORDER BY cd_number ASC , position ASC") or die(mysql_error());
			$cat = $row['category_id'];
		?>
	<table  class='catalogtablemain'>
	<tr><td>
			<form method='POST' action='edit.php?id=<? echo $id ?>'>
			<input type='HIDDEN' name='Edit' value=1>
			<input type='HIDDEN' name='history' value='<? echo$row['history']; ?>'>
			<b>Title:</b><input type='TEXT' name='Title'  value='<?echo $row['title']; ?>'><br>
			<b>Artist:</b><input type='TEXT' name='Artist'  value='<?echo $row['artist']; ?>'><br>
			<b>Label:</b><input type='TEXT' name='Label'  value='<?echo $row['label']; ?>'><br>
			<b>UPC:</b><input type='TEXT' name='UPC'  value='<?echo $row['upc']; ?>'><br>
			<b>Release:</b><input type='TEXT' size=10 name='Release' ReadOnly  value='<? echo $row['release']; ?>'><br>
			<b>Discs:</b><select name="Discs">
				<option value='1' <? if($row['discs']==1){echo "SELECTED";} ?>>1</option>
				<option value='2' <? if($row['discs']==2){echo "SELECTED";} ?>>2</option>
				<option value='3' <? if($row['discs']==3){echo "SELECTED";} ?>>3</option>
				<option value='4' <? if($row['discs']==4){echo "SELECTED";} ?>>4</option>
				<option value='5' <? if($row['discs']==5){echo "SELECTED";} ?>>5</option>
			</select><br>
			<b>Image:</b><input type='TEXT' name='Image'  value='<?echo $row['image']; ?> '><br>
			<b>Category:</b><select name='cat'>
			<?
				$selected = "";
				$res = mysql_query("SELECT DISTINCT(name), id FROM catalog_categories ORDER BY name ASC") or die(mysql_error());
				while($r= mysql_fetch_row($res)){
					echo $cat;
					if($cat == $r[1]){
						$selected = "SELECTED";
					}	
					else{
						$selected="";
					}
					echo "<option value='$r[1]' $selected>$r[0]</option>";
				}//end while
			?>				
	</select><br>			
			<b>Category Number: </b><input type='TEXT' name='cat_number' value='<?echo $row['category_number']; ?>'?<br>
			<!--<b>Description</b><input type='TEXT' name='Description'  value='<? echo $row[11]; ?>'><br>-->
			<!--<b>Comments:</b><input type='TEXT' name='Comments'  value='<? echo $row[12]; ?>'><br>-->
	</td><td>
	<b>Tracks:</b><br>
	<?
	echo "<textarea name='Tracks' cols='40' rows='10'>";
	$num=0;
	$cd_num=1;
	while($track_row = mysql_fetch_array($track_query)){
		if($num!=0){
			echo ",";
		}
		if($cd_num != $track_row['cd_number']){
			echo ";";
			$cd_bum=$track_row[4];
		}	
		echo $track_row['title'] . "[" . $track_row['length'] . "]";
		$num++;

	}	
	echo "</textarea>";
	if($row['vinyl']==1){
		$sel = "SELECTED";
	}
	else{
		$sel = "";
	}
	?>
	</td></tr><tr><td colspan=2 align='center'>
	Vinyl?<select name="vinyl">
		<option value=0>No</option>
		<option value=1 <? echo $sel ?>>Yes</option>
	</select>
	Alphabetical Character: <input type='text' size='1' maxlength='1' name='char' value="<? echo $row['vinyl_letter'] ?>"><br>
			<input type='Submit' value='Update'>
	</tr></td></table></form>
		<?	
		}
		else{
			echo "Invalid ID";
			die();
		}
	}
	else{ //Do the updating!
		$a_title = trim(mysql_real_escape_string($_POST['Title']));
		$history = trim(mysql_real_escape_string($_POST['history']));
		$history = $history . mysql_real_escape_string($user_info['username']."[EDIT];");
		$artist = trim(mysql_real_escape_string($_POST['Artist']));
		$label = trim(mysql_real_escape_string($_POST['Label']));
		$upc = trim(mysql_real_escape_string($_POST['UPC']));
		$release = trim(mysql_real_escape_string($_POST['Release']));
		$disc_count = trim(mysql_real_escape_string($_POST['Discs']));
		$image =  trim(mysql_real_escape_string($_POST['Image']));
		$description = trim(mysql_real_escape_string($_POST['Description']));
		$comments = trim(mysql_real_escape_string($_POST['Comments']));
		$vinyl = trim(mysql_real_escape_string($_POST['vinyl']));
		$char = trim(mysql_real_escape_string($_POST['char']));
		$catn = trim(mysql_real_escape_string($_POST['cat_number']));
		$cat = mysql_real_escape_string($_POST['cat']);

	//echo "DELETE FROM tracks WHERE album_id='".$id."'";
	mysql_query("DELETE FROM catalog_tracks WHERE album_id='".$id."'");
	$discs = explode(";",$_POST['Tracks']);
	$disc_pos=1;
	$track_pos=1;
	foreach($discs as $disc){
		$disc_number = $disc_pos;
		$tracks = explode(",",$disc);	
		foreach($tracks as $track){
			$lb = strrpos($track,"[");
			//echo "<br>" . $lb . "<br>";
			if($lb>0){
				$rb = strrpos($track,"]");
				//echo($rb);
				$title= substr($track,0,$lb);
				//echo $title;
				$len_size = $rb - $lb - 1;
				$len = substr($track,$lb+1,$len_size);	
				//echo " " . $len . "<br>";			
			}
			else{
				$title = $track;
				$len = "00:00";
			}
			//echo 	"INSERT INTO tracks(album_id, position, title, cd_number, length) VALUES('" . $id ."','" .$track_pos. "','" . $title . "','" . $disc_pos . "','" . $len . "')";
	
			mysql_query("INSERT INTO catalog_tracks(album_id, position, title, cd_number, length) VALUES('" . $id ."','" .$track_pos. "','" . $title . "','" . $disc_pos . "','" . $len . "')") or die(mysql_error());
			$track_pos++;
		}
		$disc_pos++;
	}


	echo "<br><br>";
	mysql_query("UPDATE catalog_albums SET Title=\"" . $a_title . "\",Artist=\"" . $artist . "\",category_id=\"" . $cat . "\",category_number=\"" . $catn . "\",Label=\"" . $label . "\" ,UPC=\"" . $upc . "\",Discs=\"" . $disc_count . "\",Image=\"" . $image . "\",Description=\"" . $description . "\",Comments=\"" . $comments . "\",Vinyl=\"" . $vinyl . "\", vinyl_letter=\"" . $char . "\",History=\"" . $history . "\" WHERE id=\"" . $id . "\"") or die(mysql_error());
echo '<meta HTTP-EQUIV="REFRESH" content="0; url=view.php?id=' . $id . '">';

	}

	echo '</center>';
}
else{
	echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}

?>
./catalog/add.php
<?php
session_start();
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>
<body>

<?
require_once ("../../config.php");
require_once ("../include/functions.php");
require_once ("../include/header.php");

echo '<center>';

if (isset($_SESSION['dj_logged_in']) && $user_info['permissions'] >= 2) {
    
    if (!isset($_GET['add'])) { //show the form

        
?>
	<table  class='catalogtablemain'>
	<tr><td>
			<form method='POST' action='add.php?add=1'>
			<input type='HIDDEN' name='Edit' value=1>
			<b>Title:</b><input type='TEXT' name='Title'  value=''><br>
			<b>Artist:</b><input type='TEXT' name='Artist'  value=''><br>
			<b>Label:</b><input type='TEXT' name='Label'  value=''><br>
			<b>UPC:</b><input type='TEXT' name='UPC'  value=''><br>
			<b>Release:</b><input type='TEXT' size=10 name='Release'  value=''><br>
			<b>Image:</b><input type='TEXT' name='Image'  value=''><br>
			<b>Description</b><input type='TEXT' name='Description'  value=''><br>
			<b>Comments:</b><input type='TEXT' name='Comments'  value=''><br>
	</td><td>
	<b>Tracks:</b><br>
	<textarea name='Tracks' cols='40' rows='10'></textarea>
	</td></tr><tr><td colspan=2 align='center'>
	Category: <select name='cat'>
	<?
        $res = mysql_query("SELECT DISTINCT(name), id FROM catalog_categories ORDER BY name ASC") or die(mysql_error());
        
        while ($row = mysql_fetch_row($res)) {
            echo "<option value='$row[1]'>$row[0]</option>";
        } //end while

        
?>
	</select>
	<input type='hidden' name='submit_add' value='1'>
	<input type='hidden' name='UPC' value=''>
	Vinyl?<select name='isVinyl'><option value='0'>No</option><option value='1'>Yes</option></select> 
	Alphabetical Character: <input type='text' size='1' maxlength='1' name='char'><br>
	<input type='submit' value='Add'>
	</form>
	</tr></td></table></form>
	
	<?
    } //end !isset($add)

    else { //Do the adding!

        $title = mysql_real_escape_string($_POST['Title']);
        $artist = mysql_real_escape_string($_POST['Artist']);
        $label = mysql_real_escape_string($_POST['Label']);
        $upc = mysql_real_escape_string($_POST['UPC']);
        $release = mysql_real_escape_string($_POST['Release']);
        $image = mysql_real_escape_string($_POST['Image']);
        $description = mysql_real_escape_string($_POST['description']);
        $comments = mysql_real_escape_string($_POST['Comments']);
        $cat = mysql_real_escape_string($_POST['cat']);
        $cat_letter = mysql_real_escape_string($_POST['char']);
        $vinyl = mysql_real_escape_string($_POST['isVinyl']);
        
        if ($vinyl != 1) {
            $res = mysql_query("SELECT MAX(Category_Number) FROM catalog_albums WHERE Category_ID='" . $cat . "'") or die(mysql_error());
            $cat_letter = '';
        }
        else {
            $res = mysql_query("SELECT MAX(Category_Number) FROM catalog_albums WHERE Category_ID='" . $cat . "' AND vinyl_letter='" . $cat_letter . "'") or die(mysql_error());
        }
        $row = mysql_fetch_row($res);
        $cat_num = $row[0];
        $cat_num++;
        $query = "INSERT INTO albums VALUES('','" . $cat . "','" . $cat_num . "','" . $cat_letter . "','" . $title . "','" . $artist . "','" . $label . "','" . $upc . "','" . $release . "','" . $discs . "','" . $image . "','" . $desc . "','',NOW(),'" . $vinyl . "','" . $user_info['username'] . "[MANUAL_ADD];','')";
        mysql_query($query) or die("Error Adding Album");
        echo $query;

        //get album id
        $query = "SELECT ID FROM catalog_albums WHERE Category_ID='" . $cat . "' AND Category_Number='" . $cat_num . "' AND vinyl_letter LIKE '" . $cat_letter . "'";
        echo $query;
        $result = mysql_query($query) or die(mysql_error());
        $row = mysql_fetch_row($result);
        print_r($row);
        $album_id = $row[0];
        echo $album_id;

        //mysql_query($query) or die(mysql_error());
        //add tracks

        $discs = split(";", $_POST['Tracks']);
        $disc_pos = 1;
        $track_pos = 1;
        
        if (sizeof($discs) > 0) {
            
            foreach ($discs as $disc) {
                $disc_number = $disc_pos;
                $tracks = split(",", $disc);
                
                foreach ($tracks as $track) {
                    $lb = strrpos($track, "[");
                    
                    if ($lb) {
                        $rb = strrpos("]", $track);
                        $title = substr($track, 0, $lb);
                        $len = substr($track, $lb + 1, $rb - 1);
                    }
                    else {
                        $title = $track;
                        $len = "00:00";
                    }
                    
                    if ($title != "") {
                        $track_query = "INSERT INTO catalog_tracks(album_id, position, title, cd_number, length) VALUES('" . $album_id . "','" . $track_pos . "','" . $title . "','" . $disc_pos . "','" . $len . "')";
                        echo $track_query;
                        mysql_query($track_query) or die(mysql_error());
                        $track_pos++;
                    }
                }
                $disc_pos++;
            }
        }
        echo '<meta HTTP-EQUIV="REFRESH" content="0; url=view.php?id=' . $album_id . '">';
    } //end else

    echo '</center>';
} //end if logged it

else {
    echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
?>
./catalog/get_similar.php
<?php

require_once("../../config.php");
require_once("../include/catalog_functions.php");

if(isset($argv[1])){
        $artist = mysql_real_escape_string($argv[1]);
        $query = "SELECT DISTINCT(artist) FROM albums WHERE artist = '$artist'";
        $res = mysql_query($query) or die(mysql_error());

}
else if(isset($_GET['artist'])){
	$artist = mysql_real_escape_string($_GET['artist']);
	$query = "SELECT DISTINCT(artist) FROM albums WHERE artist = '$artist'";
	$res = mysql_query($query) or die(mysql_error());
	
}
else {
	$query = "SELECT DISTINCT(artist),similar_cache_date FROM albums WHERE similar_cache_date <= SUBDATE(NOW(), INTERVAL 31 DAY)";
	$res = mysql_query($query) or die(mysql_error());
}

while($row = mysql_fetch_array($res)){
	echo $row[0] . " (" . date('Y-m-d') .")\n";
	$art1 = mysql_real_escape_string($row[0]);

        $query = "DELETE FROM similar WHERE artist='$art1'";
        mysql_query($query) or die(mysql_query());


	$similar_xml = get_similar($row[0], 10);
		if($similar_xml){
			foreach ($similar_xml->similarartists->artist as $sartist){
				$art = mysql_real_escape_string($sartist->name);
				echo "\t $art \n";
					$query = "INSERT INTO similar VALUES('$art1','$art')" or die(mysql_error());
					mysql_query($query) or die(mysql_error());
			}
		}

	$query = "UPDATE albums SET similar_cache_date=NOW() WHERE artist = '$art1'";
	mysql_query($query) or die(mysql_error());
}


?>

./catalog/reqpost.php
<?php
require("../../header.php");
require("../../config.php");

$albumid = mysql_real_escape_string($_POST["albumid"]);
$trackid = mysql_real_escape_string($_POST["trackid"]);
$datetime = date("YmdHis");

$query = "INSERT INTO request(album_id,track_id,datetime) VALUES('$albumid','$trackid','$datetime')";
mysql_query($query) or die("There was an error processing your request");

echo "Your request has been recorded.";

include("../../footer.php");	
?>

./catalog/index.php
<?php
session_start();
require ("../../config.php");
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
</head>

<body>

<?

if (isset($_SESSION['dj_logged_in'])) {
    include ("../include/header.php");
    echo '<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />';
    require_once ("../include/functions.php");
    require_once ('../include/catalog_functions.php');
}
else {
    include ("../../header.php");
    echo '<link href="" rel="stylesheet" type="text/css"';
}
$page_limit = 300;
?>
<br>
<center>
<table class="headers"><tr><td>
<form method="GET" action="index.php" name='searchform'">
<?

if (isset($_GET['artist'])) {
    $s_artist = mysql_real_escape_string($_GET['artist']);
}
else {
    $s_artist = "";
}

if (isset($_GET['title'])) {
    $s_title = mysql_real_escape_string($_GET['title']);
}
else {
    $s_title = "";
}

if (isset($_GET['track'])) {
    $s_track = mysql_real_escape_string($_GET['track']);
}
else {
    $s_track = "";
}
?>
<center>
Artist: <input class='searchbox' type="text" name="artist" value="<? echo $s_artist; ?>" onChange="document.searchform.submit()">  Title: <input class='searchbox' type="text" name="title" value="<? echo $s_title; ?>" onChange="document.searchform.submit()"><br>  <center>Track Title: <input class='searchbox' type="text" name="track" value="<? echo $s_track; ?>" onChange="document.searchform.submit()">
</center>
Category: <select name='cat' onChange="document.searchform.submit()">
<?
echo "<option value='%'>Any</option>";
$res = mysql_query("SELECT DISTINCT(name), id FROM catalog_categories ORDER BY name ASC") or die(mysql_error());

while ($row = mysql_fetch_array($res)) {
    echo $row[1];
    
    if ($row[1] == mysql_real_escape_string($_GET['cat'])) {
        $selected = "SELECTED";
    }
    else {
        $selected = "";
    }
    echo $selected;
    echo "<option value='$row[1]' $selected>$row[0]</option>";
} //end while


?>
<input type='submit' value='Submit'>
</select>
</center>
</form>
</td></tr></table>



<?

if (isset($_GET['artist']) || isset($_GET['title'])) {
    
    if (isset($_GET['start'])) {
        $start = mysql_real_escape_string($_GET['start']);
        
        if ($start == "") {
            $start = "0";
        }
    }
    else {
        $start = "0";
    }
    
    if (isset($_GET['artist'])) {
        $artist = mysql_real_escape_string($_GET['artist']);
    }
    else {
        $artist = "%";
    }
    
    if (isset($_GET['title'])) {
        $title = mysql_real_escape_string($_GET['title']);
    }
    else {
        $title = "%";
    }
    
    if (isset($_GET['track'])) {
        $track = mysql_real_escape_string($_GET['track']);
    }
    else {
        $track = "";
    }
    
    if (isset($_GET['cat'])) {
        $cat_id = mysql_real_escape_string($_GET['cat']);
    }
    else {
        $cat_id = "%";
    }
    
    if (isset($_GET['dir']) && $_GET['dir'] == "DESC") {
        $dir = mysql_real_escape_string($_GET['dir']);
        $odir = "ASC";
    }
    else {
        $dir = "ASC";
        $odir = "DESC";
    }
    
    if (isset($_GET['order'])) {
        $order = mysql_real_escape_string($_GET['order']);
        
        if ($order == 2) {
            $order_s = "artist";
        }
        else 
        if ($order == 3) {
            $order_s = "title";
        }
        else {
            $order_s = "vinyl $dir, vinyl_letter $dir, category_id $dir, category_number";
        }
    }
    else {
        $order = 1;
        $order_s = "vinyl $dir, vinyl_letter $dir, category_id $dir, category_number";
    }
    $bg = "<TR bgcolor=\"#ededed\" onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#ededed';\">\n";

    //$query is the query for the albums themselvs, c_query is the query for the total count
    $query = "SELECT DISTINCT * FROM catalog_albums  WHERE artist LIKE '%" . $artist . "%' AND title LIKE '%" . $title . "%' AND category_id LIKE '" . $cat_id . "' ORDER BY " . $order_s . " " . $dir . " LIMIT " . $start . "," . $page_limit;
    $c_query = "SELECT DISTINCT * FROM catalog_albums  WHERE artist LIKE '%" . $artist . "%' AND title LIKE '%" . $title . "%' AND category_id LIKE '" . $cat_id . "'";
    $list_tracks = false;
    
    if ($track != "") {
        $query = "SELECT DISTINCT catalog_albums.* , catalog_tracks.position, catalog_tracks.title FROM catalog_tracks INNER JOIN catalog_albums ON catalog_albums.id=catalog_tracks.album_id WHERE catalog_albums.artist LIKE '%" . $artist . "%' AND catalog_albums.title LIKE '%" . $title . "%' AND catalog_tracks.title LIKE '%" . $track . "%' AND catalog_albums.category_id LIKE '" . $cat_id . "'ORDER BY catalog_albums." . $order_s . " " . $dir . " LIMIT " . $start . "," . $page_limit;
        $c_query = "SELECT DISTINCT catalog_albums.* , catalog_tracks.position, catalog_tracks.title FROM catalog_tracks INNER JOIN catalog_albums ON catalog_albums.id=catalog_tracks.album_id WHERE catalog_albums.artist LIKE '%" . $artist . "%' AND catalog_albums.title LIKE '%" . $title . "%' AND catalog_tracks.title LIKE '%" . $track . "%' AND catalog_albums.category_id LIKE '" . $cat_id . "'";
        $list_tracks = true;
    }
    $album_query = mysql_query($query) or die(mysql_error());
    $c = mysql_query($c_query) or die(mysql_error());
    $total = mysql_num_rows($c);
    $dir_change = "<a href=\"?artist=" . $artist . "&title=" . $title . "&track=" . $track . "&cat=" . $cat_id . "&start=" . $start . "&order=" . $order . "&dir=" . $odir . "\"><img width='15' src='../images/$dir.png'></a>";
    echo "<table cellspacing='0' cellpadding='10'><tr class='headers' bgcolor='black'>";
    echo "<td> <a href=\"?artist=" . $artist . "&title=" . $title . "&track=" . $track . "&cat=" . $cat_id . "&start=" . $start . "&order=1 \"><b>Catalog Number</b></a>  </td><td>  <a href=\"?artist=" . $artist . "&title=" . $title . "&track=" . $track . "&cat=" . $cat_id . "&start=" . $start . "&order=2 \"><b>Artist</b></a> </td><td> <a href=\"?artist=" . $artist . "&title=" . $title . "&track=" . $track . "&cat=" . $cat_id . "&start=" . $start . "&order=3 \"><b>Album</b></a> </td><td align='right'>" . $dir_change . "</td></tr>";
    
    while ($row = mysql_fetch_array($album_query)) {
        
        if ($bg == "<TR bgcolor=\"#ededed\" onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#ededed';\"") {
            $bg = "<TR bgcolor=\"#84C8FF\"  onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#84C8FF';\"";
        }
        else {
            $bg = "<TR bgcolor=\"#ededed\" onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#ededed';\"";
        }
        echo $bg . "onclick=\"DoNav('" . "view.php?id=" . $row['ID'] . "');\">\n";
        $cat_query = mysql_query("SELECT prefix FROM catalog_categories WHERE id='" . $row['category_id'] . "'");
        echo "<td>";
        $cat_result = mysql_fetch_array($cat_query);
        
        if ($row[14] == 1) {
            $v = " V-";
        }
        else {
            $v = "";
        }
        echo "<b><a href=\"view.php?id=" . $row['ID'] . "\"><font color='blue'>" . $cat_result['prefix'] . $v . $row['vinyl_letter'] . " " . $row['category_number'] . "<font></a></b></td><td><font color=black>" . $row['artist'] . "</font></td><td><font color='black'>" . $row[4] . "</font>";
        
        if ($list_tracks) {
            echo "<br><font size='1'>" . $row['position'] . ".) " . $row['title'] . "</font>";
        }
        echo "</td>";
        
        if (isset($_SESSION['dj_logged_in'])) {
            echo "<td><a href=report.php?id=" . $row['ID'] . "><img alt='Report' width='20' src='../images/uhoh.png'></a> ";
            
            if ($user_info['permissions'] >= 2) {
                echo "<a href=edit.php?id=" . $row['ID'] . "><img alt='Edit' width='20' src='../images/edit-icon.png'></a> ";
                echo " <a href=remove.php?id=" . $row['ID'] . "><img alt='Delete' width='20' src='../images/delete-icon.png'></a>";
            }
            echo "</td>";
            echo "</tr></font>";
        }
        else {
            echo "<td></td></tr></font>";
        }
    }
    $shown = $start + $page_limit;
    $back = $start - $page_limit;
    $cur_page = $shown / $page_limit;
    $pages = ceil($total / $page_limit);
    
    if ($pages > 10) {
        $first = $cur_page - 4;
        $last = $cur_page + 4;
        
        if ($first < 0) {
            $last = ($last - ($first));
        }
        
        if ($last < 0) {
            $first == $first + $last;
        }
    }
    else {
        $first = 0;
        $last = $pages;
    }

    //echo "On Page:".$cur_page." OF:".ceil($pages);
    echo "<tr align='center' class='headers'><td colspan='4'>";
    
    if ($start > 0) {

        //echo "[".$title."]";
        echo "<a href=\"?artist=" . $artist . "&title=" . $title . "&track=" . $track . "&cat=" . $cat_id . "&start=" . $back . "&order=" . $order . "&dir=" . $dir . "\"><-Back      </a>     ";
    }
    
    if ($pages > 1) {
        
        for ($p = 1;$p <= $pages;$p++) {
            
            if ($p < 3 || $p >= $pages - 3 || ($p > $first && $p < $last)) {
                
                if ($cur_page == $p) {
                    echo "<font size='5'>";
                }
                echo "&nbsp<a href=\"?artist=" . $artist . "&title=" . $title . "&track=" . $track . "&cat=" . $cat_id . "&start=" . $page_limit * ($p - 1) . "&order=" . $order . "&dir=" . $dir . "\">" . $p . "</a>";
                
                if ($cur_page == $p) {
                    echo "</font>";
                }
            }
            else {
                echo "&nbsp<a href=\"?artist=" . $artist . "&title=" . $title . "&track=" . $track . "&cat=" . $cat_id . "&start=" . $page_limit * ($p - 1) . "&order=" . $order . "&dir=" . $dir . "\">.</a>";
            }
        }
    }
    
    if ($shown < $total) {
        echo "<a href=\"?artist=" . $artist . "&title=" . $title . "&track=" . $track . "&cat=" . $cat_id . "&start=" . $shown . "&order=" . $order . "&dir=" . $dir . "\">      Forward-> </a>";
    }
    
    if (($start + $page_limit) > $total) {
        $end = $total;
    }
    else {
        $end = ($start + $page_limit);
    }
    echo "<br><font size='1'>Showing: " . $start . " - " . $end . " of " . $total . "</font>";
    echo "</tr><td></table></center>";
}

if (!isset($_SESSION['dj_logged_in'])) {
    include ("../../footer.php");
}
?>
./catalog/report.php
<?php 
session_start();
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php 
require_once("../../config.php");
require_once("../include/functions.php");
require_once('../include/catalog_functions.php');
include("../include/header.php");

if(isset($_GET['submit'])){
	$message = "DJ:" . $_POST['dj'] . "\n" ."Artist:" . $_POST['artist'] . "\n" ."Album:" . $_POST['album'] . "\n" ."Catalog Number:" . $_POST['cat'] . "\n" ."\nMessage:\n" . $_POST['comments'] . "\n";

	foreach($catalog_report_emails as $email){
		$sent = mail ( $email, "Catalog Report" , $message  );
	
		if($sent==1){
			echo '<meta HTTP-EQUIV="REFRESH" content="0; url=view.php?id='.$_POST['id'].'&sent=1">';
		}
		else{
			echo "<center>Report Failed</center>";
		}
	}
	
}
else if(isset($_GET['id'])){
		$id = mysql_real_escape_String($_GET['id']);
		$result = mysql_query("SELECT artist,title,category_number,vinyl_letter,category_id FROM catalog_albums WHERE id='" . $id . "'" ) or die(mysql_error());
		$row = mysql_fetch_row($result);

		$category_result = mysql_query("SELECT prefix FROM catalog_categories WHERE id='".$row[4]."'") or die(mysql_error());
		$category = mysql_fetch_row($category_result);
?>
<center>
<form  action="report.php?submit=1" method="POST" enctype="multipart/form-data" name="Catalog_Issue">
<input type="hidden" name="id" value="<?echo $id;?>">
DJ: <input class='searchbox' type="text" name="dj" value="<?echo $user_info['username'];?>"readonly><br>
Artist: <input class='searchbox' type="text" name="artist" value="<?echo $row[0];?>"readonly><br>
Album: <input class='searchbox' type="text" name="album" value="<?echo $row[1];?> "readonly><br>
Catalog Number: <input class='searchbox' type="text" name="cat" value="<?echo $category[0] . $row[3] . $row[2];?> "readonly><br>
<textarea name="comments" cols="70" rows="25"> Describe your issue here. </textarea><br>
<input type='submit' value='Submit'>
</form>
</center>
<?
}
?>
./playlist/selectdate.php
./playlist/viewdate.php
<?php 
session_start(); 
require("../include/config.php");
require("../include/functions.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<?php 
require("../include/header.php");
?>
<?php


if(isset($_SESSION['dj_logged_in']))
{
$session_username = $_SESSION['username'];
// further checking...
if(username_exists($session_username))
{

$query2="SELECT name FROM djs WHERE djname = '$anotherdj'";
$result2 = mysql_query ($query2);
$anotherdj = mysql_real_escape_string($_GET['anotherdj']);
$getdate = mysql_real_escape_string($_GET['datelist']);
$query="SELECT DISTINCT date FROM playlist WHERE dj = '$anotherdj' ORDER by date DESC";
$result = mysql_query ($query);

$findname="SELECT * FROM djs WHERE username = '$anotherdj'";
$nameresult = mysql_query ($findname);
$displayname=mysql_fetch_array($nameresult);

echo '

<center>
<Br>

<table class="welcomebar">
<tr>
<td class="date">
';
echo $displayname[name]; echo'\'s playlist for '; echo $getdate;
echo '
</td>
<td class="loggedin">
You\'re logged in as '; echo $session_username;
echo '
<a href="../login/logout.php">[logout]</a>
</td>
</tr>
</table>
';

echo "
<form name=\"jump\" class=\"chooseadate\">
<u>Choose a Date:</u>
<select name=\"menu\">
";
while($datelist=mysql_fetch_array($result)){
echo "<option value='../playlist/viewdate.php?datelist=$datelist[date]&anotherdj=$anotherdj'>$datelist[date]</option>";
}
echo "</select>
<input type=\"button\" onClick=\"location=document.jump.menu.options[document.jump.menu.selectedIndex].value;\" value=\"GO\">
</form>";



echo "

<br>

<div align=\"center\">

  <table class=\"playlist\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\">
    <tr>

	  <th align=\"left\" class=\"headers\"> &nbsp;Artist </th>
	  <th align=\"left\" class=\"headers\"> Song </th>
	  <th align=\"center\" class=\"headers\"> Section </th>
	  <th align=\"center\" class=\"headers\"> Req. </th>
	  <th align=\"center\" bgcolor=\"#000000\"  class=\"headers\">Est. Time Played</th>

	  </tr>
";

$datelist = mysql_real_escape_string($_GET['datelist']);
$playlist = mysql_query("SELECT * FROM playlist WHERE date = '$datelist' AND dj = '$anotherdj' ORDER by auto ASC");
$numofrows = mysql_num_rows($playlist);

if(mysql_num_rows($playlist) > 0)
{
//create a loop, because there are rows in the DB

{

for($i = 0; $i < $numofrows; $i++) {
    $rows = mysql_fetch_array($playlist); //get a row from our result set
    if($i % 2) { //this means if there is a remainder
        echo "<TR  bgcolor=\"#84C8FF\">\n";
    } else { //if there isn't a remainder we will do the else
        echo "<TR  bgcolor=\"#ededed\">\n";
    }
    echo "
	  
	  <td >&nbsp;".$rows['artist']."</td>
	  <td >&nbsp;".$rows['song']."</td>
	 
	  <td class=\"playlisttable\" align=\"center\">".$rows['section']." ".$rows['sectionnumber']."</td>

<td class=\"playlisttable\" align=\"center\">
	 ";
		  if ($rows['requested'] != '0')  { echo "<img src=\"../images/checkmark.png\">"; }
			else {echo "&nbsp;&nbsp;&nbsp;";}
	
	  echo " &nbsp;</td>


  <td align='center'>".$rows['time'].""; 





echo "
</td>
	  ";	


		  }

		  }

	}
else
{
echo 'Playlist not found.';
}
}
else
{
echo '<b>Sorry, the username could not be found.</b>.';
}
}
else
{
echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}


?>
<?php
require("../include/footer.php");
?>


</body>
</html>
./playlist/edit.php

<?php
session_start();
require ("../../config.php");
require ("../include/functions.php");

if (isset($_SESSION['dj_logged_in'])) {
    $session_username = $_SESSION['username'];

    // further checking...
    
    if (username_exists($session_username)) {
        $autoget = mysql_real_escape_string($_GET['auto']);
        $get_info = mysql_query("SELECT * FROM playlist WHERE auto=$autoget");
        
        if (mysql_num_rows($get_info) > 0) {
            $playlist_edit = mysql_fetch_assoc($get_info);
            
            if (!isset($_POST['do_edit'])) {
                require ("../include/header.php");
                echo '

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<center><br>
<table class="welcomebar">
<tr>
<td class="date">
Editing
</td>
<td class="loggedin">
You\'re logged in as ';
                echo $session_username;
                echo '
<a href="../login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
</td>
</tr>
</table>

<table><tr>

<td>
<center>
<form action="edit.php?auto=' . $playlist_edit['auto'] . '" method="post">
  <table width="600" border="0" cellspacing="5" cellpadding="" class="edittable">
    <tr>
      <td class="headers" width="" ><b>Artist:</b></td>
      <td><input type="text" name="artist" onChange="javascript:this.value=this.value.toUpperCase();"   class="register_box" value="' . $playlist_edit['artist'] . '" /></td>
    </tr>
	<tr>
      <td class="headers" width="" ><b>Track Number:</b></td>
      <td><input type="text" name="tracknumber"  onChange="javascript:this.value=this.value.toUpperCase();" class="register_box" value="' . $playlist_edit['tracknumber'] . '" /></td>
    </tr>
	<tr>
      <td class="headers" width="" ><b>Song:</b></td>
      <td><input type="text" name="song"  onChange="javascript:this.value=this.value.toUpperCase();" class="register_box" value="' . $playlist_edit['song'] . '" /></td>
    </tr>
	<tr>
      <td class="headers" ><b>Album Title:</b></td>
	  <td><input type="text" name="album" onChange="javascript:this.value=this.value.toUpperCase();"  class="register_box" value="' . $playlist_edit['album'] . '" /></td>
	</tr>
	<tr>
      <td class="headers" ><b>Record Label:</b></td>
	  <td><input type="text" name="label"  onChange="javascript:this.value=this.value.toUpperCase();" class="register_box" value="' . $playlist_edit['label'] . '" /></td>
	</tr>
	
	    <tr>
      <td class="headers" width="" ><b>Section:</b></td>
      <td>
	  
	  
	  ';
                $query = "SELECT genres FROM genres ORDER by genres ASC";
                $result = mysql_query($query);
                echo "<select name=\"section\">";
                
                while ($nt = mysql_fetch_array($result)) {
                    echo "<option ";
                    
                    if ($playlist_edit['section'] == $nt['genres']) {
                        echo "selected";
                    }
                    echo " value=$nt[genres]>$nt[genres]</option>";
                }
                echo '
	  
	  </select>
	  
	  

	  
	  
	  
	  </td>
    </tr>
	    <tr>
      <td class="headers" width="" ><b>Section Number:</b></td>
      <td><input type="text" maxlength="5"  name="sectionnumber"   class="register_box" value="' . $playlist_edit['sectionnumber'] . '" /></td>
    </tr>
   
    <tr>
      <td class="headers" width="" ><b>Requested:</b></td>
      <td><select name="requested">
        <option
		';
                
                if ($playlist_edit['requested'] == "0") {
                    echo "selected";
                }
                echo ' value="0" selected>No</option>
        <option 		';
                
                if ($playlist_edit['requested'] == "1") {
                    echo "selected";
                }
                echo ' value="1">Yes</option>
            </select></td>
    </tr>




    <tr>
      <td  class="headers" colspan="2" align="center"><br><input type="submit" name="do_edit" class="register_box"  value="Update Song Details" /><br><br></td>
    </tr>
    

';
                require ("../include/footer.php");
                echo '









  </table></td></tr></table>
</form><br /><br /></td></tr></table></center>
';
            }
            elseif (isset($_POST['do_edit'])) {
                $artist = mysql_real_escape_string($_POST['artist']);
                $song = mysql_real_escape_string($_POST['song']);
                $section = mysql_real_escape_string($_POST['section']);
                $sectionnumber = mysql_real_escape_string($_POST['sectionnumber']);
                $requested = mysql_real_escape_string($_POST['requested']);
                $album = mysql_real_escape_string($_POST['album']);
                $label = mysql_real_escape_string($_POST['label']);
                $tracknumber = mysql_real_escape_string($_POST['tracknumber']);
                mysql_query("UPDATE playlist SET artist = '$artist', song = '$song', album = '$album', label = '$label', section = '$section', sectionnumber = '$sectionnumber', tracknumber = '$tracknumber', requested = '$requested' WHERE auto=$autoget");
                echo '<meta http-equiv="REFRESH" content="0;url=http://www.wupx.com/arcums/playlist/index.php"></HEAD>';
                exit;
            }
        }
        else {
            echo 'Could not find profile info for your $autoget username.';
        }
    }
    else {
        echo '<b>Sorry, your session username doesnt exist</b>.';
    }
}
else {
    echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
?>

</center>
</body>
</html>

./playlist/index.php
<?php session_start();
$_SESSION['currentpage'] = $_SERVER['REQUEST_URI'];
require("../../config.php");
require("../include/functions.php");
require("../include/stream_functions.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<script type="text/javascript">

String.prototype.trim = function() {return this.replace(/^\s+|\s+$/g, ''); };

function validate_required(field,alerttxt)
{
	with (field)
{
if (value==null||value=="")
  {alert(alerttxt);return false}
else {return true}
}
}

function validate_form(thisform)
{
	with (thisform)
{
if (validate_required(artist,"The artist must be filled out!")==false)
  {album.focus();return false}
if (validate_required(song,"The song title must be filled out!")==false)
  {label.focus();return false}
if (validate_required(label,"The record label must be filled out!")==false)
  {label.focus();return false}
if (validate_required(album,"The album name must be filled out!")==false)
  {label.focus();return false}
}
}
</script>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<?php
require("../include/header.php");
?>
<?php


if(isset($_SESSION['dj_logged_in']))
{
$session_username = $_SESSION['username'];
// further checking...
if(username_exists($session_username))
{



echo '

<center>

<!--<Br>
<table class="headers">
<tr>
<td>
NOTICE: We have started charting again which allows us to keep our web stream legal.  ALL FIELDS ARE REQUIRED. Sorry.<br><center> If you don\' t know the information, just google it.</center>
</td>
</tr>
</table>
<br>-->


<table class="welcomebar">
<tr>
<td class="date">
WUPX Playlist for '; echo date("m/d/y");
echo '
</td>
<td class="loggedin">
You\'re logged in as '; echo $session_username;
echo '
<a href="' . $root_url . 'login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
</td>
</tr>
</table>


<table><tr><td>





<form action="addparse.php" method="post" name="addsong" onsubmit="return validate_form(this)">
 <input type="hidden" name="date" value="';print date("Y-m-d");echo '" />
<input type="hidden" name="time" value="';print date("H:i:s");echo '" />
<input type="hidden" name="datetime" value="';print date("YmdHis");echo'" />
  <table class="addtablemain">
    <tr>
      <th class="headers">Artist</th>
      <th class="headers">Track#</th>
      <th class="headers">Song</th>
      <th class="headers">Album</th>
      <th class="headers">Record Label</th>
    </tr>
    <tr>
      <td align="center" ><input name="artist" type="text" onChange="javascript:this.value=this.value.toUpperCase().trim();" autocomplete="off"/></td>
      <td align="center" ><input name="tracknumber" type="text" size="1" maxlength="2"  onChange="javascript:this.value=this.value.toUpperCase().trim();" autocomplete="off"/></td>
      <td align="center" ><input name="song" type="text" onChange="javascript:this.value=this.value.toUpperCase().trim();" autocomplete="off"/></td>
	  <td align="center" ><input name="album" type="text" onChange="javascript:this.value=this.value.toUpperCase().trim();" autocomplete="off"/> </td>
	  <td align="center" ><input name="label" type="text" onChange="javascript:this.value=this.value.toUpperCase().trim();" autocomplete="off"/></td>

</tr>
<tr>

<td colspan="5" align="right" >
&nbsp;&nbsp;&nbsp;Web Listeners: <input readonly="readonly" name="listeners" value="'. getCurrentListeners() .'" size="4" maxlength="4" type="text" />



	
	&nbsp;&nbsp;	Section:
	  ';

 $query="SELECT prefix,name FROM catalog_categories ORDER by genres ASC";
$result = mysql_query ($query);
echo "<select name=\"section\">";
while($nt=mysql_fetch_array($result)){
echo "<option ";

if($nt['name'] == "GENERAL") { echo "selected"; }


echo "
 value=$nt[prefix]>$nt[name]</option>";
}
echo "</select>";

	  echo '


&nbsp;Section# <input name="sectionnumber" size="5" maxlength="5" type="text" />&nbsp;&nbsp;&nbsp;Requested <select name="requested">
        <option value="0" selected>No</option>
        <option value="1">Yes</option>
            </select>
	&nbsp;&nbsp;&nbsp;	<input name="submit" value="Add" type="submit" />&nbsp;&nbsp;&nbsp;
    </tr>

  </table>
</form>
</center>
';
echo "

<div align=\"center\">

  <table class=\"playlist\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\">
    <tr>

	  <th align=\"left\" class=\"headers\"> &nbsp;Artist </th>
	  <th align=\"left\" class=\"headers\"> Song </th>
	  <th align=\"left\" class=\"headers\"> Listeners </th>
	  <th align=\"center\" class=\"headers\"> Section </th>
	  <th align=\"center\" class=\"headers\"> Req. </th>
	  <th align=\"center\" bgcolor=\"#000000\" width=\"40\" class=\"headers\">&nbsp;</th>
	  <th align=\"center\" width=\"40\" bgcolor=\"#000000\" class=\"headers\">&nbsp;</th>

	  </tr>
";
$todayis = date('Y-m-d');
$playlist = mysql_query("SELECT * FROM playlist WHERE dj = '$session_username' AND date = '$todayis' ORDER by auto DESC");
$numofrows = mysql_num_rows($playlist);

if(mysql_num_rows($playlist) > 0)
{
//create a loop, because there are rows in the DB

{

for($i = 0; $i < $numofrows; $i++) {
    $rows = mysql_fetch_array($playlist); //get a row from our result set
    if($i % 2) { //this means if there is a remainder
        echo "<TR bgcolor=\"#84C8FF\"  onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#84C8FF';\" >\n";
    } else { //if there isn't a remainder we will do the else
        echo "<TR bgcolor=\"#ededed\" onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#ededed';\">\n";
    }
    echo "

	  <td >&nbsp;".$rows['artist']."</td>
	  <td >&nbsp;".$rows['song']."</td>
	  <td >&nbsp;".$rows['listeners']."</td>
	  <td class=\"playlisttable\" align=\"center\">".$rows['section']." ".$rows['sectionnumber']."</td>

<td class=\"playlisttable\" align=\"center\">
	 ";
		  if ($rows['requested'] != '0')  { echo "<img src=\"../images/checkmark.png\">"; }
			else {echo "&nbsp;&nbsp;&nbsp;";}

	  echo " &nbsp;</td>

<td  class=\"edit\" bgcolor=\"#000000\" align=\"center\"><a href=\"edit.php?auto=".$rows['auto']."\">Edit</a> </td>

<td  class=\"delete\" bgcolor=\"#000000\" align=\"center\"> <a href=\"deleteparse.php?auto=".$rows['auto']."\" onclick=\"javascript:return confirm('Delete ".$rows['artist']. "&#8217;s &#8220;".$rows['song']."&#8221; from the playlist?'); return false;\">Delete </a>
</td>
	  ";

		  }
		  }
	 
	}

else
{
echo '<span class="chooseadate"><br>No playlist for today found.<Br><br>If it is midnight and you have already logged a few songs, they won\'t appear as the playlist starts over at midnight.  <br>You can view them under Past Playlists at the top.<br><br></span>';
}
}
else
{
echo '<b>Sorry, you are not logged in. </b>';
}
}
else
{
echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';

}


?>

<?php
require("../include/footer.php");
?>
</body>
</html>
./playlist/addparse.php
<?php
session_start();
require ("../../config.php");
require ("../include/functions.php");

if (isset($_SESSION['dj_logged_in'])) {
    $session_username = $_SESSION['username'];

    // further checking...
    
    if (username_exists($session_username)) {
        
        if (!isset($_POST['do_edit'])) {
            $artist = mysql_real_escape_string($_POST['artist']);
            $song = mysql_real_escape_string($_POST['song']);
            $section = mysql_real_escape_string($_POST['section']);
            $sectionnumber = mysql_real_escape_string($_POST['sectionnumber']);
            $requested = mysql_real_escape_string($_POST['requested']);
            $date = mysql_real_escape_string($_POST['date']);
            $time = mysql_real_escape_string($_POST['time']);
            $datetime = mysql_real_escape_string($_POST['datetime']);
            $album = mysql_real_escape_string($_POST['album']);
            $label = mysql_real_escape_string($_POST['label']);
            $tracknumber = mysql_real_escape_string($_POST['tracknumber']);
            $listeners = mysql_real_escape_string($_POST['listeners']);
            mysql_query("INSERT INTO  playlist SET artist = '$artist', song = '$song', album = '$album', label = '$label', section = '$section', sectionnumber = '$sectionnumber', requested = '$requested', listeners = '$listeners', tracknumber = '$tracknumber', date = '$date', time = '$time', dj = '$session_username', datetime='$datetime' ");
        }
        else {
            echo 'Could not recent playlists, please start a new one.';
        }
    }
    else {
        echo '<b>Sorry, your session doesnt exist. Please <a href="../login/index.php">login</a>.</b>';
    }
}
else {
    echo 'You must be logged in to edit your playlist. Please <a href="../login/index.php">login</a>.</b>';
}
header('location:index.php');
?>

./playlist/deleteparse.php
<?php
session_start();
require ("../../config.php");
$auto = mysql_real_escape_string($_GET['auto']);
$sql = "DELETE FROM playlist WHERE auto=$auto";

mysql_query($sql) or die ('<p>Error deleting entry: ' . mysql_error() . '</p>');
echo(header('location:index.php'));

?>
./webcharting/export.php
<?php
include("../../config.php");
$startdate = mysql_real_escape_string($_GET['startdate']);
$enddate = mysql_real_escape_string($_GET['enddate']);

$sql = "SELECT dj,artist, song, label, datetime as date FROM arcums.playlist where date between '$startdate' and '$enddate'";
$Use_Title = 1;
$now_date = date('m-d-Y H:i');
$title = "Dump For Table $DB_TBLName from Database $DB_DBName on $now_date";


$result = mysql_query($sql,$Connect)
	or die("Couldn't execute query:<br>" . mysql_error(). "<br>" . mysql_errno());

if (isset($w) && ($w==1))
{
	$file_type = "msword";
	$file_ending = "doc";
}else {
	$file_type = "vnd.ms-excel";
	$file_ending = "xls";
}

header("Content-Type: application/$file_type");
header("Content-Disposition: attachment; filename=WUPX_Charting.$file_ending");
header("Pragma: no-cache");
header("Expires: 0");


if (isset($w) && ($w==1)) //check for $w again
{

	if ($Use_Title == 1)
	{
		echo("$title\n\n");
	}
	$sep = "\n"; //new line character

	while($row = mysql_fetch_row($result))
	{
		//set_time_limit(60); // HaRa
		$schema_insert = "";
		for($j=0; $j<mysql_num_fields($result);$j++)
		{
		//define field names
		$field_name = mysql_field_name($result,$j);
		//will show name of fields
		$schema_insert .= "$field_name:\t";
			if(!isset($row[$j])) {
				$schema_insert .= "NULL".$sep;
				}
			elseif ($row[$j] != "") {
				$schema_insert .= "$row[$j]".$sep;
				}
			else {
				$schema_insert .= "".$sep;
				}
		}
		$schema_insert = str_replace($sep."$", "", $schema_insert);
		$schema_insert .= "\t";
		print(trim($schema_insert));
		//end of each mysql row
		//creates line to separate data from each MySQL table row
		print "\n----------------------------------------------------\n";
	}
}else{
	/*	FORMATTING FOR EXCEL DOCUMENTS ('.xls')   */
	//create title with timestamp:
	if ($Use_Title == 1)
	{
		echo("$title\n");
	}
	//define separator (defines columns in excel & tabs in word)
	$sep = "\t"; //tabbed character

	//start of printing column names as names of MySQL fields
	for ($i = 0; $i < mysql_num_fields($result); $i++)
	{
		echo mysql_field_name($result,$i) . "\t";
	}
	print("\n");
	//end of printing column names

	//start while loop to get data
	while($row = mysql_fetch_row($result))
	{
		//set_time_limit(60); // HaRa
		$schema_insert = "";
		for($j=0; $j<mysql_num_fields($result);$j++)
		{
			if(!isset($row[$j]))
				$schema_insert .= "NULL".$sep;
			elseif ($row[$j] != "")
				$schema_insert .= "$row[$j]".$sep;
			else
				$schema_insert .= "".$sep;
		}
		$schema_insert = str_replace($sep."$", "", $schema_insert);	
		$schema_insert = preg_replace("/\r\n|\n\r|\n|\r/", " ", $schema_insert);
		$schema_insert .= "\t";
		print(trim($schema_insert));
		print "\n";
	}
}

?>
./webcharting/index.php
<?php 
session_start(); 
require("../../config.php");
require("../include/functions.php");
require("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<?php
echo "<center>";
if($user_info['permissions'] > 1)
{
$startdate = filter_input(INPUT_GET, 'startdate', FILTER_SANITIZE_SPECIAL_CHARS);
$enddate = filter_input(INPUT_GET, 'enddate',FILTER_SANITIZE_SPECIAL_CHARS);

if($startdate !== false && !empty($startdate) && $enddate !== false && !empty($enddate)){
	$query = "SELECT dj,artist, song, label, datetime as date FROM arcums.playlist where date between '$startdate' and '$enddate' UNION SELECT songrights as dj,artist, title as song, label, date_played as date from automation.historylist where automation.historylist.date_played between '$startdate' and '$enddate' order by date";
	$result = mysql_query($query) or die("Query failed.");
	
	echo "<ul>\n";
	echo "<table border=1 width='70%'><tr><td><b> DJ </b></td><td><b> ARTIST </b></td><td><b> SONG </b></td><td><b> LABEL </b></td><td><b> DATE </b></td></tr>";
	while ($row = mysql_fetch_array($result)) {
		echo "<tr><td> $row[dj] </td><td> $row[artist] </td><td> $row[song] </td><td> $row[label] </td><td>$row[date] </td></tr>";
	}
	echo "</table>";
echo "<form action='export.php' method='get'>
  <input name='startdate' type='hidden' id='genre' value='$startdate'/> 
  <input name='enddate' type='hidden' id='catnumber' value='$enddate' />
    <input type='submit' name='button' id='button' value='Export' /></ul>";

}
else{
echo "This isn't completely done yet. But it can be used to get a accurate chart of what has been played between 2 dates. Enter the dates you wish to look between in the format YYYY-MM-DD and click submit. If you want to export that list to an excell sheet, there is a button at the bottom for that.<br><br>";
echo "<form name='input' action='index.php' method='get'>";
echo"Start Date = <input type='text' name='startdate' value='$startdate'><br>";
echo"End Date = <input type='text' name='enddate' value='$enddate'><br>";
echo"<input type='submit' calue='Submit' /><br>";
}
}

require("../include/footer.php");
?>
</center>

</body>
</html>
./charting/export.php
<?php
include("../../config.php");
$getcatnumber =mysql_real_escape_string($_GET['catnumber']);
$getgenre = mysql_real_escape_string($_GET['genre']);

$sql = "SELECT artist, album, section, sectionnumber, date, COUNT(sectionnumber) AS timesplayed FROM playlist WHERE section = '$getgenre' AND sectionnumber > $getcatnumber AND date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) GROUP BY section, sectionnumber ORDER BY section ASC, timesplayed DESC";
$Use_Title = 1;
$now_date = date('m-d-Y H:i');
$title = "Dump For Table $DB_TBLName from Database $DB_DBName on $now_date";


$result = mysql_query($sql,$Connect)
	or die("Couldn't execute query:<br>" . mysql_error(). "<br>" . mysql_errno());

if (isset($w) && ($w==1))
{
	$file_type = "msword";
	$file_ending = "doc";
}else {
	$file_type = "vnd.ms-excel";
	$file_ending = "xls";
}

header("Content-Type: application/$file_type");
header("Content-Disposition: attachment; filename=WUPX_Charting.$file_ending");
header("Pragma: no-cache");
header("Expires: 0");


if (isset($w) && ($w==1)) //check for $w again
{

	if ($Use_Title == 1)
	{
		echo("$title\n\n");
	}
	$sep = "\n"; //new line character

	while($row = mysql_fetch_row($result))
	{
		//set_time_limit(60); // HaRa
		$schema_insert = "";
		for($j=0; $j<mysql_num_fields($result);$j++)
		{
		//define field names
		$field_name = mysql_field_name($result,$j);
		//will show name of fields
		$schema_insert .= "$field_name:\t";
			if(!isset($row[$j])) {
				$schema_insert .= "NULL".$sep;
				}
			elseif ($row[$j] != "") {
				$schema_insert .= "$row[$j]".$sep;
				}
			else {
				$schema_insert .= "".$sep;
				}
		}
		$schema_insert = str_replace($sep."$", "", $schema_insert);
		$schema_insert .= "\t";
		print(trim($schema_insert));
		//end of each mysql row
		//creates line to separate data from each MySQL table row
		print "\n----------------------------------------------------\n";
	}
}else{
	/*	FORMATTING FOR EXCEL DOCUMENTS ('.xls')   */
	//create title with timestamp:
	if ($Use_Title == 1)
	{
		echo("$title\n");
	}
	//define separator (defines columns in excel & tabs in word)
	$sep = "\t"; //tabbed character

	//start of printing column names as names of MySQL fields
	for ($i = 0; $i < mysql_num_fields($result); $i++)
	{
		echo mysql_field_name($result,$i) . "\t";
	}
	print("\n");
	//end of printing column names

	//start while loop to get data
	while($row = mysql_fetch_row($result))
	{
		//set_time_limit(60); // HaRa
		$schema_insert = "";
		for($j=0; $j<mysql_num_fields($result);$j++)
		{
			if(!isset($row[$j]))
				$schema_insert .= "NULL".$sep;
			elseif ($row[$j] != "")
				$schema_insert .= "$row[$j]".$sep;
			else
				$schema_insert .= "".$sep;
		}
		$schema_insert = str_replace($sep."$", "", $schema_insert);	
		$schema_insert = preg_replace("/\r\n|\n\r|\n|\r/", " ", $schema_insert);
		$schema_insert .= "\t";
		print(trim($schema_insert));
		print "\n";
	}
}

?>
./charting/chart_logs.php

<?php
require_once("../../config.php");
?>
<br><br>

<?php
// Make a MySQL Connection

$query = "SELECT djs.name, djs.djname, playlist.dj, playlist.artist, (SELECT artist, djname FROM playlist GROUP BY djname) AS total_plays FROM djs, playlist GROUP BY name ORDER by name ASC"; 
	 
$result = mysql_query($query) or die(mysql_error());

// Print out result
while($row = mysql_fetch_array($result)){
	echo $row['name'] ." played ". $row['total_plays'] ." songs on their last show.";
	echo "<br />";
}
?>


./charting/biteem.php
<html>
<head>
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<?php

$name = $_GET['name'];
$to = $_GET['email'];
$artist = $_GET['artist'];
$album = $_GET['album'];
$section = $_GET['section'];
$sectionnumber = $_GET['sectionnumber'];
$date = $_GET['date'];
$email = $_GET['email'];
$time = $_GET['time'];

$subject = "Radio X- Warning";
$body = "

$name,

Our records show that you were the last DJ to play the album below and it was not properly put away:

Artist: $artist
Album: $album
CD#: $section $sectionnumber
Date: $date
Time: $time

Please make sure that you put your CD's away so others don't have to do it for you.

Thank you,
E-Staff

This message was generated using the ARCUMS Hound Dog @$\$hole Tracker 1.0.
";

$dodgy_strings = array(
                "content-type:"
                ,"mime-version:"
                ,"multipart/mixed"
                ,"bcc:"
);

function is_valid_email($email) {
  return preg_match('#^[a-z0-9.!\#$%&\'*+-/=?^_`{|}~]+@([0-9.]+|([^\s]+\.+[a-z]{2,6}))$#si', $email);
}

function contains_bad_str($str_to_test) {
  $bad_strings = array(
                "content-type:"
                ,"mime-version:"
                ,"multipart/mixed"
		,"Content-Transfer-Encoding:"
                ,"bcc:"
		,"cc:"
		,"to:"
  );
  
  foreach($bad_strings as $bad_string) {
    if(eregi($bad_string, strtolower($str_to_test))) {
      echo "$bad_string found. Suspected injection attempt - mail not being sent.";
      exit;
    }
  }
}

function contains_newlines($str_to_test) {
   if(preg_match("/(%0A|%0D|\\n+|\\r+)/i", $str_to_test) != 0) {
     echo "newline found in $str_to_test. Suspected injection attempt - mail not being sent.";
     exit;
   }
} 


if (!is_valid_email($email)) {
  echo 'Invalid email submitted - mail not being sent.';
  exit;
}

contains_bad_str($email);
contains_bad_str($subject);
contains_bad_str(body);

contains_newlines($email);
contains_newlines($subject);

$headers = "From: musicdirector@wupx.com";
mail($email, $subject, $body, $headers);
echo "<div style='color:#ffffff' class='edit'>E-mail has been sent. <a href='javascript:closeWindow();'>Close Window</a></div>";

?>




<script language="javascript" type="text/javascript">

function closeWindow() {

window.open('','_parent','');

window.close();

}

</script>
</body>
</html>./charting/index.php
<?php
session_start();
$_SESSION['currentpage'] = $_SERVER['REQUEST_URI'];
require_once("../../config.php");
require_once("../include/functions.php");
?>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
if(isset($_SESSION['dj_logged_in']))
{
$session_username = $_SESSION['username'];
// further checking...
if(username_exists($session_username))
{

require("../include/header.php");
$query2="SELECT name FROM djs WHERE djname = '$anotherdj'";
$result2 = mysql_query ($query2);
$anotherdj = mysql_real_escape_string($_GET['anotherdj']);
$getdate = mysql_real_escape_string($_GET['datelist']);
$query="SELECT DISTINCT date FROM playlist WHERE dj = '$anotherdj' ORDER by date DESC";
$result = mysql_query ($query);
$getcatnumber = mysql_real_escape_string($_GET['catnumber']);
$getgenre = mysql_real_escape_string($_GET['genre']);
echo "
<div align=\"center\">


<table class=\"welcomebar\">
<tr>
<td class=\"date\">
Last 7 Days of New Music: $getgenre > $getcatnumber
</td>
<td class=\"loggedin\">
You're logged in as "; echo $session_username;
echo "
<a href=\"../login/logout.php\">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
</td>
</tr>
</table>

<table class='searchbox'> 
<tr>
<td class='headers' align=center>Section</td>
<td class='headers' align=center>Section #</td>
<td class='headers'></td>
<td class='headers'></td>


</tr><tr>
<form method='get' action='index.php'>
";

$query="SELECT prefix,name FROM catalog_categories ORDER by genres ASC";
$result = mysql_query ($query);
echo "<td><select name=\"genre\">";
while($nt=mysql_fetch_array($result)){
echo "
<option ";

if($nt['genres'] == $getgenre) { echo "selected"; }


echo "
 value=$nt[prefix]>$nt[name]</option>";
}
echo '</select></td>
 <td> <input name="catnumber" type="text" id="catnumber" maxlength="5" size="5"/></td>
   <td> <input type="submit" name="button" id="button" value="Submit" />
</form></td>
&nbsp;&nbsp;&nbsp;
<td><form action="export.php" method="get">
  <input name="genre" type="hidden" id="genre" value="'; echo $getgenre; echo '"/> 
  <input name="catnumber" type="hidden" id="catnumber" value="'; echo $getcatnumber; echo '" />
    <input type="submit" name="button" id="button" value="Export" />
</form></td></tr>
<tr>
<td colspan="4">Select a starting number.</td>

</table>

';






echo "



<br><br>
  <table class=\"lookupplays\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\">
    <tr>
	  <th class=\"headers\">CD </th>
	  <th class=\"headers\">Artist </th>
	  <th class=\"headers\">Album </th>
	  <th class=\"headers\">Times Played </th>


	  </tr>
";
$query = "SELECT artist, album, section, sectionnumber, date, COUNT(sectionnumber) AS timesplayed FROM playlist WHERE section = '$getgenre' AND sectionnumber > $getcatnumber AND date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) GROUP BY section, sectionnumber ORDER BY section ASC, timesplayed DESC";
$playlist = mysql_query($query) or die(mysql_error());
$numofrows = mysql_num_rows($playlist);

if(mysql_num_rows($playlist) > 0)
{
//create a loop, because there are rows in the DB

{

for($i = 0; $i < $numofrows; $i++) {
    $rows = mysql_fetch_array($playlist); //get a row from our result set
    if($i % 2) { //this means if there is a remainder
        echo "<TR bgcolor=\"#84C8FF\"  onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#84C8FF';\" >\n";
    } else { //if there isn't a remainder we will do the else
        echo "<TR bgcolor=\"ededed\" onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#ededed';\">\n";
    }
    echo "
	  <td>".$rows['section']." ".$rows['sectionnumber']."</td>
	  <td>".$rows['artist']."</td>
	  <td>".$rows['album']."</td>

<td align=\"center\">

".$rows['timesplayed']."
</td>



	  ";	

		  }
	  echo "</td></tr>";
		  }
	 
	}
else
{
echo '<span class="chooseadate">Select a genre and starting catalog number<br><br></span>';
}







}
else
{
echo '<b>Sorry, the username could not be found.</b>.';
}
}
else
{
echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}


?>

<?php
require("../include/footer.php");
?>
./charting/tracker.php
<?php 
session_start();
$_SESSION['currentpage'] = $_SERVER['REQUEST_URI'];
require("../../config.php");
require("../include/functions.php");
?>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<?php
require("../include/header.php");
?>


<?php

if(isset($_SESSION['dj_logged_in']))
{
$session_username = $_SESSION['username'];
// further checking...
if(username_exists($session_username))
{

$query2="SELECT name FROM djs WHERE djname = '$anotherdj'";
$result2 = mysql_query ($query2);
$anotherdj = mysql_real_escape_string($_GET['anotherdj']);
$getdate = mysql_real_escape_string($_GET['datelist']);
$query="SELECT DISTINCT date FROM playlist WHERE dj = '$anotherdj' ORDER by date DESC";
$result = mysql_query ($query);
$getcatnumber = mysql_real_escape_string($_GET['catnumber']);
$getgenre = mysql_real_escape_string($_GET['genre']);
$getartist = mysql_real_escape_string($_GET['theartist']);
echo "
<div align=\"center\">


<table class=\"welcomebar\">
<tr>
<td class=\"date\">
Hound Dog Asshole Tracker: 
";

if (empty($getartist))
{
echo "$getgenre $getcatnumber";
}else {
echo "$getartist";
}

echo "
</td>
<td class=\"loggedin\">
You're logged in as "; echo $session_username;
echo "
<a href=\"../login/logout.php\">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
</td>
</tr>
</table>
<br>

<table class='searchbox'> 
<tr>
<td class='headers' align=center>Section</td>
<td class='headers' align=center>Section #</td>
<td class='headers' align=center>Artist or Album</td>
<td class='headers'></td>
</tr></td><tr>
<form>
";

$query="SELECT genres FROM genres ORDER by genres ASC";
$result = mysql_query ($query);
echo "<td><select name=\"genre\">";
while($nt=mysql_fetch_array($result)){
echo "<option ";

if($nt['genres'] == $getgenre) { echo "selected"; }


echo "
 value=$nt[genres]>$nt[genres]</option>";
}
echo '</select></td>
  <td><input name="catnumber" type="text" id="catnumber" size="6" maxlength="10" /></td>
  <td><input name="theartist" type="text" id="theartist" size="20" maxlength="50" /></td>
  <td><input type="submit" name="button" id="button" value="Submit" /></td>

</tr></table></form>
';






echo "



<br><br>
  <table class=\"lookupplays\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\">
    <tr>
	  <th class=\"headers\">Date </th>
	  <th class=\"headers\">Time </th>
	  <th class=\"headers\">CD </th>
	  <th class=\"headers\">Artist </th>
	  <th class=\"headers\">Album </th>
	  <th class=\"headers\">Last DJ to Play It </th>
	  <th class=\"headers\"> </th>


	  </tr>
";

if (empty($getartist))
{
$playlist = mysql_query("SELECT date,time,section,artist,album, sectionnumber,djs.name,djs.email FROM playlist, djs WHERE section = '$getgenre' AND sectionnumber = $getcatnumber AND playlist.dj = djs.username ORDER BY date DESC, TIME DESC LIMIT 10");

}else{

$playlist = mysql_query("SELECT date,time,section,artist,album, sectionnumber,djs.name,djs.email FROM playlist, djs WHERE (artist LIKE '%$getartist%' OR album LIKE '%$getartist%') AND playlist.dj = djs.username ORDER BY date DESC, TIME DESC LIMIT 10");
}



$numofrows = mysql_num_rows($playlist);

if(mysql_num_rows($playlist) > 0)
{
//create a loop, because there are rows in the DB

{

for($i = 0; $i < $numofrows; $i++) {
    $rows = mysql_fetch_array($playlist); //get a row from our result set
    if($i % 2) { //this means if there is a remainder
        echo "<TR bgcolor=\"#84C8FF\"  onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#84C8FF';\" >\n";
    } else { //if there isn't a remainder we will do the else
        echo "<TR bgcolor=\"ededed\" onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#ededed';\">\n";
    }
    echo "
	  <td>".$rows['date']."</td>
	  <td>".$rows['time']."</td>
	  <td>".$rows['section']." ".$rows['sectionnumber']."</td>
	  <td>".$rows['artist']."</td>
	  <td>".$rows['album']."</td>

<td align=\"center\">

".$rows['name']."
</td>
<td class='edit' bgcolor='#000000' align='center'> <A HREF=\"javascript:popUp('biteem.php?name=$rows[name]&email=$rows[email]&date=$rows[date]&time=$rows[time]&section=$rows[section]&sectionnumber=$rows[sectionnumber]&artist=$rows[artist]&album=$rows[album]')\">[send e-mail]</a></td>



	  ";	


		  }
	  
		  }
	}
else
{
echo '<span class="chooseadate">0 Results Returned.<br><br></span>';
}




}
else
{
echo '<b>Sorry, the username could not be found.</b>.';
}
}
else
{
echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}


?>
<?php
require("../include/footer.php");
?>
<br />

<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
function popUp(URL) {
day = new Date();
id = day.getTime();
eval("page" + id + " = window.open(URL, '" + id + "', 'toolbar=1,scrollbars=0,location=0,statusbar=1,menubar=0,resizable=1,width=400,height=100,left = 312,top = 309');");
}
// End -->
</script>
./index.php
<?php
session_start();
include("../config.php");
$_SESSION['currentpage'] = $_SERVER['REQUEST_URI'];
?>
<meta HTTP-EQUIV="REFRESH" content="0; url=<?php echo $root ?>/arcums/playlist/index.php">;


./blog/post.php
<?php
session_start();
require("../../config.php");
require("../include/functions.php");
require("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
if(isset($_SESSION['dj_logged_in'])){
	echo "<center><table width='55%' ><TR><TD>";
	if(isset($_GET['EDIT'])){
		$postid = mysql_real_escape_string($_GET['EDIT']);	
		$row_query = mysql_query("SELECT * FROM posts WHERE id='".$postid . "'");
		$row = mysql_fetch_array($row_query); 
		if($user_info['permissions'] > 1 || $user_info['id'] == $row['dj_id'] ){
			echo("
			<script type=\"text/javascript\" src=\"/ckeditor/ckeditor.js\"></script>
			<form action=\"post.php?EDIT_POST=1\" method=\"post\">
			<br>

			<b>Blog:</b> 
			<select name=\"type\">
			<option value=\"0\">DJ</option>");
		if($user_info['permissions'] > 1){
			echo("
				<option value=\"1\">E-Staff</option>
			");
		}
		echo("	
			</select>
			<br>
			<b>Title:</b><input type=\"text\" size=\"100\"name=\"title\" value ='" . $row['title'] . "'><br />
			<textarea name=\"post_text\" rows=\"10\" cols=\"40\">". stripslashes($row['text']) ."</textarea>

			<script type=\"text/javascript\">
			CKEDITOR.replace( 'post_text',
			    {
				toolbar : 'MyToolbar',
				uiColor : '#003158'
			    });
			</script>

			<br>
		        <input type=\"hidden\" value=\"" . $row['id'] . "\" name=\"id\">
			<center><input type=\"submit\" value=\"Update\"></center>
			</form>
			<br><br><br>
		");	
		}
		else{
			echo "<font color='red'>You are unauthorized to edit this post</font>";
		}

	}
	else if(isset($_GET['EDIT_POST'])){
		$title = mysql_real_escape_string($_POST['title']);
		$text = mysql_real_escape_string($_POST['post_text']);
		$id = mysql_real_escape_string($_POST['id']);

		$tack = "";
		if(!isset($_POST['type'])){
			$type = 0;
			$tack="AND dj_id='" . $user_info['id'] . "'";
		}
		else{
			$type = mysql_real_escape_string($_POST['type']);
		}
	
		//so that DJs can't post to e-staff blog
		if($user_info['permissions']<1){
			$type=0;
		}

		if($title == ""){
			echo "No Title Supplied!";
		}
		else if($text == ""){
			echo "No Text In Your Post!";
		}
		else if($type == ""){
			echo "No Type Selected!";
		}
		else if($id == ""){
			echo "ID not set!";
		}
		else{
			mysql_query("UPDATE posts SET type='" . $type ."', title='" . $title ."', text='". $text."' WHERE id='" . $id . "'" . $tack)
			or die(mysql_error());

			echo "Your Post has been updated!";
		}
	}
	else if(isset($_GET['DELETE'])){
		$id = mysql_real_escape_string($_GET['DELETE']);

		$tack = "";
		if($user_info['permissions']<=1){
			$set_type=0;
			$tack="AND dj_id='" . $user_info['id'] . "'";
		}
		else{
			$set_type='%';
		}

		if($id == ""){
			echo "ID not set!";
		}	
		else{
			mysql_query("DELETE FROM posts WHERE id='" . $id . "' AND type LIKE '" . $set_type . "'" . $tack)
			or die(mysql_error());

			echo "Post Deleted!";
		}
	}
	else if($_POST['post_text']==""){		
		echo("
			<script type=\"text/javascript\" src=\"/ckeditor/ckeditor.js\"></script>
			<form action=\"post.php\" method=\"post\">
			<b>DJ ID:</b> <input type=\"text\" readonly size=\"4\" name=\"djid\" value=\"" . $user_info['id'] . "\"/>
			<br>

			<b>Blog:</b> 
			<select name=\"type\">
			<option value=\"0\">DJ</option>");
		if($user_info['permissions'] > 1){
			echo("
				<option value=\"1\">E-Staff</option>
			");
		}
		echo("	
			</select>
			<br>
			<b>Title:</b><input type=\"text\" size=\"100\"name=\"title\" /><br />
			<textarea name=\"post_text\" rows=\"10\" cols=\"40\"></textarea>

			<script type=\"text/javascript\">
			CKEDITOR.replace( 'post_text',
			    {
				toolbar : 'MyToolbar',
				uiColor : '#003158'
			    });
			</script>

			<br>
			<center><input type=\"submit\" value=\"Submit\"></center>
			</form>
			<br><br><br>
		");	
	}
	else{
		$dj_id = mysql_real_escape_string($_POST['djid']);
		$title = mysql_real_escape_string($_POST['title']);
		$text = mysql_real_escape_string($_POST['post_text']);

		if(!isset($_POST['type'])){
			$type = 0;
		}
		else{
			$type = mysql_real_escape_string($_POST['type']);
		}
	
		//so that DJs can't post to e-staff blog
		if($user_info['permissions']<=1){
			$type=0;
		}

		if($dj_id == ""){
			echo "Invalid DJ ID";
		}
		else if($title == ""){
			echo "No Title Supplied!";
		}
		else if($text == ""){
			echo "No Text In Your Post!";
		}

		else{
			mysql_query("INSERT INTO blog_posts (dj_id,type,title,text) VALUES ('". $dj_id . "','" . $type . "','". $title . "','" . $text . "')")
			or die(mysql_error());
			echo "Your Post has been posted!";
			
			$idquery = mysql_query("SELECT id FROM blog_posts WHERE dj_id='" . $dj_id . "' and title='" . $title . "'") or die(mysql_error());
			$id = mysql_fetch_array($idquery);

			$djquery = mysql_query("SELECT djname FROM accounts WHERE id=" . $dj_id) or die(mysql_error());
			$djname = mysql_fetch_array($djquery);

		}
	}
	echo "</TD></TR></table>";
}
else{
	echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
	include("../include/footer.php");


?>
./blog/view.php
<?php
session_start();
require("../../config.php");
require("../include/functions.php");
require("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
if(isset($_SESSION['dj_logged_in'])){
	$session_username = $_SESSION['username'];
		echo "<center><table width='55%' bgcolor='#000000' ><TR><TD><font color='white'>";

		//which post to start on
		$start = mysql_real_escape_string($_GET['start']);

		//tags that are allowed to be displayed (used with strip_tags)
		$allowable_post="<b><a><br><br /><strong><sup><sub><p><blockquote><font><img><ol><li><ul><code><cite><em><h1><h2><h3><h4><h5><h6><address><span>";
		$allowable_comment="<a>";	

		//cleanse all of the $_GET variables
		if(!isset($_GET['type'])){
			$type = 1;
		}
		else{
			$type = mysql_real_escape_string($_GET['type']);
		}
	
		//so that DJs can't edit the estaff blog
		if($user_info['permissions']<1){
			$type=0;
		}

		if($start==""){
			$start = 0;
		}

		if(!isset($_GET['start'])){
			$limit=5;
		}
		else{
			$limit = mysql_real_escape_string($_GET['limit']);
		}

		if(isset($_GET['post'])){
			$post_number =  mysql_real_escape_string($_GET['post']);
		}
		if(isset($_GET['hide'])){
			$hide = addslashes($_GET['hide']);
			$hide_query = "UPDATE comments SET hide='1' WHERE id='".$hide."'";
			mysql_query($hide_query) or die(mysql_error());
			echo "Comment Hidden<br><br>";
		}
		if(isset($_GET['unhide'])){
			$unhide = addslashes($_GET['unhide']);
			$unhide_query = "UPDATE comments SET hide='0' WHERE id='".$unhide."'";
			mysql_query($unhide_query) or die(mysql_error());
			echo "Comment Un-Hidden<br><br>";
		}
		//calculate next and prev values.
		$next = $start+$limit;
		$prev = $start-$limit;
		if($prev < 0){
			$prev = 0;
		}

		//get count of posts for calculating prev and next buttons
		$query=mysql_query("SELECT * from blog_posts WHERE type='" . $type ."' ORDER BY post_time");
		$count=mysql_num_rows($query);

		if(!isset($post_number)){
			$query=mysql_query("SELECT * from blog_posts WHERE type='" . $type ."' ORDER BY post_time DESC LIMIT ". $start . "," .$limit  );
			while($row = mysql_fetch_array($query)){
				echo "<br><br>";
	
				//get the name of the dj that posted the post
				$dj_query=mysql_query("select name,djname from accounts where id =" . $row['dj_id']);
				$dj_row = mysql_fetch_array($dj_query);
		
				//get a count of the comments
				$comment_count_query=mysql_query("Select * from blog_comments where post_id =" . $row['id']);
				$comment_count = mysql_num_rows($comment_count_query);				
			
				//display post
				echo "<font size=\"6\"><b>" . $row['title'] . "</b></font>";
				if($user_info['permissions']>1 || $user_info['id'] == $row['dj_id']){
					echo"<a href='post.php?EDIT=".$row['id']."&type=" . $type . "'>Edit</a>" . " <a href=\"post.php?DELETE=".$row['id']."\">Delete</a>";
				}
				echo"<br><b>DJ:</b> <a href=\"../arcums/profile/view_profile.php?member_id=" . $row['dj_id']. "\">". $dj_row['djname'] . "</a>(" . $dj_row['name'] . ")" . " | <b>Time:</b> "  . $row['post_time'] . "<br><br>" . stripslashes(strip_tags($row['text'],$allowable_post));
				echo "<br><a href=\"?post=" . $row['id'] ."&type=" . $type . "\">Comments(" . $comment_count . ")</a><br><br>";
		                echo "<hr width=\"100%\" size=10 color=\"#43727B\">";
			}//end while
				if($start>0){
					echo "<center><a href=\"?type=".$type."&start=". $prev . "\"><-Previous </a></center>";
				}
				if($count > $next){
					echo "<center><a href=\"?type=".$type."&start=". $next . "\">Next-></a></center>";
				}
		}//end if
	       else{
		        $query=mysql_query("Select * from blog_posts where id='" . $post_number . "' AND type='" . $type . "'");
		        $row = mysql_fetch_array($query);
		               
			 //get the name of the dj that posted the post
		         $dj_query=mysql_query("select name,djname from accounts where id =" . $row['dj_id']);
		         $dj_row = mysql_fetch_array($dj_query);

		         //get the comments
		         $comments_query=mysql_query("Select * from blog_comments where post_id =" . $row['id']);

			//display post
			echo "<b><font size=\"6\">" . $row['title'] . "</b></font>";

			if($user_info['permissions']>1 || $user_info['id'] == $row['dj_id']){
				echo"<a href=\"post.php?EDIT=".$row['id']."\">Edit</a>" . " <a href=\"post.php?DELETE=".$row['id']."\">Delete</a>";
			}
			echo"<br><b>DJ:</b> <a href=\"../arcums/profile/view_profile.php?member_id=" . $row['dj_id']. "\">". $dj_row['djname']. " </a>(" . $dj_row['name'] . ")" . " | <b>Time:</b> "  . $row['post_time'] . "<br>" . stripslashes(strip_tags($row['text'],$allowable_post));
			echo "<hr width=\"100%\" size=10 color=\"#43727B\">";			
			echo"<font color='GREEN'>Good</font>|<font color='BLUE'>Not Yet Validated</font>|<font color='RED'>Hidden</font><br><br>";
			//dispay comments
			echo "";
			while($comment_row = mysql_fetch_array($comments_query)){
				if($comment_row['hide']!=0){
					echo "<font color='RED'>";
					$link = " <a href='?unhide=" . $comment_row['id']. "&post=" . $row['id'] . "&type=" . $type ."'>Unhide</a>";
				}
				else if($comment_row['valid']==0){
					echo "<font color='BLUE'>";
					$link = " <a href='?hide=" . $comment_row['id']."&post=" . $row['id'] . "&type=" . $type . "'>Hide</a>";
				}
				else{
					echo "<font color='GREEN'";
					$link = " <a href='?hide=" . $comment_row['id']."&post=" . $row['id'] . "&type=" . $type ."'>Hide</a>";
				}
				echo "<b><font size=\"3\">" . $comment_row['title'] . "</font></b>" . $link . "<font size=\"1\"> Reported " . $comment_row['reported'] . "times.<br>Name: " . $comment_row['name']  . "<br>Email: <a href=\"mailto:" . $comment_row['email'] . "\">". $comment_row['email'] ."</a><br>" . strip_tags($comment_row['text'],$allowable_comment) . "<br><br></font>";
			}

		}//end else 
		echo "</font></TD></TR></table>";
}
else{
	echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}
	include("../include/footer.php");
?>
./blog/index.php
<?php
session_start();
require("../..//config.php");
require("../include/functions.php");
require("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php

echo '<center><br /><table width="600"> <tr><td>
<center>

<table class="welcomebar">
<tr>
<td class="date">
Blog Administration
</td>
<td class="loggedin">
You\'re logged in as '; echo $user_info['username'];
echo '
<a href="'.$root.'/arcums/login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
</td>
</tr>
</table>';


	echo "<center><table class='addtablemain' bgcolor='black' align=\"center\" width=\"650\"><tr class=\"headers\" align=\"center\"><td>";
	echo "<br><font size=\"5\"> WUPX BLOG</font><br>";
	echo "<font size=\"2\">The blog is up and ready to post to. You are responsible for the content of your own posts.</td></tr><tr bgcolor='black' align='center'><td>";
	echo "<a href=\"post.php\">Add New Blog Post</a><br>";
	echo "<a href=\"view.php?type=0\">Edit DJ Blog</a><br>";
if($user_info['permissions'] > 1){
	echo "<a href=\"view.php?type=1\">Edit E-staff Blog</a><br>";
}
	echo "</td></tr></table></center>";


./admin/index.php
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
session_start();
require("../include/header.php");
require("../include/config.php");
require("../include/functions.php");
if(isset($_SESSION['dj_logged_in']))
{
$session_username = $_SESSION['username'];
// further checking...
if(username_exists($session_username))
{
$get_info = mysql_query("SELECT djs.username, settings.stationid, settings.rooturl, settings.playedlimit FROM djs, settings WHERE djs.username = '$session_username' LIMIT 1");
if(mysql_num_rows($get_info) > 0)
{
$user_info = mysql_fetch_assoc($get_info);
if(!isset($_POST['do_edit']))
{
echo '




<table>
 <tr>
<td bgcolor="06bc00"><b>Station ID</b></td>
      <td><input type="text" name="stationid" class="register_box"  value="' . $user_info['username'] . '" /></td>
</tr>
 <tr>
<td bgcolor="06bc00"><b>Root URL: (ex: http://www.wupx.com)</b></td>
      <td><input type="text" name="rooturl" class="register_box"  value="' . $user_info['rooturl'] . '" /></td>
</tr>
 <tr>
<td bgcolor="06bc00"><b>Recently Played Limit:</b></td>
      <td><input type="text" name="playedlimit" class="register_box"  value="' . $user_info['playedlimit'] . '" /></td>
</tr>


</table>

';
}}}}
?>
./profile/upload_image.php
<html><head> 
<title>Change Profile Photo</title> 
</head>
<style>
body
{
background: #131313;
background-image: url('../images/bg.jpg');
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
.register_box
{
border: 1px solid #323232;
background: #202020;
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
a:link
{
color: c0c0c0;
}
a:visited
{
color: c0c0c0;
}
a:hover
{
color: 00ff00;
}
</style>
<body> 
<table><tr><td><h3>Change Profile Photo</td></tr></table>
Your photo must be less than 80 Kb in size and in .jpg, .gif or .jpeg format.<br /> 
Please resize your photo to around a width of 125px and height 150px. Your photo will looked squished if you fail to do so. <br /> <br /> Contact itdirector@wupx.com for support.  <br /><br /><b>NO NUDITY OR INAPPROPRITE PHOTOS ALLOWED!</b>
<form action="changephotoparse.php" method="post" enctype="multipart/form-data"> 
<input type="hidden" name="MAX_FILE_SIZE" value="81920"> 
<input type="file" name="userphoto"><br /> <br /> 
<input type="submit" name="submit" value="Upload Photo"></form> 
</body></html> ./profile/stafflist.php
<?php
require("config.php");
require("arcums/include/functions.php");
//echo some styles to spice it up...
echo "<h2>E-Staff</h2><br /><a href=\"".$root."/arcums\">E-Staff Login</a><br \><br \>
";
$all_members = mysql_query("SELECT * FROM accounts WHERE permissions >= 3 ORDER BY stafforder ASC") or die("Error getting staff list.");
if(mysql_num_rows($all_members) > 0)
{
//create a loop, because there are rows in the DB
while($row = mysql_fetch_assoc($all_members))
{


echo "<table><tr><td valign=\"top\"><img src=\"$root/arcums/profile/photos/{$row['photo']}\" width=\"125\" height=\"150\"></td>
<td>
<b>$row[position] - $row[name]</b> 
<br>
[<a href='arcums/profile/view_profile.php?member_id=$row[id]'>View Profile</a>]
";

echo"<table width=\"250\"><tr><td colspan=\"2\" bgcolor='ffffff'><font color='000000'><b> Office Hours</td></tr></font>";

if ($row['monday'] != '') {
  echo "<tr><td valign=\"top\" ><B>Monday</b></td><td valign=\"top\" >{$row['monday']}</td></tr>";
}
if ($row['tuesday'] != '') {
  echo "<tr><td valign=\"top\" ><B>Tuesday</b></td><td valign=\"top\" >{$row['tuesday']}</td></tr>";
}

if ($row['wednesday'] != '') {
  echo "<tr><td valign=\"top\" ><B>Wednesday</b></td><td valign=\"top\" >{$row['wednesday']}</td></tr>";
}

if ($row['thursday'] != '') {
  echo "<tr><td valign=\"top\" ><B>Thursday</b></td><td valign=\"top\" >{$row['thursday']}</td></tr>";
}

if ($row['friday'] != '') {
  echo "<tr><td valign=\"top\" ><B>Friday</b></td><td valign=\"top\" >{$row['friday']}</td></tr>";
}
if ($row['saturday'] != '') {
  echo "<tr><td valign=\"top\" ><B>Saturday</b></td><td valign=\"top\" >{$row['saturday']}</td></tr>";
}
if ($row['sunday'] != '') {
  echo "<tr><td valign=\"top\" ><B>Sunday</b></td><td valign=\"top\" >{$row['sunday']}</td></tr>";
}

echo"<tr><td colspan=\"2\" bgcolor='ffffff'></td></tr></font></table>";



 echo "<br /></td></tr></table><br>";
}
}
else
{
echo "No members to display.";
}
?> 
./profile/chart_logs.php
<?php 
session_start();
$_SESSION['currentpage'] = $_SERVER['REQUEST_URI'];
require("../include/config.php");
require("../include/functions.php");
?>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<?php
require("../include/header.php");
?>


<?php

if(isset($_SESSION['dj_logged_in']))
{
$session_username = $_SESSION['username'];
// further checking...
if(username_exists($session_username))
{

$query2="SELECT name FROM djs WHERE djname = '$anotherdj'";
$result2 = mysql_query ($query2);
$anotherdj = mysql_real_escape_string($_GET['anotherdj']);
$getdate = mysql_real_escape_string($_GET['datelist']);
$query="SELECT DISTINCT date FROM playlist WHERE dj = '$anotherdj' ORDER by date DESC";
$result = mysql_query ($query);
$getcatnumber = mysql_real_escape_string($_GET['catnumber']);
$getgenre = mysql_real_escape_string($_GET['genre']);
echo "
<div align=\"center\">


<table class=\"welcomebar\">
<tr>
<td class=\"date\">
Hound Dog Asshole Tracker: $getgenre $getcatnumber
</td>
<td class=\"loggedin\">
You're logged in as "; echo $session_username;
echo "
<a href=\"../login/logout.php\">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
</td>
</tr>
</table>
<br>

<form>
";


$query="SELECT genres FROM genres ORDER by genres ASC";
$result = mysql_query ($query);
echo "<select name=\"genre\">";
while($nt=mysql_fetch_array($result)){
echo "<option ";

if($nt['genres'] == $getgenre) { echo "selected"; }


echo "
 value=$nt[genres]>$nt[genres]</option>";
}
echo '</select>
  <input name="catnumber" type="text" id="catnumber" size="5" maxlength="4" />
    <input type="submit" name="button" id="button" value="Submit" />
</form>

<span class="edit"> <a href="index.php">[Music Charting]</a></span>
';






echo "



<br><br>
  <table class=\"playlist\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\">
    <tr>
	  <th class=\"headers\">Date </th>
	  <th class=\"headers\">Time </th>
	  <th class=\"headers\">CD </th>
	  <th class=\"headers\">Artist </th>
	  <th class=\"headers\">Album </th>
	  <th class=\"headers\">Last DJ to Play It </th>
	  <th class=\"headers\"> </th>


	  </tr>
";




$playlist = mysql_query("SELECT date,time,section,artist,album, sectionnumber,djs.name,djs.email FROM playlist, djs WHERE section = '$getgenre' AND sectionnumber = $getcatnumber AND playlist.dj = djs.username ORDER BY date DESC, TIME DESC LIMIT 5");
$numofrows = mysql_num_rows($playlist);

if(mysql_num_rows($playlist) > 0)
{
//create a loop, because there are rows in the DB

{

for($i = 0; $i < $numofrows; $i++) {
    $rows = mysql_fetch_array($playlist); //get a row from our result set
    if($i % 2) { //this means if there is a remainder
        echo "<TR bgcolor=\"#84C8FF\"  onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#84C8FF';\" >\n";
    } else { //if there isn't a remainder we will do the else
        echo "<TR bgcolor=\"ededed\" onmouseover=\"style.background='#FFFF00';\" onmouseout=\"style.background='#ededed';\">\n";
    }
    echo "
	  <td>".$rows['date']."</td>
	  <td>".$rows['time']."</td>
	  <td>".$rows['section']." ".$rows['sectionnumber']."</td>
	  <td>".$rows['artist']."</td>
	  <td>".$rows['album']."</td>

<td align=\"center\">

".$rows['name']."
</td>
<td class='edit' bgcolor='#000000' align='center'> <A HREF=\"javascript:popUp('biteem.php?name=$rows[name]&email=$rows[email]&date=$rows[date]&time=$rows[time]&section=$rows[section]&sectionnumber=$rows[sectionnumber]&artist=$rows[artist]&album=$rows[album]')\">[send e-mail]</a></td>



	  ";	


		  }
	  echo "</td></tr>";
		  }
	  echo '  <tr><td align="center" colspan="7" class="headers">Powered by '; include("../include/version.php"); echo '. Created by <a href="mailto:dalcock@nmu.edu">Dustin Alcock</a></td></tr> </table>
	  </div> ';
	}
else
{
echo '<span class="chooseadate">Select a genre and starting catalog number<br></span>';
}




}
else
{
echo '<b>Sorry, the username could not be found.</b>.';
}
}
else
{
echo '<meta HTTP-EQUIV="REFRESH" content="0; url=../login">';
}


?>
<br />
<div class="listfont" align="center">
<?php
require("../include/footer.php");
?></div>
<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
function popUp(URL) {
day = new Date();
id = day.getTime();
eval("page" + id + " = window.open(URL, '" + id + "', 'toolbar=1,scrollbars=0,location=0,statusbar=1,menubar=0,resizable=1,width=400,height=100,left = 312,top = 309');");
}
// End -->
</script>
./profile/register.php
<?php
require("../../config.php");
require("../include/functions.php");
echo '
<head>
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>
';
switch($_GET['action'])
{
case "new":

//--------------------------------------
// [New Registration]
//--------------------------------------
if(!isset($_POST['register']))
{
echo "<br><br><br><br><br>
<table align='center' width=\"400\" bgcolor=\"000000\" style=\"border:3px solid #aaeeee\"> <tr><td><br />
<img src=\"images/djreg.jpg\"><br /><br />
<form action='register.php?action=new' method='POST'>
<table class='register'>
<tr><td>
Login Name: </td><td>
<input type='text' name='username' class='register_box'> !!NO SPACES!!
</td></tr>
<tr><td colspan='2'>Your login name will not be shown anywhere on your profile. It is strickly for logging in only. <Br><br><Br></td></tr>
<tr><td>
Real Name: </td><td>
<input type='text' name='name' class='register_box'>
</td></tr><tr><td>
E-mail:</td><td>
<input type='text' name='email' class='register_box'>
(MUST BE REAL)</td></tr><tr><td>
Password: </td><td>
<input type='password' name='password1' class='register_box'>
</td></tr><tr><td>
Password Again: </td><td>
<input type='password' name='password2' class='register_box'>
</td></tr>
<tr><td>Show Time</td><td>

<select name='showday' class='register_box'>
            <option selected>Sunday</option>
            <option>Monday</option>
            <option>Tuesday</option>
            <option>Wednesday</option>
            <option>Thursday</option>
            <option>Friday</option>
            <option>Saturday</option>
          </select>


          <select name='showtime' class='register_box'>
            <option selected>PLEASE SELECT</option>
			<option>12AM-3AM</option>
            <option>3AM-6AM</option>
            <option>6AM-9AM</option>
            <option>9AM-Noon</option>
            <option>Noon-3PM</option>
            <option>3PM-6PM</option>
            <option>6PM-9PM</option>
            <option>9PM-12AM</option>
          </select>

       </td></tr>


<tr><td>
</td><td>
<input type='hidden' value='wupx' name='djscode' class='register_box'>
</td></tr><tr><td colspan='2'>Please make sure your e-mail, show time, and name are correct. The administrator will use it to verify and approve your account. <font color='#ff0000'><br><br>Your profile will not show up on the website until it has been verified that you are a DJ at Radio-X.</b><br><br>
<input type='submit' name='register' value='Register!' class='register_box'>
</td></tr></table>
</form>
</td></tr></table>
";
}
elseif(isset($_POST['register']))
{
//put errors into an array
$errors = array();
$set_djscode = "wupx";

if(!empty($_POST['djscode']))
{
if($_POST['djscode']==$set_djscode)
{
$name = mysql_real_escape_string($_POST['name']);
$username = mysql_real_escape_string($_POST['username']);
$password1 = mysql_real_escape_string($_POST['password1']);
$password2 = mysql_real_escape_string($_POST['password2']);
$showtime = mysql_real_escape_string($_POST['showtime']);
$showday = mysql_real_escape_string($_POST['showday']);
$email = mysql_real_escape_string($_POST['email']);
$activation_code = generateCode(25);
$userq = "SELECT username FROM accounts WHERE username = '$username' LIMIT 1";
$emailq = "SELECT email FROM accounts WHERE email = '$email' LIMIT 1";
}
else
{
$errors[] = "<br><br><br><br><br>
<table class=\"text\" align='center' width=\"400\" bgcolor=\"000000\" style=\"border:3px solid #44ff22\"> <tr><td><br /><img src=\"images/djreg.jpg\"><br /><br />See there errors below?  Thats because of the following, way to go!<br /><br />E-Staff Authorization Code not Valid!<br /><br /><a href=\"http://wupx.com/arcums/djs/register.php?action=new\">LET ME TRY AGAIN!!</a>";
}
}
else
{
$errors[] = "<br><br><br><br><br>
<table class=\"text\"  align='center' width=\"400\" bgcolor=\"000000\" style=\"border:3px solid #44ff22\"> <tr><td><br /><img src=\"images/djreg.jpg\"><br /><br />See there errors below?  Thats because of the following, way to go!<br /><br /><center><a href=\"http://wupx.com/arcums/djs/register.php?action=new\">LET ME TRY AGAIN!!</a></center><br /><br />E-Staff Authorization Code was blank! <br />";
}
if(empty($name))
{
$errors[] = "The name field was blank! <br />";
}
if(empty($username))
{
$errors[] = "The username field was blank! <br />";
}
if(mysql_num_rows(mysql_query($userq)) > 0)
{
$errors[] = "The username given is already in use! Please try another one! <br />";
}
if(empty($password1))
{
$errors[] = "The password field was blank! <br />";
}


if ($password1 != $_POST['password2'])
{
$errors[] = " Your passwords don't match.  Please go back and try again.<br />";
}


if(empty($email))
{
$errors[] = "The email field was blank! <br />";
}
if(mysql_num_rows(mysql_query($emailq)) > 0)
{
$errors[] = "The email given is already in use! Please try another one! <br />";
}
if(count($errors) > 0)
{
foreach($errors as $err)
{
echo $err;
}
}
else
{
$sqlq = "INSERT INTO accounts (username, name, encryptpass, showtime, showday, email, is_activated, activation_code)";
$sqlq .= "VALUES ('$username', '$name', '".md5($password2)."', '$showtime', '$showday', '$email', '0', '$activation_code')";
mysql_query($sqlq) or die(mysql_error());
echo "<h3>Thanks for registering!
You may now login and update your profile. However you will not be visable on the webiste until the Webmaster has approved you, verifying you are a DJ at Radio-X.<br>
<a href=\"..\">Login</a>
";
mail($admin_email, "New Registration, www.WUPX.com","
The following user has tried to register as a DJ. Please verify the user and accept if they are infact a Radio-X DJ.
Here are their login details:
Name: ".$name."
Username: ".$username."
E-Mail: ".$email."
Show Day: ".$showday."
Show Time: ".$showtime."
In order for the DJ to appear on the website, you must validate their account.
Click here to validate after checking the schedule to verify them.:
http://www.wupx.com/arcums/profile/register.php?action=activate&user=".$username."&code=".$activation_code."&email=".$email."
");
}
}
break;

case "activate":
//--------------------------------------
// [Activate Account]
//--------------------------------------
if(isset($_GET['user']) && isset($_GET['code']) && isset($_GET['email']))
{
$username = mysql_real_escape_string($_GET['user']);
if(mysql_num_rows(mysql_query("SELECT id FROM accounts WHERE username = '$username'")) == 0)
{
echo "That username is not in the database!";
}
else
{
$activate_query = "SELECT is_activated FROM accounts WHERE username = '$username'";
$is_already_activated = mysql_fetch_object(mysql_query($activate_query)) or die(mysql_error());
if($is_already_activated->is_activated == 1)
{
echo "The user $username is already activated!";
}
else
{
$code = mysql_real_escape_string($_GET['code']);
$code_query = "SELECT activation_code FROM accounts WHERE username = '$username' LIMIT 1";
$check_code = mysql_fetch_object(mysql_query($code_query)) or die(mysql_error());
if($code == $check_code->activation_code)
{
$update = "UPDATE djs SET is_activated = '1' WHERE username = '$username'";
mysql_query($update) or die(mysql_error());
echo "User $username has been activated! They will now appear on the site! <Br>An E-mail has been sent to them to let them know.</a>";
$getemail = mysql_real_escape_string($_GET['email']);
mail($getemail, "Radio-X Profile Approved","
The Webmaster has approved your account. You will now be listed on the website.
Login at http://www.wupx.com/arcums/djs
This link also appears on the DJ listing page for easy access.
Thank You! Radio-X
");
}
else
{
echo "The activation code was wrong! Please try again!";
}
}
}
}
else
{
echo "No ID or user given to activate!";
}
break;

}
?>
./profile/changepasswordparse.php
<?php 
session_start(); 
header("Cache-control: private"); 
if (!$_SESSION['username']) { 
    echo "You're not logged in!"; 
    include("login.html"); 
    exit(); 
} 
$username = $_SESSION['username']; 
$password = md5($_POST['pass']); 
$pass1 = mysql_real_escape_string($_POST['pass1']); 
include("../include/config.php"); 
// start with passwords 
if (($password) AND ($pass1) AND ($_POST['pass2'])) { 
// check if the authentication is right 
    if ($encryptpass != $_SESSION['encryptpass']) { 
        $error = " your current password is incorrect.</p>"; 
    } else { 
// otherwise, check if new passwords match 
        if ($pass1 != $_POST['pass2']) { 
            $error = " your new password selections don't match.</p>"; 
        } else { 
// otherwise, check if the password's legit 
            $legit = ereg("^[a-zA-Z0-9]{6,16}$", $pass1); 
            if (!$legit) { 
                $error = " your new password selections match, but aren't an appropriate length/form.</p>"; 
            } else { 
// authentication, match, legit, put the new pass in 
                $encryptpass = md5($pass1); 
                mysql_query("UPDATE djs SET encryptpass='$encryptpass' WHERE username='$username'") or die(mysql_error()); 
                $cpass = "<li>your password</li>"; 
                $_SESSION['encryptpass'] = $encryptpass; 
            } 
        } 
    } 
}  
?> 
<html><head><title>Change Password Results</title></head><body> 
<style>
body
{
background: #131313;
background-image: url('../images/bg.jpg');
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
.text
{
font-family: Verdana, Arial;
font-weight: bold;
font-size: 11px;
color: #FFFFFF;
}
.header
{
font-family: Verdana, Arial;
font-weight: bold;
font-size: 14px;
color: #FFFFFF;
}
.register_box
{
border: 1px solid #323232;
background: #202020;
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
a:link
{
color: c0c0c0;
}
a:visited
{
color: c0c0c0;
}
a:hover
{
color: 00ff00;
}
</style>
<div class="header">Change Password Results</div> 
<?php 
if (($cpass)) { 
    echo "<p>The following things have been changed:</p><ul>"; 
    if ($cpass) { 
        echo $cpass;	
    } 
    echo "</ul>To close this window, <a href=\"javascript:window.close();\">Close Window</a>.</p>"; 
} 
if ($error) { 
    echo "<p>Your password could not be changed because".$error; 
} elseif ((!$cpass) AND (!$error)) { 
    echo "None of your account settings were changed."; 
} 
?> 
</body></html> 
./profile/change_password.php
<html><head> 
<title>Change Profile Password</title> 
</head>
<style>
body
{
background: #131313;
background-image: url('../images/bg.jpg');
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
.text
{
font-family: Verdana, Arial;
font-weight: bold;
font-size: 11px;
color: #FFFFFF;
}
.header
{
font-family: Verdana, Arial;
font-weight: bold;
font-size: 14px;
color: #FFFFFF;
}
.register_box
{
border: 1px solid #323232;
background: #202020;
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
a:link
{
color: c0c0c0;
}
a:visited
{
color: c0c0c0;
}
a:hover
{
color: 00ff00;
}
</style>
<body>
<table><tr><td><div class="header">Change Account Settings</td></tr></table> 
Fill in only the fields you would like to change.  If you're going to change your password, it can only consist of alphanumeric characters (A-z,a-z,0-9) and must be between 6 and 16 characters long. 
<form action="changepasswordparse.php" method="post"> 
<table><tr><td>
<div class="text">Old Password: </td><td><input type="password" name="pass" size="20"><br /> </td></tr>
<tr><td><div class="text">New Password: </td><td><input type="password" name="pass1" size="20"><br />  </td></tr>
<tr><td><div class="text">New Password (again): </td><td><input type="password" name="pass2" size="20"><br /> 
</tr></td></table>
<input type="submit" value="Update Account" name="submit">

</form> 
</body></html> ./profile/delete_banner.php
<?php
session_start();
require_once ("../../config.php");
$username = mysql_real_escape_string($_SESSION['username']);
$sql = "UPDATE accounts SET banner='' WHERE username='$username'";
mysql_query($sql) or die(mysql_error());
header('location:index.php');
?>
./profile/index.php
<?php
session_start();
require ("../../config.php");
require ("../include/header.php");
require ("../include/functions.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require ("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<?php

if (isset($_SESSION['dj_logged_in'])) {
    $session_username = $_SESSION['username'];

    // further checking...
    if (username_exists($session_username)) {
        $get_info = mysql_query("SELECT * FROM accounts WHERE username = '$session_username' LIMIT 1");
        
        if (mysql_num_rows($get_info) > 0) {
            $user_info = mysql_fetch_assoc($get_info);
            
            if (!isset($_POST['do_edit'])) {
                echo '<center><br /><table width="600"> <tr><td>
<center>

<table class="welcomebar">
<tr>
<td class="date">
DJ Profile Editor
</td>
<td class="loggedin">
You\'re logged in as ';
                echo $session_username;
                echo '
<a href="../login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
</td>
</tr>
</table>

<table><tr><td bgcolor="#ededed" valign="top">

<img src="photos/' . $user_info['photo'] . '" width="125" height="150"><br>
<a href="index.php">Refresh Photo</a><br>
<A HREF="javascript:popUp(\'upload_image.php\')">Change Photo</A><br><br>

<a href="javascript:popUp(\'change_password.php\')">Change Password</a> <br>
<br>
';
                echo '
</td><td>
&nbsp;</td><td>
<center>
<form action="index.php" method="post">
  <table  bgcolor="#ededed" width="550" border="0" cellspacing="3" cellpadding="3">
<tr>
<td class="headers" colspan="2">
Promote Your Show:
</td></tr><tr><td colspan="2">
<center>
Promote your show by uploading a banner that will be shown on every page on our site.<br> Banner should be 425x75 pixels.  No larger then 80KB.<br>
';
                
                if ($user_info['banner'] != '') {
                    echo "<img src='banners/$user_info[banner]' alt='Banner Preview Will Be Here After Upload'><br>
<A HREF=\"delete_banner.php\" onclick=\"javascript:return confirm('Are you sure you want to delete your current banner?'); return false;\">Delete Banner</A> |";
                }
                echo '

<a href="index.php">Refresh Banner</a>
 | <A HREF="javascript:popUp(\'upload_banner.php\')">Upload Banner</A>
</td></tr>
<tr>
<td class="headers" colspan="2">
Personal Information
</td></tr><tr><td bgcolor="#0089bc" colspan="2">
</center>
<div class="textme">If you leave a question blank, it\'ll be hidden on the site.  Fill out only what you want to be shown. Your time <b><u>MUST</u></b> be filled out correctly though. <br><br> You can use "hide account" so that you can use the login for the Playlist application, but not be listed on the DJ profiles part of the site.</div>


</td>
</tr>
   <tr>
      <td class="headers"><b>Hide Account:</b></td>
      <td>
';
?>
          <select name="hideaccount" class="register_box" />
            <option value="0" <?php 
                if ($user_info['hideaccount'] == "0") {
                    echo "selected";
                } ?>>No</option>
            <option value="1" <?php 
                if ($user_info['hideaccount'] == "1") {
                    echo "selected";
                } ?>>Yes</option>
                      </select>
       <?php
                echo '
</td>
    </tr>
    <tr>
      <td width="200" ><b>Real Name:</b></td>
      <td><input type="text" name="name"   class="register_box" value="' . $user_info['name'] . '" /></td>
    </tr>
   <tr>
      <td class="headers"><b>DJ Name:</b></td>
      <td><input type="text" name="djname"   class="register_box" value="' . $user_info['djname'] . '" /></td>
    </tr>
    <tr>
      <td> <b>Show Name:</b></td>
      <td><input type="text" name="showname"  class="register_box" value="' . $user_info['showname'] . '" /></td>
    </tr>
<tr>
      <td class="headers"><b>Time Slot: </b></td>
      <td align="left">
';
?>
          <select name="showday" class="register_box" />
            <<option <?php 
                if ($user_info['showday'] == "Sunday") {
                    echo "selected";
                } ?>>Sunday</option>
            <option <?php 
                if ($user_info['showday'] == "Monday") {
                    echo "selected";
                } ?>>Monday</option>
            <option <?php 
                if ($user_info['showday'] == "Tuesday") {
                    echo "selected";
                } ?>>Tuesday</option>
           <option <?php 
                if ($user_info['showday'] == "Wednesday") {
                    echo "selected";
                } ?>>Wednesday</option>
             <option <?php 
                if ($user_info['showday'] == "Thursday") {
                    echo "selected";
                } ?>>Thursday</option>
          <option <?php 
                if ($user_info['showday'] == "Friday") {
                    echo "selected";
                } ?>>Friday</option>
          <option <?php 
                if ($user_info['showday'] == "Saturday") {
                    echo "selected";
                } ?>>Saturday</option>
          </select>
      
          <select name="showtime" class="register_box" />
            <option <?php 
                if ($user_info['showtime'] == "12AM-3AM") {
                    echo "selected";
                } ?>>12AM-3AM</option>
            <option <?php 
                if ($user_info['showtime'] == "3AM-6AM") {
                    echo "selected";
                } ?>>3AM-6AM</option>
            <option <?php 
                if ($user_info['showtime'] == "6AM-9AM") {
                    echo "selected";
                } ?>>6AM-9AM</option>
            <option <?php 
                if ($user_info['showtime'] == "9AM-Noon") {
                    echo "selected";
                } ?>>9AM-Noon</option>
            <option <?php 
                if ($user_info['showtime'] == "Noon-3PM") {
                    echo "selected";
                } ?>>Noon-3PM</option>
            <option <?php 
                if ($user_info['showtime'] == "3PM-6PM") {
                    echo "selected";
                } ?>>3PM-6PM</option>
            <option <?php 
                if ($user_info['showtime'] == "6PM-9PM") {
                    echo "selected";
                } ?>>6PM-9PM</option>
            <option <?php 
                if ($user_info['showtime'] == "9PM-12AM") {
                    echo "selected";
                } ?>>9PM-12AM</option>
          </select>
       <?php
                echo '
</td>
    </tr>

    <tr>
      <td><b>Show Genre:</b> </td>
      <td><input type="text" name="showgenre" class="register_box"  value="' . $user_info['showgenre'] . '" /></td>
    </tr>
    <tr>
      <td class="headers"> <b>E-mail:</b> </td>
      <td><input type="text" name="email" class="register_box"  value="' . $user_info['email'] . '" />
';
?>hide?
          <select name="hideemail" class="register_box" />
           <option  value="0" <?php 
                if ($user_info['hideemail'] == "0") {
                    echo "selected";
                } ?>>No</option>
           <option value="1" <?php 
                if ($user_info['hideemail'] == "1") {
                    echo "selected";
                } ?>>Yes</option>
                      </select>
       <?php
                echo '
</td>
    </tr>


    <tr>
      <td><b>AIM:</b> </td>
      <td><input type="text" name="aim" class="register_box"  value="' . $user_info['aim'] . '" /></td>
    </tr>
    <tr>
      <td class="headers"><b>Yahoo:</b> </td>
      <td><input type="text" name="yahoo" class="register_box"  value="' . $user_info['yahoo'] . '" /></td>
    </tr>
    <tr>
      <td><b>MSN:</b></td>
      <td><input type="text" name="msn"  class="register_box" value="' . $user_info['msn'] . '" /></td>
    </tr>
    <tr>
      <td class="headers"><b>Website:</b></td>
      <td><input type="text" name="website"  class="register_box" value="' . $user_info['website'] . '" /></td>
    </tr>
    <tr>
      <td><b>MySpace:</b></td>
      <td><input type="text" name="myspace" class="register_box"  value="' . $user_info['myspace'] . '" /></td>
    </tr>
    <tr>
      <td class="headers"><b>Major:</b></td>
      <td><input type="text" name="major"  class="register_box" value="' . $user_info['major'] . '" /></td>
    </tr>
    <tr>
      <td><b>Minor:</b></td>
      <td><input type="text" name="minor" class="register_box"  value="' . $user_info['minor'] . '" /></td>
    </tr>
    <tr>
      <td class="headers"><b>Home:</b></td>
      <td><input type="text" name="home" class="register_box"  value="' . $user_info['home'] . '" /></td>
    </tr>
    <tr>
      <td><b>Favorite Genre: </b></td>
      <td><input type="text" name="favgenre" class="register_box"  value="' . $user_info['favgenre'] . '" /></td>
    </tr>
    <tr>
      <td class="headers"><b>Favorite Artist:</b> </td>
      <td><input type="text" name="favartist" class="register_box"  value="' . $user_info['favartist'] . '" /></td>
    </tr>
    <tr>
      <td ><b>Favorite CD: </b></td>
      <td><input type="text" name="favcd" class="register_box"  value="' . $user_info['favcd'] . '" /></td>
    </tr>
    <tr>
      <td class="headers"><b>Favorite Movie: </b></td>
      <td><input type="text" name="favmovie"  class="register_box" value="' . $user_info['favmovie'] . '" /></td>
    </tr>
    <tr>
      <td><b>Biography:</b></td>
      <td><textarea name="bio"  cols="40" rows="8" class="register_box" />' . $user_info['bio'] . '</textarea></td></tr>
    </tr>
<tr>
      <td class="headers"></td>
      <td class="headers"><br></td></tr>

    <tr>
      <td><br></td>      <td>Current show time is set to: <b>' . $user_info['showday'] . ' @ ' . $user_info['showtime'] . ' </b></b><br><br><input type="submit" name="do_edit" class="register_box"  value="Update Profile" /></td>
    </tr>
    
  </table></td></tr></table>
</form><br /><br /></td></tr></table></center>
';
            }
            elseif (isset($_POST['do_edit'])) {
                $email = mysql_real_escape_string($_POST['email']);
                $name = mysql_real_escape_string($_POST['name']);
                $hideemail = mysql_real_escape_string($_POST['hideemail']);
                $hideaccount = mysql_real_escape_string($_POST['hideaccount']);
                $djname = mysql_real_escape_string($_POST['djname']);
                $showname = mysql_real_escape_string($_POST['showname']);
                $showtime = mysql_real_escape_string($_POST['showtime']);
                $showday = mysql_real_escape_string($_POST['showday']);
                $showgenre = mysql_real_escape_string($_POST['showgenre']);
                $aim = mysql_real_escape_string($_POST['aim']);
                $yahoo = mysql_real_escape_string($_POST['yahoo']);
                $msn = mysql_real_escape_string($_POST['msn']);
                $website = mysql_real_escape_string($_POST['website']);
                $myspace = mysql_real_escape_string($_POST['myspace']);
                $major = mysql_real_escape_string($_POST['major']);
                $minor = mysql_real_escape_string($_POST['minor']);
                $home = mysql_real_escape_string($_POST['home']);
                $favgenre = mysql_real_escape_string($_POST['favgenre']);
                $favartist = mysql_real_escape_string($_POST['favartist']);
                $favcd = mysql_real_escape_string($_POST['favcd']);
                $favmovie = mysql_real_escape_string($_POST['favmovie']);
                $bio = mysql_real_escape_string($_POST['bio']);

                // assign all errors to an array
                $errors = array();
                
                if (empty($email)) {
                    $errors[] = 'Your email was empty.';
                }
                
                if (!is_valid_email($email)) {
                    $errors[] = 'Your email was not in a valid email format.';
                }

                // if array elements is greater than 0,
                // then we KNOW there was an error

                // else, no error, move on to processing

                
                if (count($errors) > 0) {
                    echo '<b>ERRORS:</b><br />';
                    
                    foreach ($errors as $err) {
                        echo $err . '<br />';
                    }
                }
                else {

                    // everything is ok, update the DB
                    mysql_query("UPDATE accounts SET email = '$email', bio = '$bio', hideemail = '$hideemail', hideaccount = '$hideaccount', name = '$name', showname = '$showname', showtime = '$showtime', aim = '$aim', yahoo = '$yahoo', msn = '$msn', website = '$website', myspace = '$myspace', major = '$major', djname = '$djname', minor = '$minor', home = '$home', favgenre = '$favgenre', favartist = '$favartist', favcd = '$favcd', favmovie = '$favmovie', showgenre = '$showgenre', showday = '$showday' WHERE username = '$session_username'") or die(mysql_error());
                    echo "<div class='headers'>Profile Updated. <a class='headers' href'index.php'>Continue...</a></div>";
                }
            }
        }
        else {
            echo 'Could not find profile info for your username.';
        }
    }
    else {
        echo '<b>Sorry, your session username doesnt exist</b>.';
    }
}
else {
    echo '<div class="headers">&nbsp;&nbsp;You must be logged in to edit your profile. <a class="headers" href="../login/index.php">Go to login page...</a></div>';
}
?>
<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
function popUp(URL) {
day = new Date();
id = day.getTime();
eval("page" + id + " = window.open(URL, '" + id + "', 'toolbar=1,scrollbars=0,location=0,statusbar=1,menubar=0,resizable=1,width=400,height=225,left = 312,top = 309');");
}
// End -->
</script>
./profile/upload_banner.php
<html><head> 
<title>Upload Banner</title> 
</head>
<style>
body
{
background: #131313;
background-image: url('../images/bg.jpg');
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
.register_box
{
border: 1px solid #323232;
background: #202020;
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
a:link
{
color: c0c0c0;
}
a:visited
{
color: c0c0c0;
}
a:hover
{
color: 00ff00;
}
</style>
<body> 
<table><tr><td><h3>Upload Banner</td></tr></table>
Your banner must be less than 80 Kb in size and in .jpg, .gif or .jpeg format.<br /> 
Please create your banner at 425x75 pixels! <br /> <br /> Contact itdirector@wupx.com for support.  <br /><br /><b>NO NUDITY OR INAPPROPRITE BANNERS ALLOWED!</b>
<form action="changebannerparse.php" method="post" enctype="multipart/form-data"> 
<input type="hidden" name="MAX_FILE_SIZE" value="81920"> 
<input type="file" name="userbanner"><br /> <br /> 
<input type="submit" name="submit" value="Upload Photo"></form> 
</body></html> ./profile/view_profile.php
<?php include("../../header.php");?>
<?php
session_start();
require("../include/config.php");
require("../include/functions.php");

//echo some styles to spice it up...
echo "
";
// if the variable member_id has been set, or there is a value assigned to it...
if(isset($_GET['member_id']))
{
$member_id = (INT)$_GET['member_id'];
$member_info = mysql_query("SELECT * FROM djs WHERE is_activated = '1' AND id = '$member_id' LIMIT 1");
if(mysql_num_rows($member_info) > 0)
{
// we can go ahead and assign it to an array because this user exists
$profile_info = mysql_fetch_assoc($member_info);



echo "
<table><tr><td width=\"438\">
<h1>$profile_info[djname]</h1>";
echo "
<table width=\"100%\" height=\"160\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">
  <tr>
    <td width=\"125\" height=\"150\" valign=\"top\" rowspan=\"3\"><img src=\"photos/{$profile_info['photo']}\" width=\"125\" height=\"150\"></td>
    <td width=\"90%\" valign=\"top\" align=\"center\"><table width=\"95%\" height=\"0\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">";

if ($profile_info['name'] != '') {
  echo "<tr><td valign=\"top\" ><B>Real Name:</b></td> <td valign=\"top\" >{$profile_info['name']}</td></tr>";
}

if ($profile_info['showname'] != '') {
  echo "<tr><td valign=\"top\" ><B>Show Name:</b></td><td valign=\"top\" >{$profile_info['showname']}</td></tr>";
}

if ($profile_info['showday'] != '') {
  echo "<tr><td valign=\"top\" ><B>Show Day: </b></td><td valign=\"top\" >{$profile_info['showday']}</td></tr>";
}

if ($profile_info['showtime'] != '') {
  echo "<tr><td valign=\"top\" ><B>Show Time: </b></td><td valign=\"top\" >{$profile_info['showtime']}</td></tr>";
}

if ($profile_info['showgenre'] != '') {
  echo "<tr><td valign=\"top\" ><B>Show Genre: </b></td><td valign=\"top\" > {$profile_info['showgenre']}</td></tr>";
}

echo "</table>
</td></tr></table>
  <tr>
    <td colspan=\"2\" valign=\"top\">";


if ($profile_info['hideemail'] == '0') {
  echo "<B>E-Mail: </b><a href='mailto:$profile_info[email]'>$profile_info[email]</a><br>";
}

if ($profile_info['aim'] != '') {
  echo "<B>AIM: </b>{$profile_info['aim']}<br>";
}

if ($profile_info['yahoo'] != '') {
  echo "<B>Yahoo: </b>{$profile_info['yahoo']}<br>";
}

if ($profile_info['msn'] != '') {
  echo "<B>MSN: </b>{$profile_info['msn']}<br>";
}

if ($profile_info['website'] != '') {
  echo "<B>Website: </b><a href='$profile_info[website]' target=\"_blank\">{$profile_info['website']}</a><br>";
}

if ($profile_info['myspace'] != '') {
  echo "<B>MySpace: </b><a href=\"$profile_info[myspace]\" target=\"_blank\">{$profile_info['myspace']}</a><br>";
}

if ($profile_info['major'] != '') {
  echo "<B>Major: </b>{$profile_info['major']}<br>";
}

if ($profile_info['minor'] != '') {
  echo "<B>Minor: </b>{$profile_info['minor']}<br>";
}

if ($profile_info['home'] != '') {
  echo "<B>Home Town: </b>{$profile_info['home']}<br>";
}

if ($profile_info['favgenre'] != '') {
  echo "<B>Favorite Genre: </b>{$profile_info['favgenre']}<br>";
}

if ($profile_info['favartist'] != '') {
  echo "<B>Favorite Artist: </b>{$profile_info['favartist']}<br>";
}

if ($profile_info['favcd'] != '') {
  echo "<B>Favorite Album: </b>".stripslashes($profile_info['favcd'])."<br>";
}

if ($profile_info['favmovie'] != '') {
  echo "<B>Favorite Movie: </b>" . stripslashes($profile_info['favmovie']) . "<br>";
}
if ($profile_info['bio'] != '') {
  echo "<B>Biography: </b>" . stripslashes($profile_info['bio']) . "<br>";
}

echo "
</td>
  </tr>
</table>";



}
else
{
echo "That member does not exist, or is not activated yet!";
} 
}
else
{
echo "There was no member ID to view a profile for!";
}
?> 
<?php include("../../footer.php");?>
./profile/changephotoparse.php
<?php 
session_start(); 
header("Cache-control: private"); 
if (!$_SESSION['username']) { 
    echo "You're not logged in!"; 
    include("login.php"); 
    exit(); 
} 
$username = $_SESSION['username']; 
include("../include/config.php"); 
$maxfilesize = 81920; 
// check if there was a file uploaded 
if (!is_uploaded_file($_FILES['userphoto']['tmp_name'])) { 
    $error = "you didn't select a file to upload or the file size was over 80kb.<br />"; 
// if it was, go ahead with other checks 
} else { 
    if ($_FILES['userphoto']['size'] > $maxfilesize) { 
        $error = "your image file was too large.<br />"; 
        unlink($_FILES['userphoto']['tmp_name']); 
    } else { 
        $ext = strrchr($_FILES['userphoto']['name'], "."); 
        if ($ext != ".gif" AND $ext != ".jpg" AND $ext != ".jpeg" AND $ext != ".bmp" AND $ext != ".GIF" AND $ext != ".JPG" AND $ext != ".JPEG" AND $ext != ".BMP") { 
            $error = "your file was an unacceptable type.<br />"; 
            unlink($_FILES['userphoto']['tmp_name']); 
        // if it's there, an okay size and type, copy to server and update the photo value in SQL 
        } else { 
            if ($_SESSION['photo'] != "nonpic.jpg") { 
                unlink("photos/".$_SESSION['photo']); 
            } 
            $newname = $_SESSION['username'].$ext; 
            move_uploaded_file($_FILES['userphoto']['tmp_name'],"photos/".$newname); 
            mysql_query("UPDATE djs SET photo='$newname' WHERE username='$username'") or die (mysql_error()); 
            $_SESSION['photo'] = $newname; 
        } 
    } 
} 
?> 
<html><head><style>
body
{
background: #131313;
background-image: url('../images/bg.jpg');
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
.register_box
{
border: 1px solid #323232;
background: #202020;
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
a:link
{
color: c0c0c0;
}
a:visited
{
color: c0c0c0;
}
a:hover
{
color: 00ff00;
}
</style><title>Change Photo Result</title></head><body> 
<h1>Change Photo Result</h1> 
<?php 
if ($error) { 
    echo "Your photo could not be changed because ".$error.""; 
} else { 
    echo "Your photo was successfully uploaded."; 
} 
?></body></html> ./profile/staff_edit.php
<?php
session_start();
require("../../config.php");
require("../include/functions.php");
require("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
if(isset($_SESSION['dj_logged_in']))
{
$session_username = $_SESSION['username'];
// further checking...
if(username_exists($session_username))
{
$get_info = mysql_query("SELECT * FROM accounts WHERE username = '$session_username' LIMIT 1");
if(mysql_num_rows($get_info) > 0)
{
$user_info = mysql_fetch_assoc($get_info);
if(!isset($_POST['do_edit']))
{
echo '<center><br /><table width="600"> <tr><td>
<center>

<table class="welcomebar">
<tr>
<td class="date">
Staff Profile Editor
</td>
<td class="loggedin">
You\'re logged in as '; echo $session_username;
echo '
<a href="../login/logout.php">[logout]</a>&nbsp;&nbsp;&nbsp;&nbsp;
</td>
</tr>
</table>

<table><tr><td bgcolor="#ededed" valign="top">

<img src="photos/' . $user_info['photo'] . '" width="125" height="150"><br>
<a href="index.php">Refresh Photo</a><br>
<A HREF="javascript:popUp(\'upload_image.php\')">Change Photo</A><br><br>

<a href="javascript:popUp(\'change_password.php\')">Change Password</a> <br>
<br>
';



if ($user_info['permissions'] >= '3') {
  echo '
<a href="index.php">DJ Profile</a>

';
}



echo '
</td><td>
&nbsp;</td><td>
<center>
<form action="staff_edit.php" method="post">
  <table  bgcolor="#ededed" width="550" border="0" cellspacing="3" cellpadding="3">
<tr>
<td class="headers" colspan="2">
Promote Your Show:
</td></tr><tr><td colspan="2">
<center>
Promote your show by uploading a banner that will be shown on every page on our site.<br> Banner should be 425x75 pixels.  No larger then 80KB.<br>
';

if ($user_info['banner'] != '') {
  echo "<img src='banners/$user_info[banner]' alt='Banner Preview Will Be Here After Upload'><br>
<A HREF=\"delete_banner.php\" onclick=\"javascript:return confirm('Are you sure you want to delete your current banner?'); return false;\">Delete Banner</A> |";
}

echo '

<a href="index.php">Refresh Banner</a>
 | <A HREF="javascript:popUp(\'upload_banner.php\')">Upload Banner</A>
</td></tr>
<tr>
<td class="headers" colspan="2">
Personal Information
</td></tr><tr><td bgcolor="#0089bc" colspan="2">
</center>
<div class="textme">If you leave a question blank, it\'ll be hidden on the site.  Fill out only what you want to be shown. Your time <b><u>MUST</u></b> be filled out correctly though. <br><br> You can use "hide account" so that you can use the login for the Playlist application, but not be listed on the DJ profiles part of the site.</div>


</td>
</tr>
  


<tr>
      <td class="headers"> <b>Position:</b> </td>
      <td> &nbsp;<input type="text" name="position"  class="register_box" value="' . $user_info['position'] . '" /></td>
    </tr>

 
    <tr>
      <td bgcolor="06bc00"><b>Goals:</b></td>
      <td> &nbsp;<textarea name="goals"  cols="40" rows="8" class="register_box" />'.$user_info['goals'] . '</textarea></td></tr><tr>
      <td bgcolor="000000"><b>Office Hours:</b></td>
      <td>

<table>
 <tr>
<td bgcolor="06bc00"><b>Monday</b></td>
      <td><input type="text" name="monday" class="register_box"  value="' . $user_info['monday'] . '" /></td>
</tr>
 <tr>
<td bgcolor="06bc00"><b>Tuesday</b></td>
      <td><input type="text" name="tuesday" class="register_box"  value="' . $user_info['tuesday'] . '" /></td>
</tr>
 <tr>
<td bgcolor="06bc00"><b>Wednesday</b></td>
      <td><input type="text" name="wednesday" class="register_box"  value="' . $user_info['wednesday'] . '" /></td>
</tr>
 <tr>
<td bgcolor="06bc00"><b>Thursday</b></td>
      <td><input type="text" name="thursday" class="register_box"  value="' . $user_info['thursday'] . '" /></td>
</tr>
 <tr>
<td bgcolor="06bc00"><b>Friday</b></td>
      <td><input type="text" name="friday" class="register_box"  value="' . $user_info['friday'] . '" /></td>
</tr>
 <tr>
<td bgcolor="06bc00"><b>Saturday</b></td>
      <td><input type="text" name="saturday" class="register_box"  value="' . $user_info['saturday'] . '" /></td>
</tr>

<tr>
<td bgcolor="06bc00"><b>Sunday</b></td>
      <td><input type="text" name="sunday" class="register_box"  value="' . $user_info['sunday'] . '" /></td>
</tr>

</table>
 
<tr>
      <td class="headers"></td>
      <td class="headers"><br></td></tr>

    <tr>
      <td><br></td>      <td><input type="submit" name="do_edit" class="register_box"  value="Update Profile" /></td>
    </tr>
    
  </table></td></tr></table>
</form><br /><br /></td></tr></table></center>
';
}
elseif(isset($_POST['do_edit']))
{


//Staff options
$position = mysql_real_escape_string($_POST['position']);
$goals = mysql_real_escape_string($_POST['goals']);
$monday = mysql_real_escape_string($_POST['monday']);
$tuesday = mysql_real_escape_string($_POST['tuesday']);
$wednesday = mysql_real_escape_string($_POST['wednesday']);
$thursday = mysql_real_escape_string($_POST['thursday']);
$friday = mysql_real_escape_string($_POST['friday']);
$saturday = mysql_real_escape_string($_POST['saturday']);
$sunday = mysql_real_escape_string($_POST['sunday']);


// if array elements is greater than 0,
// then we KNOW there was an error
// else, no error, move on to processing
if(count($errors) > 0)
{
echo '<b>ERRORS:</b><br />';
foreach($errors as $err)
{
echo $err . '<br />';
}
}
else
{
// everything is ok, update the DB
mysql_query("UPDATE djs SET position = '$position', monday = '$monday', tuesday = '$tuesday', wednesday = '$wednesday', thursday = '$thursday', friday = '$friday', saturday = '$saturday', sunday = '$sunday', goals = '$goals' WHERE username = '$session_username'");
echo "<div class='headers'>Profile Updated. <a class='headers' href'index.php'>Continue...</a></div>";

}
}
}
else
{
echo 'Could not find profile info for your username.';
}
}
else
{
echo '<b>Sorry, your session username doesnt exist</b>.';
}
}
else
{
echo '<div class="headers">&nbsp;&nbsp;You must be logged in to edit your profile. <a class="headers" href="../login/index.php">Go to login page...</a></div>';
}
?>
<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
function popUp(URL) {
day = new Date();
id = day.getTime();
eval("page" + id + " = window.open(URL, '" + id + "', 'toolbar=1,scrollbars=0,location=0,statusbar=1,menubar=0,resizable=1,width=400,height=225,left = 312,top = 309');");
}
// End -->
</script>
./profile/changebannerparse.php
<?php 
session_start(); 
require_once("../../config.php"); 

header("Cache-control: private"); 
if (!$_SESSION['username']) { 
    echo '<div class="headers">&nbsp;&nbsp;You must be logged in to edit your profile. <a class="headers" href="../login/index.php">Go to login page...</a></div>';
    exit(); 
} 
$username = $_SESSION['username']; 

$maxfilesize = 81920; 
// check if there was a file uploaded 
if (!is_uploaded_file($_FILES['userbanner']['tmp_name'])) { 
    $error = "you didn't select a file to upload or the file size was to large.<br /><br><a href='upload_banner.php'>Try again...</a>"; 
// if it was, go ahead with other checks 
} else { 
    if ($_FILES['userbanner']['size'] > $maxfilesize) { 
        $error = "your image file was too large.<br />"; 
        unlink($_FILES['userbanner']['tmp_name']); 
    } else { 
        $ext = strrchr($_FILES['userbanner']['name'], "."); 
        if ($ext != ".gif" AND $ext != ".jpg" AND $ext != ".jpeg" AND $ext != ".bmp" AND $ext != ".GIF" AND $ext != ".JPG" AND $ext != ".JPEG" AND $ext != ".BMP") { 
            $error = "your file was an unacceptable type.<br />"; 
            unlink($_FILES['userbanner']['tmp_name']); 
        // if it's there, an okay size and type, copy to server and update the banner value in SQL 
        } else { 
            if ($_SESSION['banner'] != "nonpic.jpg" && $_SESSION['banner']!="") { 
                unlink("banners/".$_SESSION['banner']); 
            } 
            $newname = $_SESSION['username'].$ext; 
            move_uploaded_file($_FILES['userbanner']['tmp_name'],"banners/".$newname); 
            mysql_query("UPDATE accounts SET banner='$newname' WHERE username='$username'") or die (mysql_error()); 
            $_SESSION['banner'] = $newname; 
        } 
    } 
} 
?> 
<html><head><style>
body
{
background: #131313;
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
.register_box
{
border: 1px solid #323232;
background: #202020;
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
a:link
{
color: c0c0c0;
}
a:visited
{
color: c0c0c0;
}
a:hover
{
color: 00ff00;
}
</style><title>Banner Upload Result</title></head><body> 
<h1Banner Upload Result</h1> 
<?php 
if ($error) { 
    echo "Your banner could not be uploaded because ".$error.""; 
} else { 
    echo "Your banner was successfully uploaded."; 
} 
?></body></html> 
./include/version.php
ARCUMS 4.2
./include/header.php
<?php
echo "
	<div id='topbar'>
	<a href='$root/arcums/playlist/index.php'><img src='$root/arcums/images/arcumsheader.png' width='203' height='58' border='0' /></a>
	</div>
	<div id='topbarmenuother' class='menu'>
	<table><tr><td>
";

$session_username = $_SESSION['username'];

//Get playlists for this DJ and shoe select form
$query = "SELECT DISTINCT date FROM playlist WHERE dj = '$session_username' ORDER by date DESC";
$result = mysql_query($query) or die(mysql_error());
echo "<form action='$root/playlist/viewdate.php'><u>Past Playlists</u><br><select name='datelist'>";

while ($datelist = mysql_fetch_array($result)) {
    echo "<option value='$datelist[date]'>$datelist[date]</option>";
}

echo "</select><input type='hidden' name='anotherdj' value='$session_username'><input type=\"submit\" value=\"View\"></form>";
?></td><td>


<?php
//Show select for other DJs playlist
$query = "SELECT * FROM djs ORDER by name ASC";
$result = mysql_query($query);
echo "
	<form action='$root/playlist/selectdate.php' method='get'>
	<u>Other DJs Playlists</u>
	<br>
	<select name='anotherdj'>
";

while ($nt = mysql_fetch_array($result)) {
    echo "<option value=$nt[username]>$nt[name]</option>";
}
echo "</select> <input type=\"submit\" value=\"View\"></form>";
?>

&nbsp;&nbsp;&nbsp;<a href="<? echo $root; ?>/arcums/playlist/index.php">Playlist</a> | <a href="<? echo $root; ?>/arcums/profile/">My Profile</a>
| <a href="<? echo $root; ?>/arcums/downloads/">Record Show</a> | <a href="<? echo $root; ?>/arcums/blog/">Blog</a> | <a href="<? echo $root; ?>/arcums/catalog/">Catalog</a>


</div></td></tr></table></div>
<br><br><br><br>

<?php
$get_info = mysql_query("SELECT * FROM accounts WHERE username = '$session_username' LIMIT 1");

    //PERMISSIONS
    //1=DJ
    //2=Genre Director
    //3=Staff
    //4=Administrator

if (mysql_num_rows($get_info) > 0) {
    $user_info = mysql_fetch_assoc($get_info);
    
    if ($user_info['permissions'] == '2') {
        echo '
		<table width="735" align="center">
		<tr><td class="headers" align="center">Genre Director Menu: &nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../charting/index.php">Arcums Charting </a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../catalog/menu.php">Catalog Admin</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../webcharting/index.php">WebCharting</a>&nbsp;&nbsp;&nbsp;&nbsp;
		</td></tr>
		</table>
	';
    }
    
    if ($user_info['permissions'] == '3') {
        echo '
		<table width="735" align="center">
		<tr><td class="headers" align="center">Staff Menu: &nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../profile/staff_edit.php">Staff Profile </a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../charting/index.php">Arcums Charting </a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../charting/tracker.php">CD Tracker </a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../local_bands/index.php">Local Bands[TESTING]</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../webcharting/index.php">WebCharting</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../catalog/menu.php">Catalog Admin</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../events/index.php">Events</a>&nbsp;&nbsp;&nbsp;&nbsp;
		</td></tr>
		</table>
	';
    }
    
    if ($user_info['permissions'] == '4') {
        echo '
		<table width="735" align="center">
		<tr><td class="headers" align="center">Staff Menu: &nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../profile/staff_edit.php">Staff Profile </a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../charting/index.php">Arcums Charting </a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../charting/tracker.php">CD Tracker </a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../local_bands/index.php">Local Bands[TESTING]</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../webcharting/index.php">WebCharting</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../catalog/menu.php">Catalog Admin</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../events/index.php">Events</a>&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="../user_control.php">User Control</a>&nbsp;&nbsp;&nbsp;&nbsp;
		</td></tr>
		</table>
	';
    }
}
?>
./include/catalog_functions.php
<script type="text/javascript">
function DoNav(theUrl)
  {
  document.location.href = theUrl;
  }
</script>
<?php


 function parse($data, $delimiter = ',', $enclosure = '"', $newline = "\n"){
        $pos = $last_pos = -1;
        $end = strlen($data);
        $row = 0;
        $quote_open = false;
        $trim_quote = false;

        $return = array();

        // Create a continuous loop
        for ($i = -1;; ++$i){
            ++$pos;
            // Get the positions
            $comma_pos = strpos($data, $delimiter, $pos);
            $quote_pos = strpos($data, $enclosure, $pos);
            $newline_pos = strpos($data, $newline, $pos);

            // Which one comes first?
            $pos = min(($comma_pos === false) ? $end : $comma_pos, ($quote_pos === false) ? $end : $quote_pos, ($newline_pos === false) ? $end : $newline_pos);

            // Cache it
            $char = (isset($data[$pos])) ? $data[$pos] : null;
            $done = ($pos == $end);

            // It it a special character?
            if ($done || $char == $delimiter || $char == $newline){

                // Ignore it as we're still in a quote
                if ($quote_open && !$done){
                    continue;
                }

                $length = $pos - ++$last_pos;

                // Is the last thing a quote?
                if ($trim_quote){
                    // Well then get rid of it
                    --$length;
                }

                // Get all the contents of this column
                $return[$row][] = ($length > 0) ? str_replace($enclosure . $enclosure, $enclosure, substr($data, $last_pos, $length)) : '';

                // And we're done
                if ($done){
                    break;
                }

                // Save the last position
                $last_pos = $pos;

                // Next row?
                if ($char == $newline){
                    ++$row;
                }

                $trim_quote = false;
            }
            // Our quote?
            else if ($char == $enclosure){

                // Toggle it
                if ($quote_open == false){
                    // It's an opening quote
                    $quote_open = true;
                    $trim_quote = false;

                    // Trim this opening quote?
                    if ($last_pos + 1 == $pos){
                        ++$last_pos;
                    }

                }
                else {
                    // It's a closing quote
                    $quote_open = false;

                    // Trim the last quote?
                    $trim_quote = true;
                }

            }

        }

        return $return;
    }



//find the image from amzon, updates the database, and returns the image link (NONE if there is no image)
function findImage($upc){
//get images for the albums you can
	include_once("../../../config.php");
	//$result = mysql_query("SELECT * FROM albums WHERE id='" . $id . "'");
	//$row = mysql_fetch_row($result);
	$pxml = aws_signed_request("com", array("Operation"=>"ItemSearch","SearchIndex"=>"Music","Keywords"=>$upc,"ResponseGroup"=>"Large"), $amzon_public_key, $amazon_private_key);
	if (isset($pxml->Items->Item->LargeImage->URL)){
		$image = $pxml->Items->Item->LargeImage->URL;
		mysql_query("UPDATE albums SET image='" . $image . "' WHERE upc='". $upc . "'") or die(mysql_error());
		return $image;
	}
	else{
		//mysql_query("UPDATE albums SET image='NONE' WHERE id='". $id . "'") or die(mysql_error());
		return "NONE";
	}
}

function get_similar($artist, $limit=9999){
	require_once("../../config.php");
	global $audioscrobbler_api_key;
	$url = "http://ws.audioscrobbler.com/2.0/?method=artist.getSimilar&artist=" . urlencode($artist) . "&api_key=" . $audioscrobbler_api_key . "&limit=" . $limit;
	$response = @file_get_contents($url);
	if(!$response){
		return false;
	}
	else{
		$xml = simplexml_load_string($response);
		return $xml;
	}
}

function addSong($artist, $song, $section, $sectionnumber, $album, $label, $tracknumber){
	$requested = 0;

	$date= date("Y-m-d");
	$time = date("H:i:s");
	$datetime = date("YmdHis");

	$listeners = 0;

		$URL="http://wupx.com/arcums/playlist/addparse.php"; 
		$ch = curl_init();    
		curl_setopt($ch, CURLOPT_URL,$URL);  
		curl_setopt($ch, CURLOPT_POST, 1); 
		curl_setopt($ch, CURLOPT_POSTFIELDS, "artist=$artist&song=$song&section=$section&sectionnumber=$sectionnumber&album=$album&label=$label&tracknumber=$tracknumber&requested=$requested&date=$date&time=$time&datetime=$datetime&listeners=$listeners");curl_exec ($ch);     
		curl_close ($ch); 
}


function aws_signed_request($region, $params, $public_key, $private_key)
{
    /*
    Copyright (c) 2009 Ulrich Mierendorff

    Permission is hereby granted, free of charge, to any person obtaining a
    copy of this software and associated documentation files (the "Software"),
    to deal in the Software without restriction, including without limitation
    the rights to use, copy, modify, merge, publish, distribute, sublicense,
    and/or sell copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
    THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
    DEALINGS IN THE SOFTWARE.
    */
    
    /*
    Parameters:
        $region - the Amazon(r) region (ca,com,co.uk,de,fr,jp)
        $params - an array of parameters, eg. array("Operation"=>"ItemLookup",
                        "ItemId"=>"B000X9FLKM", "ResponseGroup"=>"Small")
        $public_key - your "Access Key ID"
        $private_key - your "Secret Access Key"
    */

    // some paramters
    $method = "GET";
    $host = "ecs.amazonaws.".$region;
    $uri = "/onca/xml";
    
    // additional parameters
    $params["Service"] = "AWSECommerceService";
    $params["AWSAccessKeyId"] = $public_key;
    // GMT timestamp
    $params["Timestamp"] = gmdate("Y-m-d\TH:i:s\Z");
    // API version
    $params["Version"] = "2009-03-31";
    
    // sort the parameters
    ksort($params);
    
    // create the canonicalized query
    $canonicalized_query = array();
    foreach ($params as $param=>$value)
    {
        $param = str_replace("%7E", "~", rawurlencode($param));
        $value = str_replace("%7E", "~", rawurlencode($value));
        $canonicalized_query[] = $param."=".$value;
    }
    $canonicalized_query = implode("&", $canonicalized_query);
    
    // create the string to sign
    $string_to_sign = $method."\n".$host."\n".$uri."\n".$canonicalized_query;
    
    // calculate HMAC with SHA256 and base64-encoding
    $signature = base64_encode(hash_hmac("sha256", $string_to_sign, $private_key, True));
    
    // encode the signature for the request
    $signature = str_replace("%7E", "~", rawurlencode($signature));
    
    // create request
    $request = "http://".$host.$uri."?".$canonicalized_query."&Signature=".$signature;    

    // do request
	//echo $request;  
  $response = @file_get_contents($request);
    
    if ($response === False)
    {
        return False;
    }
    else
    {
        // parse XML

//OUTPUT THE RESPONSE TO A FILE	
//$myFile = "testFile.txt";
//$fh = fopen($myFile, 'w') or die("can't open file");
//fwrite($fh, $response);


//	echo $response,"<br><br>";
        $pxml = simplexml_load_string($response);
  
      if ($pxml === False)
        {
            return False; // no xml
        }
        else
        {
            return $pxml;
        }
    }
}
?>
./include/stream_functions.php
<?php

require_once("../../config.php");

function getCurrentListeners(){
	global $sc_conf;	
	$total = 0;
	foreach ($sc_conf as $sc_serv){
		$host = $sc_serv['host'];
		$port = $sc_serv['port'];
		$password = $sc_serv['password'];
		$total += getStreamListeners($host,$password,$port);
	}
	return $total;
}


function getStreamListeners($hostname,$pwd, $port) {
        $fp = @fsockopen($hostname, $port, &$errno, &$errstr, 30); // connect to the server

        $shoutcastXML = "";

        if ($fp) {
                // authenticate, and get xml feed from shoutcast administration
                fputs($fp, "GET /admin.cgi?mode=viewxml HTTP/1.1\r\nHost: $hostname:$port\r\n".
                "User-Agent: Shoutcast Stats (Mozilla Compatible)\r\n".
                "Authorization: Basic ".base64_encode ("admin:$pwd")."\r\n\r\n");

                while (!feof($fp)) {
                        // we only care about the xml, so only keep last line, discard headers
                        $shoutcastXML = fgets($fp, 8192);
                }
		//echo $shoutcastXML;
                @fclose($fp);
        }

        $shoutcastXML = ($shoutcastXML != "") ? simplexml_load_string($shoutcastXML) : false;

	$result = $shoutcastXML->CURRENTLISTENERS;
        
	if ($result != "")
                return $result;
	else{
		return "0";
	}

}


?>
./include/functions.php
<?php

function generateCode($length = 10) {
    $password = "";
    $chars = "abcdefghijklmnpqrstuvwxyzABCDEFGHIJKLMNPQRSTUVWXYZ123456789";
    srand((double)microtime() * 1000000);
    
    for ($i = 0;$i < $length;$i++) {
        $password = $password . substr($chars, rand() % strlen($chars) , 1);
    }
    
    return $password;
}

function username_exists($username) {
    $query = mysql_query("SELECT username FROM accounts WHERE username = '$username' LIMIT 1");
    
    return (mysql_num_rows($query) > 0) ? TRUE : FALSE;
}

function is_valid_email($email) {

    // First, we check that there's one @ symbol,
    // and that the lengths are right.

    
    if (!ereg("^[^@]{1,64}@[^@]{1,255}$", $email)) {

        // Email invalid because wrong number of characters
        // in one section or wrong number of @ symbols.

        
        return false;
    }

    // Split it into sections to make life easier
    $email_array = explode("@", $email);
    $local_array = explode(".", $email_array[0]);
    
    for ($i = 0;$i < sizeof($local_array);$i++) {
        
        if (!ereg("^(([A-Za-z0-9!#$%&'*+/=?^_`{|}~-][A-Za-z0-9!#$%&
'*+/=?^_`{|}~\.-]{0,63})|(\"[^(\\|\")]{0,62}\"))$", $local_array[$i])) {
            
            return false;
        }
    }

    // Check if domain is IP. If not,
    // it should be valid domain name

    
    if (!ereg("^\[?[0-9\.]+\]?$", $email_array[1])) {
        $domain_array = explode(".", $email_array[1]);
        
        if (sizeof($domain_array) < 2) {
            
            return false; // Not enough parts to domain

            
        }
        
        for ($i = 0;$i < sizeof($domain_array);$i++) {
            
            if (!ereg("^(([A-Za-z0-9][A-Za-z0-9-]{0,61}[A-Za-z0-9])|
([A-Za-z0-9]+))$", $domain_array[$i])) {
                
                return false;
            }
        }
    }
    
    return true;
}
?>
./include/footer.php
<?php	  echo "</td></tr>
<tr><td align='center' colspan='7' class='headers'>Powered by "; include("../include/version.php"); echo "</td></tr>";

 echo '   </table>
	  </div> ';

?>
./local_bands/remove.php
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
session_start();
require("../include/config.php");
require("../include/functions.php");
require("../include/header.php");
if($user_info['permissions'] == 4)
{
//include "../../testheader.php";
require("config.php");
echo "<center><table width=50%><tr><td bgcolor=#FFFFFF><center>";
if($_GET[id]!=NULL){
$result = mysql_query("SELECT * FROM bands where id=$_GET[id]");
$bandinfo = mysql_fetch_array($result);
$id='"' .mysql_real_escape_string($_GET[id]) . '"';
mysql_query("DELETE FROM bands WHERE id=$id")
or die(mysql_error());
if(mysql_affected_rows()==0){
	echo "That ID Does not exsist!";
}
else{
	echo $bandinfo[name] . " Has been removed!	";
	unlink($bandinfo[image]);

}
}
echo "<br><br><a href=" . "index.php" . ">" . "GO BACK" . "</a><br>";
echo "</td></tr></table>";
}

else{
echo "<br><br><br><br><center><font color=white><b>You are not authorized for this section.</b></font>";
}
?>

./local_bands/edit.php
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
session_start();
require("../include/config.php");
require("../include/functions.php");
require("../include/header.php");
//include "../../testheader.php";
if($user_info['permissions'] > 1)
{
require("config.php");
//print_r($_FILES);
//echo "<br><br><br>";

$name=mysql_real_escape_string($_POST[name]);
$hometown=mysql_real_escape_string($_POST[hometown]);
$genre=mysql_real_escape_string($_POST[genre]);
$website=mysql_real_escape_string($_POST[website]);
$info=mysql_real_escape_string($_POST[info]);
$callname=mysql_real_escape_string($_POST[callname]);
$listen=mysql_real_escape_string($_POST[listen]);
echo "<center><table width=70%><tr><td bgcolor=#FFFFFF><center>";
if($_POST[image] == 'on'){
	$fail = 0;
	$target = "../../local_bands/images/";
	$target = $target . basename( $_FILES['uploaded']['name']) ;
	//echo $target . "<br>";

	if(move_uploaded_file($_FILES['uploaded']['tmp_name'], $target))
	{
		echo "The file ". basename( $_FILES['uploaded_file']['name']). " has been uploaded<br>";
	}
	else {
		echo "Sorry, there was a problem uploading your file.";
		$fail=1;
	}
	$image = "images/" . $_FILES['uploaded']['name'];
	if($fail==0){
		mysql_query("UPDATE bands SET name='$name',hometown='$hometown',genre='$genre',website='$website',info='$info',listen='$listen' image='$image'  WHERE callname = '$callname'")
		or die(mysql_error());
		echo $name . "Has Been Editied! (Image Change)<br>";

	}
}
else{
	mysql_query("UPDATE bands SET name='$name',hometown='$hometown',genre='$genre',website='$website',info='$info',listen='$listen'  WHERE callname = '$callname'")
	or die(mysql_error());
	echo $name . "Has Been Edited! (No image change)<br>";
	//echo "UPDATE bands SET name='$name',hometown='$hometown',genre='$genre',website='$website',info='$info',listen='$listen'  WHERE callname = '$callname'";
}
echo "<br><br><a href=" . "index.php" . ">" . "GO BACK" . "</a><br>";
}
else{
echo "<br><br><br><br><center><font color=white><b>You are not authorized for this section.</b></font>";
}
echo "</center></td></tr></table></center>";
?>



./local_bands/index.php
<?php
session_start();
require("../../config.php");
require("../include/functions.php");
require("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
//include "../../testheader.php";
if($user_info['permissions'] > 1)
{

// further checking...

if($_GET[callname]!=NULL){
	$result = mysql_query("SELECT * FROM bands WHERE callname = '$_GET[callname]' ORDER BY name");
	if(mysql_num_rows($result)==0){
		echo "Invalid callname";
	}
	else{
		$row = mysql_fetch_array($result);
		echo "<center><H1>Editing " . $row[name] . "</H1></center>";
		echo "<center><table bgcolor='#FFFFFF' width=45% ><tr bgcolor=#FFFFFF><td><form action=edit.php enctype='multipart/form-data' method=POST>
		<b><center>	<br><br>
		Band Name:<input type=text name=name value='" . $row[name] . "'>
		<br>
		Hometown:<input type=text name=hometown value='" . $row[hometown] ."'>
		<br>
		Genre:<input type=text name=genre value='" . $row[genre] . "'>
		<input type=hidden name=callname value='" . $_GET[callname] . "'>
		<br>
		Website:<input type=text name=website value='" . $row[website] . "'>
		<br>
		<br>
		Band Info: <br>
		<textarea name=info cols=40 rows=5>". $row[info] . "
		</textarea><br>
		<br>
		<img src=../../local_bands/" . $row[image] . "></a><br>
		Image:<input name=uploaded type=file /><br />
		Check to change image: <input name=image type=checkbox><br>
		<br>
		Listen:<input type=text name=listen value='" . $row[listen] . "'><br><br>
		<input type=submit />
		</center></form></td></tr></table>
		<br><br><br><a href=./index.php><font color=#FFFFFF>Go Back</font></a>
		</center>";


	}

}
else{
echo "<center>";

		echo "<H1>Local Bands: </H1>";
		echo "<table border='0' width='45%'bgcolor='#FFFFFF'>";
		echo "<tr>";
		echo "<td><a href=?char=><b>All Bands</b></a></td>";
		foreach(range('A','Z') as $i)
		{
			echo "<td>";
			echo "<a href=?char=" . $i . "><b>" . $i . "</b></a>";
			echo "</td>";
		}
		echo "</tr>";
		echo "</table>";
		echo "<table border='1' width='45%' BORDERCOLOR='#3C7580' cellpadding='0' bgcolor='#FFFFFF'>";
		$result = mysql_query("SELECT * FROM local_bands WHERE name LIKE '$_GET[char]%' ORDER BY name");
		if(mysql_num_rows($result)==0)
		{
			echo "</table>";
			echo "NO RESULTS";
		}

		else
		{
			echo "<td><center>Image</center></td><td><center>Band Name</center></td><td><center>Listen</center></td>";
			while($row = mysql_fetch_array($result))
			{
				echo "<tr BORDERCOLOR='#3C7580' bgcolor='#FFFFFF' ><td><center>";
				echo "<a href=?callname=" . $row[callname] . ">" . "<img src=../../local_bands/" . $row['image'] . " 	height=100 ></a>";
				echo "</center></td><td><center>";
				echo "<a href=?callname=" . $row[callname] . ">" . $row['name'] . "</a>";
				echo "</center></td><td><center>";
				echo "<a href=" . $row[listen] . ">" . "<img src=../../local_bands/images/speaker.png height=50></a>";
				echo "<a href=./remove.php?id=" . $row[id] . ">Remove</a>";
				echo "</center></td></tr>";
			}
		echo "</table>";
	}

			echo "<br><br><br><a href=./addband.php><font color=#FFFFFF>Add Band</font></a>";

echo "</center>";
}
}
else{
echo "<br><br><br><br><center><font color=white><b>You are not authorized for this section.</b></font>";
}
//include("../../footer.php") ?>


./local_bands/addband.php
<?php
session_start();
require("../../config.php");
require("../include/functions.php");
require("../include/header.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<?php
if($user_info['permissions'] > 1)
{
//include "../../testheader.php";

?>
<center>
<h1>Add A Local Band:</h1><br>
<center>
<form enctype="multipart/form-data" action="addband2.php" method="post">
Band Name:<input type="text" name="name">
<br>
Hometown:<input type="text" name="hometown">
<br>
Genre:<input type="text" name="genre">
<br>
Website:<input type="text" name="website">
<br>
Info: <br>
<textarea name="info" cols="40" rows="5">
Band Info Here
</textarea><br>
<br>
Image:<input name="uploaded" type="file" /><br />
<br>
Callname:<input type="text" name="callname">
<br>
Listen:<input type="text" name="listen">
<input type="submit" />
</form>
</center>
<?php }
else{
echo "<br><br><br><br><center><font color=white><b>You are not authorized for this section.</b></font>";
}
 ?>


./local_bands/addband2.php
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title><?php require("../include/version.php"); ?></title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<?php
session_start();
require("../include/config.php");
require("../include/functions.php");
require("../include/header.php");
if($user_info['permissions'] > 1)
{
//include "../../testheader.php";
require("config.php");
//print_r($_FILES);;
echo "<center><table width=50%><tr><td bgcolor=#FFFFFF><center>";
$fail = 0;
$target = "../../local_bands/images/";
$target = $target . basename( $_FILES['uploaded']['name']) ;
//echo $target . "<br>";

if(move_uploaded_file($_FILES['uploaded']['tmp_name'], $target))
{
	echo "The file ". basename( $_FILES['uploaded_file']['name']). " has been uploaded<br>";
}
else {
	echo "Sorry, there was a problem uploading your file.";
	$fail=1;
}

$image = "images/" . $_FILES['uploaded']['name'];
if($fail==0){
$name=mysql_real_escape_string($_POST[name]);
$hometown=mysql_real_escape_string($_POST[hometown]);
$genre=mysql_real_escape_string($_POST[genre]);
$website=mysql_real_escape_string($_POST[website]);
$info=mysql_real_escape_string($_POST[info]);
$callname=mysql_real_escape_string($_POST[callname]);
$listen=mysql_real_escape_string($_POST[listen]);


	mysql_query("INSERT INTO bands(name,hometown,genre,website,info,image,callname,listen) VALUES('$name','$hometown','$genre','$website','$info','$image','$callname','$listen')")
or die(mysql_error());
echo $name . "Has Been Added!<br>";

}
echo "<br><br><a href=" . "index.php" . ">" . "GO BACK" . "</a><br>";
}
else{
echo "<br><br><br><br><center><font color=white><b>You are not authorized for this section.</b></font>";
}
echo "</td></tr></table>";
?>



./login/forgot_password_email.php
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
<?php
require("../include/config.php"); 


// Random confirmation code 
$confirm_code=md5(uniqid(rand())); 

// values sent from form 
$email=$_GET['email'];


// Insert data into database 

$sql="UPDATE djs SET confirm_code = '$confirm_code' WHERE email = '$email'";
$result=mysql_query($sql);

// if suceesfully inserted data into database, send confirmation link to email 
if($result){

// ---------------- SEND MAIL FORM ----------------

// send e-mail to ...
$to=$email;

// Your subject
$subject="WUPX Password Reset Request";

// From
$header="from: WUPX-FM <itdirector@wupx.com>";

// Your message
$message="Someone, hopefully you, has requested to reset your password. \r\n";
$message.="Click on this link to reset your password \r\n";
$message.="http://www.wupx.com/arcums/login/forgot_password_change.php?code=$confirm_code";

// send email
$sentmail = mail($to,$subject,$message,$header);

}

// if not found 
else {
echo '

<br><br><br><br><br><br><br><br>

<table width="448" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="3"><img src="images/login_01.png" width="448" height="81" /></td>
  </tr>
  <tr>
    <td width="33"><img src="images/login_02.png" /></td>
    <td width="209" valign="top" background="images/login_03.png">
    


Address not found...<br><br>
<a href="forgot_password.php">[try again]</a>


  </td>
    <td width="212"><div align="right"><img src="images/login_04.png" /></div></td>
  </tr>
  <tr>
    <td colspan="3"><img src="images/login_05.png" /></td>
  </tr>
</table>

';
}

// if your email succesfully sent
if($sentmail){
echo '
<br><br><br><br><br><br><br><br>

<table width="448" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="3"><img src="images/login_01.png" width="448" height="81" /></td>
  </tr>
  <tr>
    <td width="33"><img src="images/login_02.png" /></td>
    <td width="209" valign="top" background="images/login_03.png">
    


Your confirmation link has been sent to your e-mail address.<br><br>
<a href="index.php">[login]</a>


  </td>
    <td width="212"><div align="right"><img src="images/login_04.png" /></div></td>
  </tr>
  <tr>
    <td colspan="3"><img src="images/login_05.png" /></td>
  </tr>
</table>
';
}
else {
echo '

<br><br><br><br><br><br><br><br>

<table width="448" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="3"><img src="images/login_01.png" width="448" height="81" /></td>
  </tr>
  <tr>
    <td width="33"><img src="images/login_02.png" /></td>
    <td width="209" valign="top" background="images/login_03.png">
    


Address not found...<br><br>
<a href="forgot_password.php">[try again]</a>


  </td>
    <td width="211"><div align="right"><img src="images/login_04.png" /></div></td>
  </tr>
  <tr>
    <td colspan="3"><img src="images/login_05.png" /></td>
  </tr>
</table>

';
}

?>

./login/forgot_password_parse.php
<?php 
header("Cache-control: private"); 
include("../../config.php"); 
require("../include/functions.php");



// CHECK FOR CONFIRMATION CODE
if(isset($_POST['code']) && isset($_POST['email']))
{
$confirm_code = mysql_real_escape_string($_POST['code']);
$confirm_email = mysql_real_escape_string($_POST['email']);
if(mysql_num_rows(mysql_query("SELECT confirm_code, email FROM djs WHERE confirm_code = '$confirm_code' AND email = '$confirm_email'")) == 0)
{
echo "That confirmation code or e-mail is incorrect.  Please go back and try again.!";
} else {
echo "Confirmation & e-mail code is correct...<br>";





// CHECK FOR MATCHING PASSWORDS
    if ($_POST['pass1'] != $_POST['pass2']) { 
             echo "Your passwords don't match..."; 
        } else { 
echo "Your passwords match...<br><br>";




// UPDATE PASSWORD IN MYSQL
                $encryptpass = md5($_POST['pass1']); 
				$code = mysql_real_escape_string($_POST['code']); 
				$email = mysql_real_escape_string($_POST['email']); 
 				$random_confirm_code=md5(uniqid(rand())); 
                mysql_query("UPDATE djs SET encryptpass='$encryptpass' WHERE confirm_code='$code' AND email='$email' LIMIT 1") or die(mysql_error()); 
                mysql_query("UPDATE djs SET confirm_code='$random_confirm_code' WHERE confirm_code='$code' AND email='$email' LIMIT 1") or die(mysql_error()); 
						echo "Password Updated";







}
}
}
?> 
./login/forgot_password.php

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>



<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ARCUMS 2.0</title>
<link href="../../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>

<br><br><br><br><br><br><br><br>

<table width="448" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="3"><img src="images/login_01.png" width="448" height="81" /></td>
  </tr>
  <tr>
    <td width="33"><img src="images/login_02.png" /></td>
    <td width="209" valign="top" background="images/login_03.png">
    


<form id="form1" name="form1" method="GET" action="forgot_password_email.php">
<b><u>Password Reset</u></b><br>
  <label>
  E-Mail: <input type="text" name="email" id="email" />
  </label>
  <label>
  <button id="replacement-2" type="submit">&nbsp;</button>
  </label>
</form>

<a href="..">[cancel]</a>
  </td>
    <td width="211"><div align="right"><img src="images/login_04.png" /></div></td>
  </tr>
  <tr>
    <td colspan="3"><img src="images/login_05.png" /></td>
  </tr>
</table>


</body>
</html>./login/logout.php
<?php
session_start();
if(isset($_SESSION['dj_logged_in']) && isset($_SESSION['username']))
{
@session_destroy();
$_SESSION = array();
header("Refresh: 0;url=index.php");
}
?> 
./login/forgot_password_change.php
<html><head> 
<title>Change Profile Password</title> 
</head>
<style>
body
{
background: #131313;
background-image: url('../images/bg.jpg');
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
.text
{
font-family: Verdana, Arial;
font-weight: bold;
font-size: 11px;
color: #FFFFFF;
}
.header
{
font-family: Verdana, Arial;
font-weight: bold;
font-size: 14px;
color: #FFFFFF;
}
.register_box
{
border: 1px solid #323232;
background: #202020;
font-family: Verdana, Arial;
font-weight: bold;
font-size: 9px;
color: #FFFFFF;
}
a:link
{
color: c0c0c0;
}
a:visited
{
color: c0c0c0;
}
a:hover
{
color: 00ff00;
}
</style>
<body>
<table><tr><td><div class="header">Reset Your Password</td></tr></table> 

<form action="forgot_password_parse.php" method="POST"> 
<table><tr><td>
<div class="text">Confirmation Code: </td><td><input type="text" value="

<?php 
$confirm_code = $_GET['code']; 
echo "$confirm_code";
?>

" name="code" size="40"><br /> </td></tr>
<tr><td><div class="text">E-Mail: </td><td><input type="text" name="email" size="20"><br />  </td></tr>
<tr><td><div class="text">New Password: </td><td><input type="password" name="pass1" size="20"><br />  </td></tr>
<tr><td><div class="text">New Password (again): </td><td><input type="password" name="pass2" size="20"><br /> 
</tr></td></table>
<input type="submit" value="Update Account">

</form> 
</body></html> ./login/index.php
<?php
session_start();
require ("../../config.php");
require ("../include/functions.php");
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ARCUMS 4.2</title>
<link href="../../themes/<?php echo $curtheme?>/arcums.css" rel="stylesheet" type="text/css" />
</head>

<body>
<br><br><br><br><br><br><br><br>
<?php

if (!isset($_SESSION['dj_logged_in'])) {
    
    if (!isset($_POST['check_login'])) {
        echo '<table width="448" border="0" align="center" cellpadding="0" cellspacing="0">
		  <tr>
		    <td colspan="3"><img src="images/login_01.png" width="448" height="81" /></td>
		  </tr>
		  <tr>
		    <td width="33"><img src="images/login_02.png" /></td>
		    <td width="209" valign="top" background="images/login_03.png">
		    <form method="post" action="index.php">


		      <table width="100%" height="79" border="0" cellpadding="0" cellspacing="0">
			<tr>
			  <td colspan="2" valign="top"><div class="login" align="right">
			  <b>username</b>  <input name="username" type="text" id="username" size="13" />
			  </div></td>
			</tr>
			<tr>
			  <td colspan="2" height="22" valign="top"><div class="login" align="right">
			  <b>password</b> <input name="encryptpass" type="password" id="password" size="13" />
			  </div></td>
			</tr>
			 <tr>
			  <td height="26" valign="bottom"><div class="login"  align="right"><a href="forgot_password.php">[forgot password]</a> </div></td>
			  <td align="right" valign="bottom">


		  <button id="replacement-2" type="submit" name="check_login">&nbsp;</button>




		</td>
			</tr>
		      </table>
		 
		    </form>    </td>
		    <td width="211" ><div align="right"><img src="images/login_04.png" /></div></td>
		  </tr>
		  <tr>
		    <td colspan="3"><img src="images/login_05.png" /></td>
		  </tr>
		</table>
		';
    }
    elseif (isset($_POST['check_login'])) {
        $username = mysql_real_escape_string($_POST['username']);
        $encryptpass = md5($_POST['encryptpass']);
        
        if (empty($_POST['encryptpass']) || empty($username)) {
            echo '<table width="425" border="0" background="images/errorbg.png" align="center" cellpadding="0" cellspacing="0">
				<tr>
				<td align="center" valign="bottom">
				<img src="images/!.png"> You left a blank field.
				</td>
				</tr>
				</table>
				<table width="448" border="0" align="center" cellpadding="0" cellspacing="0">
				  <tr>
				    <td colspan="3"><img src="images/login_01.png" width="448" height="81" /></td>
				  </tr>
				  <tr>
				    <td width="33"><img src="images/login_02.png" /></td>
				    <td width="204" valign="top" background="images/login_03.png">
				    <form method="post" action="index.php">


				      <table width="100%" height="79" border="0" cellpadding="0" cellspacing="0">
					<tr>
					  <td  colspan="2" valign="top"><div align="right">
					    <input name="username" type="text" id="username" size="27" />
					  </div></td>
					</tr>
					<tr>
					  <td colspan="2" height="22" valign="top"><div align="right">
					    <input name="encryptpass" type="password" id="password" size="27" />
					  </div></td>
					</tr>
					 <tr>
					  <td height="26" valign="bottom"><div align="right"><a href="forgot_password.php">[forgot password]</a></div></td>
					  <td align="right" valign="bottom">


				  <button id="replacement-2" type="submit" name="check_login">&nbsp;</button>




				</td>
					</tr>
				      </table>
				 
				    </form>    </td>
				    <td width="212"><div align="right"><img src="images/login_04.png" /></div></td>
				  </tr>
				  <tr>
				    <td colspan="3"><img src="images/login_05.png" /></td>
				  </tr>
				</table>';
        }
        else {
            $check_login = mysql_query("SELECT username, encryptpass, id FROM accounts WHERE username = '$username' AND encryptpass = '$encryptpass' AND is_activated=1 LIMIT 1") or die("Database Error (/arcums/index.php, 130)");
            
            if (mysql_num_rows($check_login) > 0) {
                $row = mysql_fetch_assoc($check_login);
                $query = "UPDATE accounts SET last_login = NOW() WHERE id =" . $row['id'];
                mysql_query($query) or die("Failed to update last login time");
                $_SESSION['dj_logged_in'] = 1;
                $_SESSION['username'] = $username;
                echo '<meta HTTP-EQUIV="REFRESH" content="0; url=';
                echo $_SESSION['currentpage'];
                echo '">';
            }
            else {
                echo '<table width="425" border="0" background="images/errorbg.png" align="center" cellpadding="0" cellspacing="0">
				<tr>
				<td align="center" valign="bottom">';
                $check_login = mysql_query("SELECT username, encryptpass, id FROM accounts WHERE username = '$username' AND encryptpass = '$encryptpass' LIMIT 1") or die("Database Error (/arcums/index.php, 130)");
                
                if (mysql_num_rows($check_login) > 0) {
                    echo '<img src="images/!.png"> User is not activated';
                }
                else {
                    echo '<img src="images/!.png"> Wrong Password or user doesn\'t exist.';
                }
                echo '</td>
				</tr>
				</table>
				<table width="448" border="0" align="center" cellpadding="0" cellspacing="0">
				  <tr>
				    <td colspan="3"><img src="images/login_01.png" width="448" height="81" /></td>
				  </tr>
				  <tr>
				    <td width="33"><img src="images/login_02.png" /></td>
				    <td width="204" valign="top" background="images/login_03.png">
				    <form method="post" action="index.php">


				      <table width="100%" height="79" border="0" cellpadding="0" cellspacing="0">
					<tr>
					  <td  colspan="2" valign="top"><div align="right">
					    <input name="username" type="text" id="username" size="27" />
					  </div></td>
					</tr>
					<tr>
					  <td colspan="2" height="22" valign="top"><div align="right">
					    <input name="encryptpass" type="password" id="password" size="27" />
					  </div></td>
					</tr>
					 <tr>
					  <td height="26" valign="bottom"><div align="right"><a href="forgot_password.php">[forgot password]</a> </div></td>
					  <td align="right" valign="bottom">


				  <button id="replacement-2" type="submit" name="check_login">&nbsp;</button>




				</td>
					</tr>
				      </table>
				 
				    </form>    </td>
				    <td width="212"><div align="right"><img src="images/login_04.png" /></div></td>
				  </tr>
				  <tr>
				    <td colspan="3"><img src="images/login_05.png" /></td>
				  </tr>
				</table>';
            }
        }
    }
}
else {
    echo '
	<table width="448" border="0" align="center" cellpadding="0" cellspacing="0">
	  <tr>
	    <td colspan="3"><img src="images/login_01.png" width="448" height="81" /></td>
	  </tr>
	  <tr>
	    <td width="33"><img src="images/login_02.png" /></td>
	    <td width="209" valign="top" background="images/login_03.png">
	   You\'re logged in as:<br><b>';
    echo $_SESSION['username'];
    echo ' </b> <a href="logout.php">[logout]</a> 
	<br><br>
	<a href="../playlist">Continue to ARCUMS...</a>

	</td>
	    <td width="212"><div align="right"><img src="images/login_04.png" /></div></td>
	  </tr>
	  <tr>
	    <td colspan="3"><img src="images/login_05.png" /></td>
	  </tr>
	</table>



	';
}
?>


<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
function popUp(URL) {
day = new Date();
id = day.getTime();
eval("page" + id + " = window.open(URL, '" + id + "', 'toolbar=1,scrollbars=0,location=0,statusbar=1,menubar=0,resizable=1,width=300,height=100,left = 312,top = 309');");
}
// End -->
</script>
</body>
</html>
./user_control.php
<link href="../themes/<?php echo $curtheme;?>/arcums.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
function check_match(){
	var p1=document.forms["passchange"]["password"].value
	var p2=document.forms["passchange"]["password2"].value
	if (p1!=p2)
	  {
		  alert("Passwords do not match");
		  return false;
	  }
}
</script>
<?

//TODO: ADD ORDERING, CLEAR GET VARIABLES FROM THE URL
require_once ("../config.php");
include ("include/header.php");

function show_table() {
    global $root;
    
    if (isset($_GET['ord'])) {
        $ord = mysql_real_escape_string($_GET['ord']);
    }
    else {
        $ord = 'username';
    }
    
    if ($_GET['dir'] == "ASC") {
        $dir = 'ASC';
        $dir_link = 'DESC';
    }
    else {
        $dir = 'DESC';
        $dir_link = 'ASC';
    }

    //DISPLAY A TABLE OF THE USERS.
    $query = "SELECT id,username, is_activated, email, name, djname, permissions, staff, photo, last_login FROM accounts ORDER BY $ord $dir";
    $res = mysql_query($query) or die("Database Error (user_control:5)");
    echo "<center><table class='usertablemain'><tr class='headers'><td></td><td><a href=?ord=username&dir=$dir>Username</a></td><td><a href=?ord=name&dir=$dir>Name</td><td><a href=?ord=djname&dir=$dir>Dj Name</a></td><td><a href=?ord=email&dir=$dir>Email</a></td><td><a href=?ord=is_activated&dir=$dir>Active?</a></td><td><a href=?ord=staff&dir=$dir>Staff?</a></td><td><a href=?ord=permissions&dir=$dir>Permissions</a></td><td><a href=?ord=last_login&dir=$dir>Last Login</a></td><td><a href=?ord=$ord&dir=$dir_link>$dir</a></td></tr>";
    
    while ($row = mysql_fetch_assoc($res)) {
        echo "<tr>";
        echo "<td><img src='" . $root . "/arcums/profile/photos/" . $row['photo'] . "' height='70'></td>";
        echo "<td>" . $row['username'] . "</td>";
        echo "<td>" . $row['name'] . "</td>";
        echo "<td>" . $row['djname'] . "</td>";
        echo "<td>" . $row['email'] . "</td>";
        echo "<td>" . $row['is_activated'] . "</td>";
        echo "<td>" . $row['staff'] . "</td>";
        echo "<td>" . $row['permissions'] . "</td>";
        echo "<td>" . $row['last_login'] . "</td>";
        echo "<td><a href='?pass=" . $row['id'] . "'>Reset Password</a> ";
        
        if ($row['is_activated'] == 0) {
            echo "<a href='?activate=" . $row['id'] . "'>Activate</a>";
        }
        else {
            echo "<a href='?deactivate=" . $row['id'] . "'>Deactivate</a>";
        }
        echo "</td></tr>";
    }
    echo "</table></center>";
}

//CHECK FOR REQUESTED ACTIONS, PERFORM IF REQUESTED

if (isset($_GET['deactivate'])) {
    $id = mysql_real_escape_string($_GET['deactivate']);
    $query = "UPDATE accounts SET is_activated=0 WHERE id=$id";
    $res = mysql_query($query) or die("Database Error");
    
    if (mysql_affected_rows() < 1) {
        echo "Query failed to modify any rows";
    }
    else {
        echo "User Deactivated";
    }
    show_table();
}
else 
if (isset($_GET['activate'])) {
    $id = mysql_real_escape_string($_GET['activate']);
    $query = "UPDATE accounts SET is_activated=1 WHERE id=$id";
    $res = mysql_query($query) or die("Database Error");
    
    if (mysql_affected_rows() < 1) {
        echo "Query failed to modify any rows";
    }
    else {
        echo "User Activated";
    }
    show_table();
}
else 
if (isset($_POST['idpass'])) {
    $id = mysql_real_escape_string($_POST['idpass']);
    $newpass = mysql_real_escape_string($_POST['password']);
    $query = "UPDATE accounts SET encryptpass=MD5($newpass) WHERE id = $id";
    mysql_query($query) or die("Error updating password");
    
    if (mysql_affected_rows() < 1) {
        echo "Query failed to modify any rows";
    }
    else {
        echo "Password Changed!";
    }
    show_table();
}
else 
if (isset($_GET['pass'])) {
    $id = mysql_real_escape_string($_GET['pass']);
    $query = "select username from accounts where id = $id";
    $res = mysql_query($query) or die("Failed to select user");
    $row = mysql_fetch_assoc($res);
    echo "Changing password for user: <b>" . $row['username'] . "</b><br>";
    echo "<form name='passchange' method='POST' onsubmit='return check_match()' >New Password:<input type='password' name='password'></input><br>Re-enter New Password:<input type='password' name='password2'></input><br><input type='hidden' name='idpass' value='$id'><input type='submit'></form>";
}
else {
    echo "";
    show_table();
}
?>
